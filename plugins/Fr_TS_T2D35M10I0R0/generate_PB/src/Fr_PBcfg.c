[!AUTOSPACING!][!//
/**
*  @file Fr_PBcfg.c
*  @implements Fr_PBcfg.c_Artifact
*  @version 1.0.0
*
*  @brief   AUTOSAR Fr - Driver configuration file.
*  @details Contains configuration structures generated by Module Configuration Generator.
*
*  @addtogroup [MODULE_SECTION]
*  @{  
*/
/*==================================================================================================
*   Project              : AUTOSAR 4.2 MCAL
*   Platform             : PA
*   Peripheral           : FLEXRAY
*   Dependencies         : 
*
*   Autosar Version      : 4.2.2
*   Autosar Revision     : ASR_REL_4_2_REV_0002
*   Autosar Conf.Variant :
*   SW Version           : 1.0.0
*   Build Version        : MPC574XG_MCAL_1_0_0_RTM_ASR_REL_4_2_REV_0002_20170217
*
*   (c) Copyright 2006-2016 Freescale Semiconductor, Inc. 
*       Copyright 2017 NXP
*   All Rights Reserved.
==================================================================================================*/
/*==================================================================================================
==================================================================================================*/
#include "Fr.h"
#include "Dem.h"

#ifdef __cplusplus
extern "C" {
#endif

[!WS "0"!][!INCLUDE "Fr_VersionCheck.m"!][!//
[!WS "0"!][!INCLUDE "Fr_DeviceMacros.m"!][!//
[!WS "0"!][!INCLUDE "Fr_SpecChecks.m"!][!//
/***************************************************************************************************
* MISRA violations
***************************************************************************************************/

/**
* @page misra_violations MISRA-C:2004 violations
*
* @section FR_PBCFG_C_REF_1
* Violates MISRA 2004 Required Rule 19.15, #include "Fr_MemMap.h" is not preceded only by
* preprocessor directives and appears not only in the beginning of file because it otherwise
* would not work.
* 
* @section FR_PBCFG_C_REF_2
* Violates MISRA 2004 Advisory Rule 19.1, Inclusion of "Fr_MemMap.h" is required here because of
* its functionality.
*
* @section FR_PBCFG_C_REF_3
* Violates MISRA 2004 Required Rule 8.10, External linkage is required.
*
* @section FR_PBCFG_C_REF_4
* Violates MISRA 2004 Required Rule 5.1, Identifier is specified by configuration or ASR
* specification.
*
* @section FR_PBCFG_C_REF_5
* Violates MISRA 2004 Required Rule 1.4, Identifier is specified by configuration or ASR
* specification.
*
*/

/*==================================================================================================
*                              SOURCE FILE VERSION INFORMATION
==================================================================================================*/
#define FR_VENDOR_ID_PBCFG_C                    [!"CommonPublishedInformation/VendorId"!]
/* @violates @ref FR_PBCFG_C_REF_4 */
#define FR_AR_RELEASE_MAJOR_VERSION_PBCFG_C     [!"CommonPublishedInformation/ArReleaseMajorVersion"!]
/* @violates @ref FR_PBCFG_C_REF_4 */
#define FR_AR_RELEASE_MINOR_VERSION_PBCFG_C     [!"CommonPublishedInformation/ArReleaseMinorVersion"!]
/* @violates @ref FR_PBCFG_C_REF_4 */
/* @violates @ref FR_PBCFG_C_REF_5 */
#define FR_AR_RELEASE_REVISION_VERSION_PBCFG_C  [!"CommonPublishedInformation/ArReleaseRevisionVersion"!]
#define FR_SW_MAJOR_VERSION_PBCFG_C             [!"CommonPublishedInformation/SwMajorVersion"!]
#define FR_SW_MINOR_VERSION_PBCFG_C             [!"CommonPublishedInformation/SwMinorVersion"!]
#define FR_SW_PATCH_VERSION_PBCFG_C             [!"CommonPublishedInformation/SwPatchVersion"!]

/*==================================================================================================
*                                     FILE VERSION CHECKS
==================================================================================================*/
/* Check if current file and Fr.h header file are of the same vendor */
#if(FR_VENDOR_ID_PBCFG_C != FR_VENDOR_ID)
    #error "Fr_PBcfg.c and Fr.h have different Vendor IDs"
#endif
/* Check if current file and Fr.h header file are of the same Autosar version */
#if((FR_AR_RELEASE_MAJOR_VERSION_PBCFG_C    != FR_AR_RELEASE_MAJOR_VERSION) || \
    (FR_AR_RELEASE_MINOR_VERSION_PBCFG_C    != FR_AR_RELEASE_MINOR_VERSION) || \
    (FR_AR_RELEASE_REVISION_VERSION_PBCFG_C != FR_AR_RELEASE_REVISION_VERSION))
    #error "Software Version Numbers of Fr_PBcfg.c and Fr.h are different"
#endif
/* Check if current file and Fr.h header file are of the same software version */
#if((FR_SW_MAJOR_VERSION_PBCFG_C != FR_SW_MAJOR_VERSION) || \
    (FR_SW_MINOR_VERSION_PBCFG_C != FR_SW_MINOR_VERSION) || \
    (FR_SW_PATCH_VERSION_PBCFG_C != FR_SW_PATCH_VERSION))
    #error "Autosar Version Numbers of Fr_PBcfg.c and Fr.h are different"
#endif

#ifndef DISABLE_MCAL_INTERMODULE_ASR_CHECK
    /* Check if current file and Dem.h header file are of the same Autosar version */
    #if((FR_AR_RELEASE_MAJOR_VERSION_PBCFG_C != DEM_AR_RELEASE_MAJOR_VERSION) || \
        (FR_AR_RELEASE_MINOR_VERSION_PBCFG_C != DEM_AR_RELEASE_MINOR_VERSION))
        #error "AutoSar Version Numbers of Fr_PBcfg.c and Dem.h are different"
    #endif
#endif /* CHECK_AUTOSAR_VERSION */
/*==================================================================================================
*                                   GLOBAL FUNCTION PROTOTYPES
==================================================================================================*/
[!IF "$SupportIpv9 = 'true'"!]
#ifdef FR_ACCESS_ERROR_NOTIFICATION_EN
[!LOOP "node:order(FrMultipleConfiguration,'node:name(.)')"!][!//Sort the multiple configurations by their name at first
    [!LOOP "node:order(FrController/*,'FrCtrlIdx','node:name(.)')"!][!//Sort the controllers by their name at first
        [!IF "(normalize-space(VendorSpecific/FrAccessErrorNotification) != 'NULL_PTR')"!]
            [!WS "0"!]extern FUNC(void,FR_CODE) [!"normalize-space(VendorSpecific/FrAccessErrorNotification)"!](void);
        [!ENDIF!]
    [!ENDLOOP!][!//FrController
[!ENDLOOP!][!//FrMultipleConfiguration
#endif /* FR_ACCESS_ERROR_NOTIFICATION_EN */
[!ENDIF!][!//SupportIpv9
[!//
[!//
[!//
[!//
[!//
[!MACRO "CfgChecks", "FrIfCluster" = "", "FrController" = ""!][!//
  [!// Key Slot checks
  [!IF "'true' = text:tolower(node:value(node:ref($FrController)/FrPKeySlotUsedForStartup)) or 'true' = text:tolower(node:value(node:ref($FrController)/FrPKeySlotUsedForSync))"!][!//Check whether the Key slot is used/enabled
    [!VAR "MacTempValue1" = "number(node:ref($FrController)/FrPKeySlotId)"!][!// Value of the Key slot
    [!VAR "MacTempValue2" = "number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots)"!][!// Number of static slots
    [!//Check whether the Key Slot is correctly configured to static segment
    [!IF "$MacTempValue1 > $MacTempValue2"!]
      [!ERROR!][!//
        [!WS "0"!]Error 004: The [!"$FrController"!]/FrKeySlotId value [!"num:i(number(node:ref($FrController)/FrPKeySlotId))"!] is greater than the [!"$FrIfCluster"!]/FrIfGNumberOfStaticSlots value [!"number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots)"!].
      [!ENDERROR!][!//
    [!ENDIF!]
    [!//Check whether the Key Slot is correctly used for both sync and startup
    [!IF "node:value(node:ref($FrController)/FrPKeySlotUsedForStartup)!= node:value(node:ref($FrController)/FrPKeySlotUsedForSync)"!][!//Check whether sync and startup bits have the same value
       [!ERROR!][!//
         [!WS "0"!]Error 005: The [!"$FrController"!]/FrPKeySlotUsedForStartup value '[!"node:value(node:ref($FrController)/FrPKeySlotUsedForStartup)"!]' is different than the [!"$FrController"!]/FrPKeySlotUsedForSync value '[!"node:value(node:ref($FrController)/FrPKeySlotUsedForSync)"!]'.
       [!ENDERROR!][!//
    [!ENDIF!][!//
  [!ELSE!][!//
     [!// No check, because the Key slot is unused
  [!ENDIF!][!//

  [!//Check whether a valid bitrate is selected
  [!VAR "MacTempValue1" = "node:value(node:ref($FrController)/VendorSpecific/ChannelBitrate)"!]
  [!IF "($MacTempValue1!='br_10Mbps') and ($MacTempValue1!='br_8Mbps') and ($MacTempValue1!='br_5Mbps') and ($MacTempValue1!='br_2500kbps')"!][!//
    [!ERROR!][!//
      [!WS "0"!]Error 007: The [!"$FrController"!]/VendorSpecific/ChannelBitrate value [!"node:value(node:ref($FrController)/VendorSpecific/ChannelBitrate)"!] is not supported bitrate value.
    [!ENDERROR!][!//
  [!ENDIF!][!//

  [!//Check whether the symator value is correct
  [!VAR "MacTempValue1" = "num:i(number(node:value(node:ref($FrController)/VendorSpecific/SystemFrequency)) * 0.45)-8"!]
  [!IF "num:i(node:value(node:ref($FrController)/VendorSpecific/SystemMemoryAccessTimeOut)) > $MacTempValue1"!]
    [!WARNING!][!//
      [!WS "0"!]Warning 301: The [!"$FrController"!]/VendorSpecific/SystemMemoryAccessTimeOut value [!"node:value(node:ref($FrController)/VendorSpecific/SystemMemoryAccessTimeOut)"!] is too high for the selected System Frequency (fchi), the maximum value is [!"num:i($MacTempValue1)"!].
    [!ENDWARNING!][!//
  [!ENDIF!][!//

  [!//Check whether the controller channels are correctly configured
  [!IF "text:tolower(node:value(node:ref($FrController)/VendorSpecific/SingleChannelModeEnabled))='true'"!]
    [!IF "node:value(node:ref($FrController)/FrPChannels)='FR_CHANNEL_AB'"!][!//
      [!ERROR!][!//
        [!WS "0"!]Error 027: The [!"$FrController"!]/VendorSpecific/SingleChannelModeEnabled is enabled but [!"$FrController"!]/FrPChannels is set to FR_CHANNEL_AB.
      [!ENDERROR!][!//
    [!ENDIF!][!//
    [!IF "node:value(node:ref($FrController)/FrPWakeupChannel)='FR_CHANNEL_B'"!][!//
      [!ERROR!][!//
        [!WS "0"!]Error 023: The [!"$FrController"!]/VendorSpecific/SingleChannelModeEnabled is enabled but [!"$FrController"!]/FrPWakeupChannel is set to FR_CHANNEL_B. For a single channel device, the application can access and configure only the registers related to internal channel A.
      [!ENDERROR!][!//
    [!ENDIF!][!//  
  [!ENDIF!]
  [!//Check number of configured absolute counters and their indices validity
  [!IF "count(node:ref($FrController)/FrAbsoluteTimer/*)<1"!][!// Check that at least one timer is configured
    [!ERROR!][!//
      [!WS "0"!]Error 008: The [!"$FrController"!]/FrAbsoluteTimer does not contain any Absolute timer, at least one is required.
    [!ENDERROR!][!//
  [!ENDIF!][!//
  [!IF "count(node:ref($FrController)/FrAbsoluteTimer/*)>2"!][!// Check that at most two timers are configured
    [!ERROR!][!//
      [!WS "0"!]Error 009: The [!"$FrController"!]/FrAbsoluteTimer contains more than 2 absolute timers, only 2 of them are available on the hardware.
    [!ENDERROR!][!//
  [!ENDIF!][!//
  [!IF "count(node:ref($FrController)/FrAbsoluteTimer/*)>1"!][!//If two timers are configured, check that indices are unique
    [!IF "node:value(node:ref($FrController)/FrAbsoluteTimer/*[position()=1]/FrAbsTimerIdx)=node:value(node:ref($FrController)/FrAbsoluteTimer/*[position()=2]/FrAbsTimerIdx)"!][!//
      [!ERROR!][!//
        [!WS "0"!]Error 010: The index of the absolute timer [!"node:path(node:ref($FrController)/FrAbsoluteTimer/*[position()=1])"!] is equal to the index of the absolute timer [!"node:path(node:ref($FrController)/FrAbsoluteTimer/*[position()=2])"!].
      [!ENDERROR!][!//
    [!ENDIF!][!//
  [!ENDIF!][!//
  [!LOOP "node:ref($FrController)/FrAbsoluteTimer/*"!][!//For each configured timer
    [!IF "FrAbsTimerIdx>=count(node:ref($FrController)/FrAbsoluteTimer/*)"!][!//Check whether the index is within range 0..n-1
      [!ERROR!][!//
        [!WS "0"!]Error 011: The index of the absolute timer [!"node:path(.)"!] should be lower than [!"num:i(count(node:ref($FrController)/FrAbsoluteTimer/*))"!].
      [!ENDERROR!][!//
    [!ENDIF!][!//
  [!ENDLOOP!][!//

  [!// Check LPdus, FrameTriggerings...
  [!SELECT "(node:ref($FrIfCluster)/FrIfController/*[node:ref(FrIfFrCtrlRef)=node:ref($FrController)])"!][!//
    [!LOOP "node:order(FrIfLPdu/*,'node:value(FrIfLPduIdx)','node:name(.)')"!][!//
      [!//Check that all LPdus contain valid reference to frame triggering
      [!IF "text:tolower(node:refvalid(FrIfVBTriggeringRef))='false'"!][!// Check FrIfVBTriggeringRef reference validity
        [!ERROR!][!//
          [!WS "0"!]Error 012: [!"node:path(.)"!]/FrIfVBTriggeringRef contains an invalid reference.
        [!ENDERROR!][!//
      [!ENDIF!][!//
      [!//Check that LPdu indices are unique
      [!IF "text:tolower(text:uniq(../*/FrIfLPduIdx, FrIfLPduIdx)) = 'false'"!][!// Check FrIfVBTriggeringRef reference validity
        [!ERROR!][!//
          [!WS "0"!]Error 020: [!"node:path(.)"!]/FrIfLPduIdx is not unique within all LPdus.
        [!ENDERROR!][!//
      [!ENDIF!][!//
      [!//Check that LPdu indices constitute continuous row beginning with 0
      [!IF "number(FrIfLPduIdx) >= count(../*)"!][!// Check FrIfVBTriggeringRef reference validity
        [!ERROR!][!//
          [!WS "0"!]Error 021: LPdu indices do not create continuous row beginning with 0
        [!ENDERROR!][!//
      [!ENDIF!][!//
    [!ENDLOOP!][!//
    [!//Check that all FrameTriggerings contain valid reference to frame structure
    [!LOOP "node:order(FrIfFrameTriggering/*,'node:name(.)')"!][!//
      [!IF "text:tolower(node:refvalid(FrIfFrameStructureRef))='false'"!][!// Check FrIfFrameStructureRef reference validity
        [!ERROR!][!//
          [!WS "0"!]Error 006: [!"node:path(.)"!]/FrIfFrameStructureRef contains an invalid reference.
        [!ENDERROR!][!//
      [!ENDIF!][!//
      [!IF "number(FrIfSlotId)>number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots)"!][!//Check whether it is static or dynamic segment slot
        [!//Dynamic
        [!IF "number(node:ref($FrController)/FrPPayloadLengthDynMax) * 2 < FrIfLSduLength"!][!//
          [!ERROR!][!//
            [!WS "0"!]Error 019: [!"node:path(.)"!]/FrIfLSduLength is greater than [!"node:path(node:ref($FrController))"!]/FrPPayloadLengthDynMax * 2.
          [!ENDERROR!][!//
        [!ENDIF!][!//
      [!ELSE!][!//
        [!//Static
        [!IF "number(node:ref($FrIfCluster)/FrIfGPayloadLengthStatic) * 2 != FrIfLSduLength"!][!//Check the length
          [!ERROR!][!//
            [!WS "0"!]Error 017: [!"node:path(.)"!]/FrIfLSduLength is not equal to [!"node:path(node:ref($FrIfCluster))"!]/FrIfGPayloadLengthStatic * 2 altought the slot is configured in static segment.
          [!ENDERROR!][!//
        [!ENDIF!][!//
        [!IF "text:tolower(node:value(FrIfAllowDynamicLSduLength))='true'"!][!//Check the that dynamic length is disabled
          [!ERROR!][!//
            [!WS "0"!]Error 018: [!"node:path(.)"!]/FrIfAllowDynamicLSduLength is enabled altought the slot is configured in static segment.
          [!ENDERROR!][!//
        [!ENDIF!][!//
        [!IF "number(FrIfCycleRepetition) != 1"!]
          [!IF "number(FrIfCycleRepetition) != 2"!]
            [!IF "number(FrIfCycleRepetition) != 4"!]
              [!IF "number(FrIfCycleRepetition) != 8"!]
                [!IF "number(FrIfCycleRepetition) != 16"!]
                  [!IF "number(FrIfCycleRepetition) != 32"!]
                    [!IF "number(FrIfCycleRepetition) != 64"!]
                      [!ERROR!][!//
                        [!WS "0"!]Error 036: [!"node:path(.)"!]/FrIfCycleRepetition contains unsupported value [!"num:i(FrIfCycleRepetition)"!].
                      [!ENDERROR!][!//
                    [!ENDIF!]
                  [!ENDIF!]
                [!ENDIF!]
              [!ENDIF!]
            [!ENDIF!]
          [!ENDIF!]
        [!ENDIF!]
      [!ENDIF!][!//
      [!//Check that none is assigned for both channels if the single channel mode is enabled
      [!IF "text:tolower(node:value(node:ref($FrController)/VendorSpecific/SingleChannelModeEnabled))='true'"!][!//
        [!IF "node:value(FrIfChannel) != 'FRIF_CHANNEL_A'"!]
          [!ERROR!][!//
            [!WS "0"!]Error 022: [!"node:path(.)"!]/FrIfChannel is set to [!"node:value(FrIfChannel)"!] but the controller is configured as single channel device. For a single channel device, the application can access and configure only the registers related to internal channel A.
          [!ENDERROR!][!//
        [!ENDIF!][!//
      [!ELSE!][!//
        [!IF "node:value(node:ref($FrController)/FrPChannels)='FR_CHANNEL_AB'"!][!//
          [!IF "number(FrIfSlotId) > number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots)"!][!//
            [!IF "node:value(FrIfChannel) = 'FRIF_CHANNEL_AB'"!]
              [!WARNING!][!//
                [!WS "0"!]Warning 303: [!"node:path(.)"!]/FrIfChannel is set to FRIF_CHANNEL_AB but transmission or reception in the dynamic segment on FlexRay channel B will be ignored.
              [!ENDWARNING!][!//
            [!ENDIF!][!//
          [!ENDIF!][!//
        [!ELSE!]
          [!IF "node:value(node:ref($FrController)/FrPWakeupChannel)!=node:value(node:ref($FrController)/FrPChannels)"!][!//
            [!ERROR!][!//
              [!WS "0"!]Error 024: [!"$FrController"!]/FrPChannels is set to [!"node:value(node:ref($FrController)/FrPChannels)"!] only but [!"$FrController"!]/FrPWakeupChannel is set to [!"node:value(node:ref($FrController)/FrPWakeupChannel)"!].
            [!ENDERROR!][!//
          [!ENDIF!][!//
          [!IF "node:value(node:ref($FrController)/FrPChannels)='FR_CHANNEL_A'"!]
            [!IF "node:value(FrIfChannel) = 'FRIF_CHANNEL_B'"!]
              [!ERROR!][!//
                [!WS "0"!]Error 025: [!"node:path(.)"!]/FrIfChannel is set to FRIF_CHANNEL_B but the controller is configured as connected to FR_CHANNEL_A only, see the [!"$FrController"!]/FrPChannels parameter.
              [!ENDERROR!][!//
            [!ENDIF!][!//
            [!IF "node:value(FrIfChannel) = 'FRIF_CHANNEL_AB'"!]
              [!IF "number(FrIfSlotId) <= number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots)"!]
                [!WARNING!][!//
                  [!WS "0"!]Warning 304: [!"node:path(.)"!]/FrIfChannel is set to FRIF_CHANNEL_AB but the controller is configured as connected to FR_CHANNEL_A only. Transmission or reception on FlexRay channel B will be ignored.
                [!ENDWARNING!][!//
              [!ENDIF!][!//
            [!ENDIF!][!//
          [!ENDIF!][!//  
          [!IF "node:value(node:ref($FrController)/FrPChannels)='FR_CHANNEL_B'"!]
            [!IF "node:value(FrIfChannel) = 'FRIF_CHANNEL_A'"!]
              [!ERROR!][!//
                [!WS "0"!]Error 026: [!"node:path(.)"!]/FrIfChannel is set to FRIF_CHANNEL_A but the controller is configured as connected to FR_CHANNEL_B only, see the [!"$FrController"!]/FrPChannels parameter.
              [!ENDERROR!][!//
            [!ENDIF!][!//
            [!IF "node:value(FrIfChannel) = 'FRIF_CHANNEL_AB'"!]
              [!IF "number(FrIfSlotId) <= number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots)"!][!// Static segment
                [!WARNING!][!//
                  [!WS "0"!]Warning 305: [!"node:path(.)"!]/FrIfChannel is set to FRIF_CHANNEL_AB but the controller is configured as connected to FR_CHANNEL_B only. Transmission or reception on FlexRay channel A will be ignored.
                [!ENDWARNING!][!//
              [!ELSE!][!// Dynamic segment
                [!ERROR!][!//
                  [!WS "0"!]Error 038: [!"node:path(.)"!]/FrIfChannel is set to FRIF_CHANNEL_AB but the controller is configured as connected to FR_CHANNEL_B only. Transmission or reception in the dynamic segment will not work.
                [!ENDERROR!][!//
              [!ENDIF!][!//
            [!ENDIF!][!//
          [!ENDIF!][!//
        [!ENDIF!][!//
      [!ENDIF!][!//
    [!ENDLOOP!][!//
  [!ENDSELECT!][!//

  [!IF "count(node:ref($FrController)/FrFifo/*)>0"!][!//Check that FIFO was configured
    [!IF "text:tolower(node:value(node:ref($FrController)/VendorSpecific/SingleChannelModeEnabled))='true'"!][!//
       [!IF "count(node:ref($FrController)/FrFifo/*)>1"!][!//Check that count of FIFOs is less than 1
         [!ERROR!][!//
           [!WS "0"!]Error 039: [!"$FrController"!]/VendorSpecific/SingleChannelModeEnabled is enabled but the [!"$FrController"!]/FrFifo container contains more than 1 FIFO, only 1 FIFO is supported when the controller is configured as single channel device.
         [!ENDERROR!][!//
       [!ENDIF!][!//
       [!IF "node:value(node:ref($FrController)/FrFifo/*/FrChannels)='FR_CHANNEL_B'"!][!//
         [!ERROR!][!//
           [!WS "0"!]Error 040: [!"$FrController"!]/VendorSpecific/SingleChannelModeEnabled is enabled but [!"node:path(node:ref($FrController)/FrFifo/*[position()=1]/FrChannels)"!] is set to FR_CHANNEL_B. For a single channel device, the application can access and configure only the registers related to internal channel A.         
         [!ENDERROR!][!//
       [!ENDIF!][!//
    [!ELSE!][!//Dual channel mode
      [!IF "node:value(node:ref($FrController)/FrPChannels)!='FR_CHANNEL_AB'"!]
        [!IF "count(node:ref($FrController)/FrFifo/*)>1"!]
          [!ERROR!][!//
            [!WS "0"!]Error 041: The [!"$FrController"!]/FrFifo container contains more than 1 FIFO but [!"node:path(node:ref($FrController)/FrPChannels)"!] is set to [!"node:value(node:ref($FrController)/FrPChannels)"!] only. Only one FIFO per channel is supported by the hardware.
          [!ENDERROR!][!//
        [!ENDIF!][!//
        [!IF "node:value(node:ref($FrController)/FrPChannels)!= node:value(node:ref($FrController)/FrFifo/*[position()=1]/FrChannels)"!]
          [!ERROR!][!//
            [!WS "0"!]Error 042: Wrong channel is assigned to FIFO. [!"node:path(node:ref($FrController)/FrFifo/*[position()=1]/FrChannels)"!] is configured to [!"node:value(node:ref($FrController)/FrFifo/*[position()=1]/FrChannels)"!] but [!"node:path(node:ref($FrController)/FrPChannels)"!] is configured to [!"node:value(node:ref($FrController)/FrPChannels)"!].
          [!ENDERROR!][!//
        [!ENDIF!][!//
      [!ENDIF!]
      [!// Check that at most 2 FIFOs are configured and for different channels, with at least one range filter for each
      [!IF "count(node:ref($FrController)/FrFifo/*)>2"!][!//Check that count of FIFOs is less than 2
        [!ERROR!][!//
          [!WS "0"!]Error 013: [!"node:ref($FrController)"!]/FrFifo contains more than 2 FIFOs, only 2 of them are supported by the hardware.
        [!ENDERROR!][!//
      [!ENDIF!][!//
      [!IF "count(node:ref($FrController)/FrFifo/*)>1"!][!//If more FIFOs are configured then check
        [!IF "node:value(node:ref($FrController)/FrFifo/*[position()=1]/FrChannels)=node:value(node:ref($FrController)/FrFifo/*[position()=2]/FrChannels)"!][!//
          [!ERROR!][!//
            [!WS "0"!]Error 014: [!"node:ref($FrController)"!]/FrFifo - both FIFOs are configured for the same channel.
          [!ENDERROR!][!//
        [!ENDIF!][!//
      [!ENDIF!][!//
    [!ENDIF!][!//
    [!LOOP "node:ref($FrController)/FrFifo/*"!][!//For each fifo
      [!IF "count(FrRange/*)<1"!][!//Check that at least one range is defined
        [!ERROR!][!//
          [!WS "0"!]Error 015: [!"node:path(.)"!]/FrRange does not contain any range filter, please configure at least one.
        [!ENDERROR!][!//
      [!ENDIF!][!//
      [!IF "count(FrRange/*)>4"!][!//Check that at most 4 ranges are defined
        [!ERROR!][!//
          [!WS "0"!]Error 016: [!"node:path(.)"!]/FrRange contains more than 4 range filters, please configure at at most 4.
        [!ENDERROR!][!//
      [!ENDIF!][!//
      [!IF "count(FrRange/*[node:value(FrVendorSpecific/FrRangeMode) = 'FR_ACCEPTANCE'])<1"!][!//Check that at least one acceptance range is defined
        [!ERROR!][!//
          [!WS "0"!]Error 030: [!"node:path(.)"!]/FrRange does not contain any acceptance range.
        [!ENDERROR!][!//
      [!ENDIF!][!//
      [!//Check that all ranges have maximum greater or equal to minimum
      [!LOOP "FrRange/*"!][!//
        [!IF "number(FrRangeMax)<number(FrRangeMin)"!][!//
          [!ERROR!][!//
            [!WS "0"!]Error 028: FrRangeMax is lower than FrRangeMin in the [!"node:path(.)"!].
          [!ENDERROR!][!//
        [!ENDIF!][!//
      [!ENDLOOP!][!//
    [!ENDLOOP!][!//
  [!ENDIF!][!//
  [!// Check that communication operations have unique indices
  [!SELECT "node:ref($FrIfCluster)/FrIfJobList"!]
    [!LOOP "FrIfJob/*"!]
      [!LOOP "FrIfCommunicationOperation/*"!]
        [!IF "text:tolower(text:uniq(../*/FrIfCommunicationOperationIdx, FrIfCommunicationOperationIdx)) = 'false'"!][!//
          [!ERROR!][!//
            [!WS "0"!]Error 033: [!"node:path(.)"!]/FrIfCommunicationOperationIdx is not unique within [!"node:path(../..)"!].
          [!ENDERROR!][!//
        [!ENDIF!]
      [!ENDLOOP!]
    [!ENDLOOP!]
  [!ENDSELECT!]
[!ENDMACRO!][!//
[!//
[!//
[!//
[!//
[!//
[!//
[!MACRO "ExtendedCfgChecks", "FrIfCluster" = "", "FrController" = "", "FIFOASlots" = "", "FIFOBSlots" = "", "Reconfigurations" = ""!][!//
  [!SELECT "(node:ref($FrIfCluster)/FrIfController/*[node:ref(FrIfFrCtrlRef)=node:ref($FrController)])"!][!//
    [!IF "$FrController = node:path(node:ref(FrIfFrCtrlRef))"!]
      [!VAR "MacKeySlotTransmitted" = "'false'"!][!//
      [!LOOP "node:order(FrIfLPdu/*,'node:value(FrIfLPduIdx)','node:name(.)')"!][!//
        [!VAR "MacLPduIndex" = "num:i(FrIfLPduIdx)"!][!//
        [!VAR "MacReconfigurable" = "text:tolower(node:value(FrIfReconfigurable))"!][!//
        [!VAR "MacLPduPath" = "node:path(.)"!][!//
        [!SELECT "node:ref(FrIfVBTriggeringRef)"!][!//
          [!WS "0"!][!// Check which LPdus are received into the FIFO A and check that they are not reconfigurable
          [!IF "node:name(node:ref(node:ref(FrIfFrameStructureRef)/FrIfPdusInFrame/*[position()=1]/FrIfPduRef)/FrIfPduDirection)='FrIfRxPdu'"!][!//
            [!WS "0"!][!/* Receive LPdu */!][!//
            [!IF "node:value(FrIfChannel) = 'FRIF_CHANNEL_A'"!][!//
              [!IF "text:contains(text:split(string($FIFOASlots)), string(FrIfSlotId))"!][!//
                [!INFO!][!//
                  [!WS "0"!]LPdu [!"$MacLPduIndex"!] will be received into the FIFO A.
                [!ENDINFO!][!//
                [!IF "$MacReconfigurable = 'true'"!][!//
                  [!ERROR!][!//
                    [!WS "0"!]Error 031: LPdu [!"$MacLPduIndex"!] ([!"$MacLPduPath"!]) will be received into the FIFO A but the FrIfReconfigurable is set.
                  [!ENDERROR!][!//
                [!ENDIF!][!//
              [!ENDIF!][!//
            [!ENDIF!][!//
            [!WS "0"!][!// Check which LPdus are received into the FIFO B and check that they are not reconfigurable
            [!IF "node:value(FrIfChannel) = 'FRIF_CHANNEL_B'"!][!//
              [!IF "text:contains(text:split(string($FIFOBSlots)), string(FrIfSlotId))"!][!//
                [!INFO!][!//
                  [!WS "0"!]LPdu [!"$MacLPduIndex"!] will be received into the FIFO B.
                [!ENDINFO!][!//
                [!IF "$MacReconfigurable = 'true'"!][!//
                  [!ERROR!][!//
                    [!WS "0"!]Error 032: LPdu [!"$MacLPduIndex"!] ([!"$MacLPduPath"!]) will be received into the FIFO B but the FrIfReconfigurable is set.
                  [!ENDERROR!][!//
                [!ENDIF!][!//
              [!ENDIF!][!//
            [!ENDIF!][!//
          [!ELSE!][!//
            [!WS "0"!][!/* Transmit LPdu */!][!//
            [!WS "0"!][!/* Check whether it is a Key Slot transmission LPdu */!][!//
              [!IF "'true' = text:tolower(node:value(node:ref($FrController)/FrPKeySlotUsedForStartup)) or 'true' = text:tolower(node:value(node:ref($FrController)/FrPKeySlotUsedForSync))"!][!//Check whether the Key slot is used/enabled
                [!IF "number(FrIfSlotId) = number(node:ref($FrController)/FrPKeySlotId) "!][!//
                  [!VAR "MacKeySlotTransmitted" = "'true'"!][!//
                [!ENDIF!][!//
              [!ENDIF!][!//
          [!ENDIF!][!//
          [!WS "0"!][!/* Check that reconfiguration is disabled for dynamic segment */!][!//
          [!IF "number(FrIfSlotId) > number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots)"!]
            [!IF "$MacReconfigurable = 'true'"!][!//
              [!ERROR!][!//
                [!WS "0"!]Error 029: LPdu [!"$MacLPduIndex"!] ([!"$MacLPduPath"!]) is configured for dynamic segment but FrIfReconfigurable is set.
              [!ENDERROR!][!//
            [!ENDIF!][!//
          [!ENDIF!][!//
        [!ENDSELECT!][!//
      [!ENDLOOP!][!//
      [!IF "'true' = text:tolower(node:value(node:ref($FrController)/FrPKeySlotUsedForStartup)) or 'true' = text:tolower(node:value(node:ref($FrController)/FrPKeySlotUsedForSync))"!][!//Check whether the Key slot is used/enabled
        [!IF "$MacKeySlotTransmitted != 'true'"!][!//
          [!WARNING!][!//
            [!WS "0"!]Warning 302: There is no LPdu assigned for the Key Slot transmission. There is no LPdu in the [!"node:path(.)"!] assined for Key Slot with pKeySlotId=[!"(node:value(node:ref($FrController)/FrPKeySlotId))"!] configured in the [!"$FrController"!] container. 
          [!ENDWARNING!][!//
        [!ENDIF!]
      [!ENDIF!]
    [!ENDIF!][!//
  [!ENDSELECT!][!//
[!ENDMACRO!][!//
[!//
[!//
[!//
[!//
[!//
[!//

[!MACRO "CrcCalculation" , "Sync" = "0", "Startup" = "0", "FrameId" = "1", "PayloadLengthW" = "8", "OutCrc"="1"!][!//
[!VAR "MacCrc"="0"!][!//
[!VAR "MacNextBit"="0"!][!//
[!VAR "MacCrcNextBit"="0"!][!//
[!VAR "MacCounter"="0"!][!//
[!VAR "MacCrc"="26"!][!//
[!VAR "MacCrcNextBit"="bit:xor(bit:and($Sync,1),(bit:and((bit:shr($MacCrc,10)),1)))"!][!//
[!VAR "MacCrc"="bit:shl($MacCrc,1)"!][!//
[!IF "$MacCrcNextBit!=0"!][!VAR "MacCrc"="bit:xor($MacCrc,901)"!][!ENDIF!][!//
[!VAR "MacNextBit"="bit:and($Startup,1)"!][!//
[!VAR "MacCrcNextBit"="bit:xor($MacNextBit,(bit:and((bit:shr($MacCrc,10)),1)))"!][!//
[!VAR "MacCrc"="bit:shl($MacCrc,1)"!][!//
[!IF "$MacCrcNextBit!=0"!][!VAR "MacCrc"="bit:xor($MacCrc,901)"!][!ENDIF!][!//
[!FOR "MacCounter"="10" TO "0" STEP "-1"!][!VAR "MacNextBit"="bit:and(bit:shr($FrameId,$MacCounter),1)"!][!VAR "MacCrcNextBit"="bit:xor($MacNextBit,(bit:and((bit:shr($MacCrc,10)),1)))"!][!VAR "MacCrc"="bit:shl($MacCrc,1)"!][!VAR "MacCrc"="bit:and($MacCrc,65535)"!][!IF "$MacCrcNextBit!=0"!][!VAR "MacCrc"="bit:xor($MacCrc,901)"!][!ENDIF!][!ENDFOR!][!//
[!FOR "MacCounter"="6" TO "0" STEP "-1"!][!VAR "MacNextBit"="bit:and(bit:shr($PayloadLengthW,$MacCounter),1)"!][!VAR "MacCrcNextBit"="bit:xor($MacNextBit,(bit:and((bit:shr($MacCrc,10)),1)))"!][!VAR "MacCrc"="bit:shl($MacCrc,1)"!][!VAR "MacCrc"="bit:and($MacCrc,65535)"!][!IF "$MacCrcNextBit!=0"!][!VAR "MacCrc"="bit:xor($MacCrc,901)"!][!ENDIF!][!ENDFOR!][!//
[!VAR "MacCrc"="(bit:and($MacCrc,2047))"!][!//
[!VAR "OutCrc"="$MacCrc"!][!//
[!ENDMACRO!]
[!//
[!//
[!//
[!//
[!//
[!//
[!/* This macro returns list of all slots received into the FIFO A and FIFOB */!][!//
[!MACRO "RxFIFOSlots", "FrIfCluster" = "", "FrController" = "", "OutFIFOASlots" = "", "OutFIFOBSlots" = ""!][!//
  [!VAR "OutFIFOBSlots" = "string('')"!][!//
  [!VAR "OutFIFOASlots" = "string('')"!][!//
  [!LOOP "(node:ref($FrController)/FrFifo/*)"!][!//
    [!IF "count(FrRange/*) > 0"!][!//
      [!LOOP "node:order(FrRange/*, 'node:value(FrVendorSpecific/FrRangeMode)', 'node:name(.)')"!][!//
        [!IF "node:value(../../FrChannels)='FR_CHANNEL_A'"!][!//
          [!IF "node:value(FrVendorSpecific/FrRangeMode)='FR_ACCEPTANCE'"!][!//
            [!VAR "OutFIFOASlots" = "concat($OutFIFOASlots,' ',text:join(text:range(node:value(FrRangeMin), node:value(FrRangeMax))))"!][!//
          [!ELSE!][!//
            [!VAR "Remove" = "text:join(text:range(node:value(FrRangeMin), node:value(FrRangeMax)))"!][!//
            [!VAR "Result" = "''"!][!//
            [!LOOP "text:split($OutFIFOASlots,' ')"!][!//
              [!VAR "TmpVal" = "number(.)"!][!//
              [!IF "count(text:split($Remove,' ')[number(.) = $TmpVal]) = 0"!][!//
                [!VAR "Result" = "concat($Result, ' ',number(.))"!][!//
              [!ENDIF!][!//
            [!ENDLOOP!][!//
            [!VAR "OutFIFOASlots" = "$Result"!][!//
          [!ENDIF!][!//
        [!ELSE!][!//
          [!IF "node:value(FrVendorSpecific/FrRangeMode)='FR_ACCEPTANCE'"!][!//
            [!VAR "OutFIFOBSlots" = "concat($OutFIFOBSlots,' ',text:join(text:range(node:value(FrRangeMin), node:value(FrRangeMax))))"!][!//
          [!ELSE!][!//
            [!VAR "Remove" = "text:join(text:range(node:value(FrRangeMin), node:value(FrRangeMax)))"!][!//
            [!VAR "Result" = "''"!][!//
            [!LOOP "text:split($OutFIFOBSlots,' ')"!][!//
              [!VAR "TmpVal" = "number(.)"!][!//
              [!IF "count(text:split($Remove,' ')[number(.) = $TmpVal]) = 0"!][!//
                [!VAR "Result" = "concat($Result, ' ',number(.))"!][!//
              [!ENDIF!][!//
            [!ENDLOOP!][!//
            [!VAR "OutFIFOBSlots" = "$Result"!][!//
          [!ENDIF!][!//
        [!ENDIF!][!//
      [!ENDLOOP!][!//
    [!ENDIF!][!//
  [!ENDLOOP!][!//
  [!VAR "OutFIFOASlots" = "text:replaceAll($OutFIFOASlots,'\.0','')"!][!//
  [!VAR "OutFIFOASlots" = "concat($OutFIFOASlots,' ')"!][!//
  [!VAR "OutFIFOBSlots" = "text:replaceAll($OutFIFOBSlots,'\.0','')"!][!//
  [!VAR "OutFIFOBSlots" = "concat($OutFIFOBSlots,' ')"!][!//
[!ENDMACRO!][!//
[!//
[!//
[!//
[!//
[!//
[!MACRO "LPduConfigs", "CfgVariant" = "string('PB')", "FrIfCluster" = "", "FrController" = "", "FIFOASlots" = "", "FIFOBSlots" = ""!][!//
  [!SELECT "(node:ref($FrIfCluster)/FrIfController/*[node:ref(FrIfFrCtrlRef)=node:ref($FrController)])"!][!//
    [!IF "$FrController = node:path(node:ref(FrIfFrCtrlRef))"!][!//
      [!LOOP "node:order(FrIfLPdu/*,'node:value(FrIfLPduIdx)','node:name(.)')"!][!//
        [!WS "0"!][!/* Use references FrIfLPdu->FrIfFrameTriggering->FrIfFrameStructur->FrIfPdu to obtain direction of the LPdu - all PDus in frame must have same direction*/!][!//
        [!IF "node:name(node:ref(node:ref(node:ref(FrIfVBTriggeringRef)/FrIfFrameStructureRef)/FrIfPdusInFrame/*[position()=1]/FrIfPduRef)/FrIfPduDirection)='FrIfRxPdu'"!][!//
          [!WS "0"!][!/* Receive LPDu */!][!//
          [!VAR "MacNotFifo" = "true()"!][!//
          [!IF "node:value(node:ref(FrIfVBTriggeringRef)/FrIfChannel)='FRIF_CHANNEL_A'"!]
            [!IF "text:contains(text:split(string($FIFOASlots)), string(number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)))"!][!//
              [!VAR "MacNotFifo" = "false()"!][!//
            [!ENDIF!][!//
          [!ENDIF!][!//
          [!IF "node:value(node:ref(FrIfVBTriggeringRef)/FrIfChannel)='FRIF_CHANNEL_B'"!]
            [!IF "text:contains(text:split(string($FIFOBSlots)), string(number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)))"!][!//
              [!VAR "MacNotFifo" = "false()"!][!//
            [!ENDIF!][!//
          [!ENDIF!][!//
          [!IF "text:tolower($MacNotFifo) = 'true'"!][!//
            [!CR!][!//
            [!WS "0"!]/*
            [!WS "0"!]* Configuration of LPdu specified by the FrIfLPdu container '[!"node:name(.)"!]'
            [!WS "0"!]* with an index FrIfLPduIdx = [!"num:i(FrIfLPduIdx)"!] and by the Frame Triggering
            [!WS "0"!]* FrIfVBTriggeringRef '[!"node:name(node:ref(FrIfVBTriggeringRef))"!]'
            [!WS "0"!]*/
            [!WS "0"!][!/* Build the structure name from the indices of LPdu, Controller, Cluster and Multiple configuration position within the */!][!//
            [!WS "0"!]/* @violates @ref FR_PBCFG_C_REF_4 */
            [!WS "0"!]static CONST(Fr_CCRxBufferConfigType, FR_CONST) [!//
            [!SELECT "node:ref($FrIfCluster)/../.."!][!//
              [!VAR "FrIfConfigId" = "position()"!][!//
            [!ENDSELECT!][!//
            [!WS "0"!]FrIfMC[!"$FrIfConfigId"!]_[!//
            [!WS "0"!]Clst[!"num:i(node:ref($FrIfCluster)/FrIfClstIdx)"!]_[!//
            [!WS "0"!]Ctrl[!"num:i(../../FrIfCtrlIdx)"!]_[!//
            [!WS "0"!]LPdu[!"num:i(FrIfLPduIdx)"!]_[!//
            [!WS "0"!]Cfg_[!"string($CfgVariant)"!] = [!//
            [!CR!]{[!//
            [!/* Get the information about the LPdu usage from the FrIfTriggering */!][!//
            [!SELECT "node:ref(FrIfVBTriggeringRef)"!][!//
              [!CR!][!WS "4"!][!"num:i(FrIfSlotId)"!]U, /* Receive Frame ID */
              [!WS "4"!][!"num:i(((FrIfLSduLength + 1) div 2))"!]U, /* Data Length in Words */
              [!IF "node:value(FrIfChannel)='FRIF_CHANNEL_A'"!]
                [!WS "4"!](VAR(boolean, FR_VAR))TRUE,   /* Reception on channel A enabled */
                [!WS "4"!](VAR(boolean, FR_VAR))FALSE,  /* Reception on channel B disabled */
              [!ELSEIF "node:value(FrIfChannel)='FRIF_CHANNEL_B'"!]
                [!WS "4"!](VAR(boolean, FR_VAR))FALSE,  /* Reception on channel A disabled */
                [!WS "4"!](VAR(boolean, FR_VAR))TRUE,   /* Reception on channel B enabled */
              [!ELSE!][!/* FRIF_CHANNEL_AB */!][!//
                [!WS "4"!](VAR(boolean, FR_VAR))TRUE,   /* Reception on channel A enabled */
                [!WS "4"!](VAR(boolean, FR_VAR))TRUE,   /* Reception on channel B enabled */
              [!ENDIF!][!//
              [!IF "node:value(FrIfCycleRepetition)!='1'"!]
                [!WS "4"!](VAR(boolean, FR_VAR))TRUE,   /* Cycle counter filtering enabled */
              [!ELSE!][!//
                [!WS "4"!](VAR(boolean, FR_VAR))FALSE,  /* Cycle counter filtering disabled */
              [!ENDIF!][!//
              [!WS "4"!][!"node:value(FrIfBaseCycle)"!]U, /* Cycle counter filter match value */
              [!WS "4"!][!"num:inttohex(node:value(FrIfCycleRepetition)-1,2)"!]U, /* Cycle counter filter mask (repetition each [!"node:value(FrIfCycleRepetition)"!] cycles) */
              [!IF "node:value(node:refs('ASPathDataOfSchema:/AUTOSAR/Fr')/FrGeneral/VendorSpecific/FrDisableDemReportErrorStatus) = 'false'"!][!//
                [!IF "node:exists(FrIfFrameTriggeringDemEventParameterRefs/FRIF_E_LPDU_SLOTSTATUS)"!][!//
                  [!IF "node:refvalid(FrIfFrameTriggeringDemEventParameterRefs/FRIF_E_LPDU_SLOTSTATUS) = false()"!][!//
                    [!WARNING!][!//
                    [!WS "0"!]Warning 114: FrIfFrameTriggeringDemEventParameterRefs/FRIF_E_LPDU_SLOTSTATUS of the '[!"node:name(.)"!]' has no reference to DemEventID
                    [!ENDWARNING!][!//
                  [!ENDIF!]
                [!ENDIF!][!//
              [!ELSE!]
                [!IF "node:refvalid(FrIfFrameTriggeringDemEventParameterRefs/FRIF_E_LPDU_SLOTSTATUS) = true()"!][!//
                  [!WARNING!]
                  [!WS "0"!]Warning 115: Dem reporting for the '[!"node:name(.)"!]' is disabled by the /FrGeneral/VendorSpecific/FrDisableDemReportErrorStatus configuration parameter
                  [!ENDWARNING!]
                [!ENDIF!][!//
              [!ENDIF!][!//
              [!IF "node:value(node:refs('ASPathDataOfSchema:/AUTOSAR/Fr')/FrGeneral/VendorSpecific/FrDisableDemReportErrorStatus) = 'false'"!][!// 
                [!IF "node:refvalid(FrIfFrameTriggeringDemEventParameterRefs/FRIF_E_LPDU_SLOTSTATUS) = true()"!][!//
                  [!WS "4"!]DemConf_DemEventParameter_[!"node:name(node:ref(FrIfFrameTriggeringDemEventParameterRefs/FRIF_E_LPDU_SLOTSTATUS))"!], /* DemFTSlotStatusID */
                  [!WS "4"!](VAR(boolean, FR_VAR))TRUE /* FrIfDemFTSlotStatusRef exist */
                [!ELSE!]
                  [!WS "4"!]0U, /* DemFTSlotStatusID not used */
                  [!WS "4"!](VAR(boolean, FR_VAR))FALSE /* FrIfDemFTSlotStatusRef does not exist */
                [!ENDIF!]
              [!ELSE!][!//
                [!WS "4"!]0U, /* DemFTSlotStatusID not used */
                [!WS "4"!](VAR(boolean, FR_VAR))FALSE /* FrIfDemFTSlotStatusRef does not exist */
              [!ENDIF!][!//
              [!WS "0"!]};
            [!ENDSELECT!][!//
          [!ENDIF!][!//
        [!ELSE!][!//
          [!CR!][!//
          [!WS "0"!][!/* Transmit LPDu */!][!//
          [!WS "0"!][!/* Build the structure name from the indices of LPdu, Controller, Cluster and Multiple configuration position within the */!][!//
          [!WS "0"!]/*
          [!WS "0"!]* Configuration of LPdu specified by the FrIfLPdu container '[!"node:name(.)"!]'
          [!WS "0"!]* with an index FrIfLPduIdx = [!"num:i(FrIfLPduIdx)"!] and by the Frame Triggering
          [!WS "0"!]* FrIfVBTriggeringRef '[!"node:name(node:ref(FrIfVBTriggeringRef))"!]'
          [!WS "0"!]*/
          [!WS "0"!]/* @violates @ref FR_PBCFG_C_REF_4 */
          [!WS "0"!]static CONST(Fr_CCTxBufferConfigType, FR_CONST) [!//
          [!SELECT "node:ref($FrIfCluster)/../.."!][!//
            [!VAR "FrIfConfigId" = "position()"!][!//
          [!ENDSELECT!][!//
          [!WS "0"!]FrIfMC[!"$FrIfConfigId"!]_[!//
          [!WS "0"!]Clst[!"num:i(node:ref($FrIfCluster)/FrIfClstIdx)"!]_[!//
          [!WS "0"!]Ctrl[!"num:i(../../FrIfCtrlIdx)"!]_[!//
          [!WS "0"!]LPdu[!"num:i(FrIfLPduIdx)"!]_[!//
          [!WS "0"!]Cfg_[!"string($CfgVariant)"!] = [!//
          [!CR!]{[!//
          [!WS "0"!][!/* Get the information about the LPdu usage from the FrIfTriggering */!][!//
          [!SELECT "node:ref(FrIfVBTriggeringRef)"!][!//
            [!CR!][!WS "4"!][!"num:i(FrIfSlotId)"!]U, /* Transmit Frame ID[!//
            [!VAR "MacSlotStartup"="0"!][!//
            [!VAR "MacSlotSync"="0"!][!//
            [!IF "'true' = text:tolower(node:value(node:ref($FrController)/FrPKeySlotUsedForStartup)) or 'true' = text:tolower(node:value(node:ref($FrController)/FrPKeySlotUsedForSync))"!][!//Check whether the Key slot is used/enabled
              [!IF "num:i(FrIfSlotId)=num:i(node:ref($FrController)/FrPKeySlotId)"!][!//
                [!IF "node:value(node:ref($FrController)/FrPKeySlotUsedForStartup)"!][!VAR "MacSlotStartup"="1"!][!ENDIF!][!//
                [!IF "node:value(node:ref($FrController)/FrPKeySlotUsedForSync)"!][!VAR "MacSlotSync"="1"!][!ENDIF!][!//
                [!WS "0"!], it is the Key Slot[!//
              [!ENDIF!][!//
            [!ENDIF!][!//
            [!WS "1"!]*/
            [!CALL "CrcCalculation", "Sync" = "number($MacSlotSync)", "Startup" = "number($MacSlotStartup)", "FrameId" = "num:i(FrIfSlotId)", "PayloadLengthW" = "num:i(((FrIfLSduLength + 1) div 2))", "OutCrc"="1"!][!//
            [!WS "4"!][!"num:inttohex($OutCrc,4)"!]U, /* Frame Header CRC */
            [!WS "4"!][!"num:i(((FrIfLSduLength + 1) div 2))"!]U, /* Data Length in Words */
            [!IF "node:value(FrIfChannel)='FRIF_CHANNEL_A'"!]
              [!WS "4"!](VAR(boolean, FR_VAR))TRUE,   /* Transmission on channel A enabled */
              [!WS "4"!](VAR(boolean, FR_VAR))FALSE,  /* Transmission on channel B disabled */
            [!ELSEIF "node:value(FrIfChannel)='FRIF_CHANNEL_B'"!]
              [!WS "4"!](VAR(boolean, FR_VAR))FALSE,  /* Transmission on channel A disabled */
              [!WS "4"!](VAR(boolean, FR_VAR))TRUE,   /* Transmission on channel B enabled */
            [!ELSE!][!/* FRIF_CHANNEL_AB */!][!//
              [!WS "4"!](VAR(boolean, FR_VAR))TRUE,   /* Transmission on channel A enabled */
              [!WS "4"!](VAR(boolean, FR_VAR))TRUE,   /* Transmission on channel B enabled */
            [!ENDIF!][!//
            [!IF "text:tolower(node:value(FrIfPayloadPreamble))='false'"!][!//
               [!WS "4"!](VAR(boolean, FR_VAR))FALSE,  /* Payload preamble disabled */
            [!ELSE!][!//
               [!WS "4"!](VAR(boolean, FR_VAR))TRUE,   /* Payload preamble enabled */
            [!ENDIF!][!//
            [!IF "node:value(FrIfCycleRepetition)!='1'"!]
              [!WS "4"!](VAR(boolean, FR_VAR))TRUE,   /* Cycle counter filtering enabled */
            [!ELSE!][!//
              [!WS "4"!](VAR(boolean, FR_VAR))FALSE,  /* Cycle counter filtering disabled */
            [!ENDIF!][!//
            [!WS "4"!][!"node:value(FrIfBaseCycle)"!]U, /* Cycle counter filter match value */
            [!WS "4"!][!"num:inttohex(node:value(FrIfCycleRepetition)-1,2)"!]U, /* Cycle counter filter mask (repetition each [!"node:value(FrIfCycleRepetition)"!] cycles) */
            [!IF "text:tolower(node:value(FrIfAllowDynamicLSduLength))='false'"!][!//
              [!WS "4"!](VAR(boolean, FR_VAR))FALSE,  /* Dynamic payload length disabled */
            [!ELSE!][!//
              [!WS "4"!](VAR(boolean, FR_VAR))TRUE,   /* Dynamic payload length enabled */
            [!ENDIF!][!//
            [!IF "node:value(node:refs('ASPathDataOfSchema:/AUTOSAR/Fr')/FrGeneral/VendorSpecific/FrDisableDemReportErrorStatus) = 'false'"!][!//
              [!IF "node:exists(FrIfFrameTriggeringDemEventParameterRefs/FRIF_E_LPDU_SLOTSTATUS)"!][!//
                [!IF "node:refvalid(FrIfFrameTriggeringDemEventParameterRefs/FRIF_E_LPDU_SLOTSTATUS) = false()"!][!//
                  [!WARNING!][!//
                  [!WS "0"!]Warning 114: FrIfFrameTriggeringDemEventParameterRefs/FRIF_E_LPDU_SLOTSTATUS of the '[!"node:name(.)"!]' has no reference to DemEventID
                  [!ENDWARNING!][!//
                [!ENDIF!]
              [!ENDIF!][!//
            [!ELSE!]
              [!IF "node:refvalid(FrIfFrameTriggeringDemEventParameterRefs/FRIF_E_LPDU_SLOTSTATUS) = true()"!][!//
                [!WARNING!]
                [!WS "0"!]Warning 115: Dem reporting for the '[!"node:name(.)"!]' is disabled by the /FrGeneral/VendorSpecific/FrDisableDemReportErrorStatus configuration parameter
                [!ENDWARNING!]
              [!ENDIF!][!//
            [!ENDIF!][!//
            [!IF "node:value(node:refs('ASPathDataOfSchema:/AUTOSAR/Fr')/FrGeneral/VendorSpecific/FrDisableDemReportErrorStatus) = 'false'"!][!// 
              [!IF "node:refvalid(FrIfFrameTriggeringDemEventParameterRefs/FRIF_E_LPDU_SLOTSTATUS) = true()"!][!//
                 [!WS "4"!]DemConf_DemEventParameter_[!"node:name(node:ref(FrIfFrameTriggeringDemEventParameterRefs/FRIF_E_LPDU_SLOTSTATUS))"!], /* DemFTSlotStatusID */
                 [!WS "4"!](VAR(boolean, FR_VAR))TRUE /* FrIfDemFTSlotStatusRef exist */
              [!ELSE!]
                 [!WS "4"!]0U, /* DemFTSlotStatusID not used */
                 [!WS "4"!](VAR(boolean, FR_VAR))FALSE /* FrIfDemFTSlotStatusRef does not exist */
              [!ENDIF!]
            [!ELSE!][!//
              [!WS "4"!]0U, /* DemFTSlotStatusID not used */
              [!WS "4"!](VAR(boolean, FR_VAR))FALSE /* FrIfDemFTSlotStatusRef does not exist */
            [!ENDIF!]
            [!WS "0"!]};
          [!ENDSELECT!][!//
        [!ENDIF!][!/* Receive and transmit */!][!//
      [!ENDLOOP!][!//
    [!ENDIF!][!//
  [!ENDSELECT!][!//
[!ENDMACRO!][!//
[!//
[!//
[!//
[!//
[!//
[!MACRO "LPduInfoCfg", "CfgVariant" = "string('PB')", "FrIfCluster" = "", "FrController" = "", "FIFOASlots" = "", "FIFOBSlots" = "", "Reconfigurations" = ""!][!//
  [!SELECT "(node:ref($FrIfCluster)/FrIfController/*[node:ref(FrIfFrCtrlRef)=node:ref($FrController)])"!][!//
    [!IF "$FrController = node:path(node:ref(FrIfFrCtrlRef))"!][!//
      [!VAR "MacFIFOACountS" = "count(FrIfLPdu/*[(node:value(node:ref(FrIfVBTriggeringRef)/FrIfChannel)='FRIF_CHANNEL_A') and (node:name(node:ref(node:ref(node:ref(FrIfVBTriggeringRef)/FrIfFrameStructureRef)/FrIfPdusInFrame/*[position()=1]/FrIfPduRef)/FrIfPduDirection)='FrIfRxPdu') and number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)<=number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots) and text:contains(text:split($FIFOASlots),num:i(node:ref(FrIfVBTriggeringRef)/FrIfSlotId))])"!][!//
      [!VAR "MacFIFOBCountS" = "count(FrIfLPdu/*[(node:value(node:ref(FrIfVBTriggeringRef)/FrIfChannel)='FRIF_CHANNEL_B') and (node:name(node:ref(node:ref(node:ref(FrIfVBTriggeringRef)/FrIfFrameStructureRef)/FrIfPdusInFrame/*[position()=1]/FrIfPduRef)/FrIfPduDirection)='FrIfRxPdu') and number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)<=number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots) and text:contains(text:split($FIFOBSlots),num:i(node:ref(FrIfVBTriggeringRef)/FrIfSlotId))])"!][!//
      [!VAR "MacFIFOAConfigured" = "false()"!][!//
      [!VAR "MacFIFOBConfigured" = "false()"!][!//
      [!VAR "MacStaticBuffersCnt" = "count(FrIfLPdu/*[number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)<=number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots)])"!][!//
      [!VAR "MacStaticBuffersCnt" = "num:i(($MacStaticBuffersCnt - $MacFIFOACountS) - $MacFIFOBCountS)"!][!//
      [!VAR "MacReconfigGroups" = "count(text:split($Reconfigurations, '#'))"!][!//
      [!VAR "MacBufferMasters" = "string('')"!][!//
      [!WS "0"!][!/* Check whether the node is connected to one or two channels */!][!//
      [!VAR "MacStaticPosition" = "num:i(0)"!][!/* Counter of used buffers in the static segment */!][!//
      [!VAR "MacDynamicPosition" = "num:i(0)"!][!/* Couter of used buffers in the dynamicsegment */!][!//
      [!CR!][!//
      [!WS "0"!]/* This structure contains information about all LPdus: buffer type, configuration details,
      [!WS "0"!] assigned buffer whether the buffer shall be configured at the beginning and whether
      [!WS "0"!] the buffer is reconfigurable */
      [!WS "0"!]/* @violates @ref FR_PBCFG_C_REF_4 */
      [!SELECT "node:ref($FrIfCluster)/../.."!][!//
        [!VAR "FrIfConfigIndex" = "position()"!][!//
      [!ENDSELECT!][!//
      [!WS "0"!]static CONST(Fr_CCLpduInfoType, FR_CONST) FrIfMC[!"$FrIfConfigIndex"!]_Clst[!"num:i(node:ref($FrIfCluster)/FrIfClstIdx)"!]_Ctrl[!"num:i(FrIfCtrlIdx)"!]_LPduInfoCfgSet_[!"string($CfgVariant)"!][] = [!//
      [!CR!]{[!//
      [!WS "0"!][!/* Go through all LPdus */!][!//
      [!VAR "MacComma" = "''"!][!//
      [!VAR "MacFifoALpdu" = "''"!][!//
      [!VAR "MacFifoBLpdu" = "''"!][!//
      [!VAR "MacFifoAMatch" = "false()"!][!//
      [!VAR "MacFifoBMatch" = "false()"!][!//
      [!LOOP "node:order(FrIfLPdu/*,'node:value(FrIfLPduIdx)','node:name(.)')"!][!//
        [!WS "0"!][!/* Check whether it is a receive LPdu */!][!//
        [!WS "0"!][!"$MacComma"!][!CR!][!//
        [!VAR "MacNotFifo" = "true()"!][!//
        [!VAR "MacReconfig" = "node:value(FrIfReconfigurable)"!][!//
        [!IF "node:name(node:ref(node:ref(node:ref(FrIfVBTriggeringRef)/FrIfFrameStructureRef)/FrIfPdusInFrame/*[position()=1]/FrIfPduRef)/FrIfPduDirection)='FrIfRxPdu'"!][!//
          [!WS "0"!][!/* RX LPdu; Check whether it is received into a FIFO */!][!//
          [!IF "node:value(node:ref(FrIfVBTriggeringRef)/FrIfChannel)='FRIF_CHANNEL_A'"!][!//
            [!VAR "MacTmpFrIfSlotId" = "string(number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId))"!][!//
            [!VAR "MacTmpFrIfSlotId" = "concat(' ',$MacTmpFrIfSlotId,' ')"!][!//
            [!IF "text:contains(string($FIFOASlots), $MacTmpFrIfSlotId)"!][!//
              [!VAR "MacFifoAMatch" = "true()"!][!//
              [!IF "text:tolower($MacFIFOAConfigured) = 'true'"!][!//
                [!WARNING!][!//
                   [!WS "0"!]Warning 306: Lpdu with FrIfLPduIdx=[!"num:i(FrIfLPduIdx)"!] was assigned to FIFO A but there is another LPdu with FrIfLPduIdx=[!"num:i($MacFifoALpdu)"!] already assigned to FIFO A in the [!"node:path(node:ref($FrIfCluster)/FrIfController/*[node:ref($FrController)]/FrIfLPdu/*[num:i($MacFifoALpdu + 1)])"!].
                [!ENDWARNING!][!//
              [!ELSE!][!//
                [!VAR "MacFifoALpdu" = "num:i(FrIfLPduIdx)"!][!//
              [!ENDIF!][!//
              [!VAR "MacNotFifo" = "false()"!][!//
              [!WS "4"!]{FR_FIFOA_BUFFER,   [!//
              [!WS "1"!]&FrIfMC[!"$FrIfConfigIndex"!]_[!//
              [!WS "0"!]Clst[!"num:i(node:ref($FrIfCluster)/FrIfClstIdx)"!]_[!//
              [!WS "0"!]Ctrl[!"num:i(../../FrIfCtrlIdx)"!]_[!//
              [!WS "0"!]FIFOA_[!//
              [!WS "0"!]Cfg_[!"string($CfgVariant)"!],[!//
              [!WS "1"!]255U, (VAR(boolean, FR_VAR))TRUE, (VAR(boolean, FR_VAR))FALSE}[!//
              [!VAR "MacComma" = "concat(', /* LPdu ', num:i(FrIfLPduIdx),' */')"!][!//
              [!VAR "MacFIFOAConfigured" = "true()"!][!//
            [!ENDIF!][!//
          [!ENDIF!][!//
          [!IF "node:value(node:ref(FrIfVBTriggeringRef)/FrIfChannel)='FRIF_CHANNEL_B'"!][!//
            [!VAR "MacTmpFrIfSlotId" = "string(number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId))"!][!//
            [!VAR "MacTmpFrIfSlotId" = "concat(' ',$MacTmpFrIfSlotId,' ')"!][!//
            [!IF "text:contains(string($FIFOBSlots), $MacTmpFrIfSlotId)"!][!//
              [!VAR "MacFifoBMatch" = "true()"!][!//
              [!IF "text:tolower($MacFIFOBConfigured) = 'true'"!][!//
                [!WARNING!][!//
                   [!WS "0"!]Warning 307: Lpdu with FrIfLPduIdx=[!"num:i(FrIfLPduIdx)"!] was assigned to FIFO B but there is another LPdu with FrIfLPduIdx=[!"num:i($MacFifoBLpdu)"!] already assigned to FIFO B it the [!"node:path(node:ref($FrIfCluster)/FrIfController/*[node:ref($FrController)]/FrIfLPdu/*[($MacFifoBLpdu)])"!].
                [!ENDWARNING!][!//
              [!ELSE!][!//
                [!VAR "MacFifoBLpdu" = "num:i(FrIfLPduIdx)"!][!//
              [!ENDIF!][!//
              [!VAR "MacNotFifo" = "false()"!][!//
              [!WS "4"!]{FR_FIFOB_BUFFER,   [!//
              [!WS "1"!]&FrIfMC[!"$FrIfConfigIndex"!]_[!//
              [!WS "0"!]Clst[!"num:i(node:ref($FrIfCluster)/FrIfClstIdx)"!]_[!//
              [!WS "0"!]Ctrl[!"num:i(../../FrIfCtrlIdx)"!]_[!//
              [!WS "0"!]FIFOB_[!//
              [!WS "0"!]Cfg_[!"string($CfgVariant)"!],[!//
              [!WS "1"!]255U, (VAR(boolean, FR_VAR))TRUE, (VAR(boolean, FR_VAR))FALSE}[!//
              [!VAR "MacComma" = "concat(', /* LPdu ', num:i(FrIfLPduIdx),' */')"!][!//
              [!VAR "MacFIFOBConfigured" = "true()"!][!//
            [!ENDIF!][!//
          [!ENDIF!][!//
          [!IF "text:tolower($MacNotFifo) = 'true'"!][!//
            [!WS "4"!]{FR_RECEIVE_BUFFER, [!//
          [!ENDIF!][!//
        [!ELSE!][!//
          [!WS "0"!][!/* Tx LPdu; Check whether it is in FIFO ID range*/!][!//
          [!IF "node:value(node:ref(FrIfVBTriggeringRef)/FrIfChannel)='FRIF_CHANNEL_A'"!][!//
            [!VAR "MacTmpFrIfSlotId" = "string(number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId))"!][!//
            [!VAR "MacTmpFrIfSlotId" = "concat(' ',$MacTmpFrIfSlotId,' ')"!][!//
            [!IF "text:contains(string($FIFOASlots), $MacTmpFrIfSlotId)"!][!//
                [!WARNING!][!//
                  [!WS "0"!]Warning 316: Lpdu with FrIfLPduIdx=[!"num:i(FrIfLPduIdx)"!] is a transmit Lpdu and its frame ID is in FIFOA ID range.
                [!ENDWARNING!][!//
            [!ENDIF!][!//
          [!ENDIF!][!//
          [!IF "node:value(node:ref(FrIfVBTriggeringRef)/FrIfChannel)='FRIF_CHANNEL_B'"!][!//
            [!VAR "MacTmpFrIfSlotId" = "string(number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId))"!][!//
            [!VAR "MacTmpFrIfSlotId" = "concat(' ',$MacTmpFrIfSlotId,' ')"!][!//
            [!IF "text:contains(string($FIFOBSlots), $MacTmpFrIfSlotId)"!][!//
                [!WARNING!][!//
                  [!WS "0"!]Warning 317: Lpdu with FrIfLPduIdx=[!"num:i(FrIfLPduIdx)"!] is a transmit Lpdu and its frame ID is in FIFOB ID range.
                [!ENDWARNING!][!//
            [!ENDIF!][!//  
          [!ENDIF!][!//
          [!WS "4"!]{FR_TRANSMIT_BUFFER,[!//
        [!ENDIF!][!/* Receive or transmit LPdu */!][!//
        [!IF "text:tolower($MacNotFifo) = 'true'"!][!/* Append the line end if it is not a FIFO LPdu */!][!//
          [!WS "1"!]&FrIfMC[!"$FrIfConfigIndex"!]_[!//
          [!WS "0"!]Clst[!"num:i(node:ref($FrIfCluster)/FrIfClstIdx)"!]_[!//
          [!WS "0"!]Ctrl[!"num:i(../../FrIfCtrlIdx)"!]_[!//
          [!WS "0"!]LPdu[!"num:i(FrIfLPduIdx)"!]_[!//
          [!WS "0"!]Cfg_[!"string($CfgVariant)"!],[!//
          [!IF "number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)>number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots)"!][!/* Static or dynamic slot? */!][!//
            [!WS "1"!][!"num:i($MacStaticBuffersCnt - $MacReconfigGroups + $MacDynamicPosition)"!]U,[!/* Dynamic slot, no reconfiguration possible, just count buffers before */!][!//
            [!WS "1"!](VAR(boolean, FR_VAR))TRUE, (VAR(boolean, FR_VAR))FALSE[!//
            [!VAR "MacDynamicPosition" = "$MacDynamicPosition + 1"!][!//
          [!ELSE!][!//
            [!VAR "MacLPduIdx" = "num:i(FrIfLPduIdx)"!][!//
            [!VAR "MacReconfigurable"="'false'"!][!//
            [!LOOP "text:split($Reconfigurations, '#')"!][!/* Go through all groups of LPdus sharing one buffer */!][!//
              [!VAR "MacRMaster" = "text:split(.,' ')[1]"!][!/* Master LPdu will have own the buffer and share it with the slaves - the rest of the group */!][!//
              [!LOOP "text:split(.,' ')"!][!//
                [!IF "num:i(.)=$MacLPduIdx"!][!/* Check whether the current LPdu is in the group */!][!//
                   [!VAR "MacReconfigurable"="'true'"!][!//
                   [!IF "text:tolower(text:contains(string($MacBufferMasters), concat('#',$MacRMaster,' ')))='true'"!][!/* Check whether the group has already a master */!][!//
                     [!WS "1"!][!"text:split(text:grep(text:split($MacBufferMasters, '#'),concat('^',$MacRMaster, ' [0-9]*')))[2]"!]U,[!/* There is already a master, this LPdu will use the same buffer */!][!//
                     [!WS "1"!](VAR(boolean, FR_VAR))FALSE,[!//
                     [!IF "text:tolower($MacReconfig) = 'true'"!][!//
                       [!WS "1"!](VAR(boolean, FR_VAR))TRUE[!//
                     [!ELSE!][!//
                     [!WS "1"!](VAR(boolean, FR_VAR))FALSE[!//
                     [!ENDIF!]
                   [!ELSE!]
                     [!VAR "MacBufferMasters" = "concat($MacBufferMasters, '#', $MacRMaster, ' ', $MacStaticPosition)"!][!/* No master yet, this LPdu will be a master - assign it a buffer and save this info */!][!//
                     [!WS "1"!][!"num:i($MacStaticPosition)"!]U,[!//
                     [!VAR "MacStaticPosition" = "num:i($MacStaticPosition + 1)"!][!//
                     [!WS "1"!](VAR(boolean, FR_VAR))TRUE,[!//
                     [!IF "text:tolower($MacReconfig) = 'true'"!][!//
                       [!WS "1"!](VAR(boolean, FR_VAR))TRUE[!//
                     [!ELSE!][!//
                       [!WS "1"!](VAR(boolean, FR_VAR))FALSE[!//
                     [!ENDIF!][!//
                   [!ENDIF!][!//
                [!ENDIF!][!//
              [!ENDLOOP!][!//
            [!ENDLOOP!][!//
            [!IF "$MacReconfigurable='false'"!][!/* This LPdu is not reconfigured so assign it an own buffer */!][!//
              [!WS "1"!][!"num:i($MacStaticPosition)"!]U,[!//
              [!VAR "MacStaticPosition" = "num:i($MacStaticPosition + 1)"!][!//
              [!WS "1"!](VAR(boolean, FR_VAR))TRUE,[!//
              [!IF "text:tolower($MacReconfig) = 'true'"!][!//
                  [!WS "1"!](VAR(boolean, FR_VAR))TRUE[!//
              [!ELSE!][!//
                  [!WS "1"!](VAR(boolean, FR_VAR))FALSE[!//
              [!ENDIF!][!//
             [!ENDIF!][!//
          [!ENDIF!][!//
          [!WS "0"!]}[!//
          [!VAR "MacComma" = "concat(', /* LPdu ', num:i(FrIfLPduIdx),' */')"!][!//
        [!ENDIF!][!//
      [!ENDLOOP!][!//
      [!WS "0"!][!"substring-after($MacComma,',')"!][!CR!]};
      [!IF "string($FIFOASlots) != " ""!][!//
        [!IF "text:tolower($MacFifoAMatch) = 'false'"!][!//
          [!WARNING!][!//
            [!WS "0"!]Warning 308: There is no LPdu matching FIFO A criteria for [!"node:path(node:ref($FrIfCluster)/FrIfController/*[node:ref($FrController)]/FrIfLPdu)"!].
          [!ENDWARNING!][!//
        [!ENDIF!][!//
      [!ENDIF!][!//
      [!IF "string($FIFOBSlots) != " ""!][!//
        [!IF "text:tolower($MacFifoBMatch) = 'false'"!][!//
          [!WARNING!][!//
            [!WS "0"!]Warning 309: There is no LPdu matching FIFO B criteria for [!"node:path(node:ref($FrIfCluster)/FrIfController/*[node:ref($FrController)]/FrIfLPdu)"!].
          [!ENDWARNING!][!//
        [!ENDIF!][!//
      [!ENDIF!][!//
    [!ENDIF!][!//
  [!ENDSELECT!][!//
[!ENDMACRO!][!//
[!//
[!//
[!//
[!//
[!//
[!MACRO "BufferAddresses", "CfgVariant" = "string('PB')", "FrIfCluster" = "", "FrController" = "", "FIFOASlots" = "", "FIFOBSlots" = "", "Reconfigurations" = ""!][!//
  [!VAR "MacStaticPayload" = "num:i(node:ref($FrIfCluster)/FrIfGPayloadLengthStatic) * 2"!][!//
  [!VAR "MacDynamicPayload" = "num:i(node:ref($FrController)/FrPPayloadLengthDynMax) * 2"!][!//
  [!WS "0"!][!/* Get numbers of buffers used for reception in static and dynamic segment and numbers of FIFO buffers */!][!//
  [!SELECT "(node:ref($FrIfCluster)/FrIfController/*[node:ref(FrIfFrCtrlRef)=node:ref($FrController)])"!][!//
  [!IF "$FrController = node:path(node:ref(FrIfFrCtrlRef))"!][!//
    [!VAR "MacStaticBuffersCnt" = "count(FrIfLPdu/*[number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)<=number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots)])"!][!//
    [!VAR "MacDynamicBuffersCnt" = "count(FrIfLPdu/*[number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)>number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots)])"!][!//
    [!VAR "MacStaticBuffersCnt" = "$MacStaticBuffersCnt - count(text:split($Reconfigurations, '#'))"!][!/* Remove reconfigured buffers */!][!//
    [!VAR "MacFIFOACountS" = "count(FrIfLPdu/*[(node:value(node:ref(FrIfVBTriggeringRef)/FrIfChannel)='FRIF_CHANNEL_A') and (node:name(node:ref(node:ref(node:ref(FrIfVBTriggeringRef)/FrIfFrameStructureRef)/FrIfPdusInFrame/*[position()=1]/FrIfPduRef)/FrIfPduDirection)='FrIfRxPdu') and number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)<=number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots) and text:contains(text:split($FIFOASlots),num:i(node:ref(FrIfVBTriggeringRef)/FrIfSlotId))])"!]
    [!VAR "MacFIFOBCountS" = "count(FrIfLPdu/*[(node:value(node:ref(FrIfVBTriggeringRef)/FrIfChannel)='FRIF_CHANNEL_B') and (node:name(node:ref(node:ref(node:ref(FrIfVBTriggeringRef)/FrIfFrameStructureRef)/FrIfPdusInFrame/*[position()=1]/FrIfPduRef)/FrIfPduDirection)='FrIfRxPdu') and number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)<=number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots) and text:contains(text:split($FIFOBSlots),num:i(node:ref(FrIfVBTriggeringRef)/FrIfSlotId))])"!]
    [!VAR "MacFIFOACountD" = "count(FrIfLPdu/*[(node:value(node:ref(FrIfVBTriggeringRef)/FrIfChannel)='FRIF_CHANNEL_A') and (node:name(node:ref(node:ref(node:ref(FrIfVBTriggeringRef)/FrIfFrameStructureRef)/FrIfPdusInFrame/*[position()=1]/FrIfPduRef)/FrIfPduDirection)='FrIfRxPdu') and number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)>number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots) and text:contains(text:split($FIFOASlots),num:i(node:ref(FrIfVBTriggeringRef)/FrIfSlotId))])"!]
    [!VAR "MacFIFOBCountD" = "count(FrIfLPdu/*[(node:value(node:ref(FrIfVBTriggeringRef)/FrIfChannel)='FRIF_CHANNEL_B') and (node:name(node:ref(node:ref(node:ref(FrIfVBTriggeringRef)/FrIfFrameStructureRef)/FrIfPdusInFrame/*[position()=1]/FrIfPduRef)/FrIfPduDirection)='FrIfRxPdu') and number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)>number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots) and text:contains(text:split($FIFOBSlots),num:i(node:ref(FrIfVBTriggeringRef)/FrIfSlotId))])"!]
    [!VAR "MacCtrlIdx" = "num:i(FrIfCtrlIdx)"!][!//
    [!WS "0"!][!/* Remove FIFO buffers to get correct number of buffers used for individual frame reception */!][!//
    [!VAR "MacStaticBuffersCnt" = "num:i(($MacStaticBuffersCnt - $MacFIFOACountS) - $MacFIFOBCountS)"!]
    [!VAR "MacDynamicBuffersCnt" = "num:i(($MacDynamicBuffersCnt - $MacFIFOACountD) - $MacFIFOBCountD)"!]
    [!WS "0"!][!/* Get number of shadow buffers - check if they are used or not */!][!//
    [!VAR "MacShadowCount1" = "num:i(0)"!][!//
    [!VAR "MacShadowCount2" = "num:i(0)"!][!//
    [!IF "text:tolower(node:value(node:ref($FrController)/VendorSpecific/SingleChannelModeEnabled))='true'"!][!//
      [!IF "number($MacStaticBuffersCnt) > 0"!][!//
        [!VAR "MacShadowCount1" = "num:i($MacShadowCount1 + 1)"!][!//
      [!ENDIF!][!//
      [!IF "number($MacDynamicBuffersCnt) > 0"!][!//
        [!VAR "MacShadowCount2" = "num:i($MacShadowCount2 + 1)"!][!//
      [!ENDIF!][!//
    [!ELSE!][!//
      [!IF "number($MacStaticBuffersCnt) > 0"!][!//
        [!VAR "MacShadowCount1" = "num:i($MacShadowCount1 + 2)"!][!//
      [!ENDIF!][!//
      [!IF "number($MacDynamicBuffersCnt) > 0"!][!//
        [!VAR "MacShadowCount2" = "num:i($MacShadowCount2 + 2)"!][!//
      [!ENDIF!][!//
    [!ENDIF!][!//
    [!WS "0"!][!/* Get payload length for FIFOs - use greater of lengths of segments, where the FIFO is used */!][!//
    [!IF "$MacFIFOACountS > 0"!][!//
      [!VAR "MacFIFOLengthS" = "$MacStaticPayload"!][!//
    [!ELSE!][!//
      [!VAR "MacFIFOLengthS" = "0"!][!//
    [!ENDIF!][!//
    [!IF "$MacFIFOACountD > 0"!][!//
      [!VAR "MacFIFOLengthD" = "$MacDynamicPayload"!][!//
    [!ELSE!][!//
      [!VAR "MacFIFOLengthD" = "0"!][!//
    [!ENDIF!][!//
    [!IF "$MacFIFOLengthD > $MacFIFOLengthS"!][!//
      [!VAR "MacFIFOALength" = "$MacFIFOLengthD"!][!//
    [!ELSE!][!//
      [!VAR "MacFIFOALength" = "$MacFIFOLengthS"!][!//
    [!ENDIF!][!//
    [!IF "$MacFIFOBCountS > 0"!][!//
      [!VAR "MacFIFOLengthS" = "$MacStaticPayload"!][!//
    [!ELSE!][!//
      [!VAR "MacFIFOLengthS" = "0"!][!//
    [!ENDIF!][!//
    [!IF "$MacFIFOBCountD > 0"!][!//
      [!VAR "MacFIFOLengthD" = "$MacDynamicPayload"!][!//
    [!ELSE!][!//
      [!VAR "MacFIFOLengthD" = "0"!][!//
    [!ENDIF!][!//
    [!IF "$MacFIFOLengthD > $MacFIFOLengthS"!][!//
      [!VAR "MacFIFOBLength" = "$MacFIFOLengthD"!][!//
    [!ELSE!][!//
      [!VAR "MacFIFOBLength" = "$MacFIFOLengthS"!][!//
    [!ENDIF!][!//
    [!VAR "MacFIFOADepth" = "0"!][!//
    [!VAR "MacFIFOBDepth" = "0"!][!//
    [!IF "($MacFIFOACountS + $MacFIFOACountD) > 0"!][!//
      [!VAR "MacFIFOADepth" = "number(node:ref($FrController)/FrFifo/*[node:value(FrChannels)='FR_CHANNEL_A']/FrFifoDepth)"!][!//
    [!ENDIF!]
    [!IF "($MacFIFOBCountS + $MacFIFOBCountD) > 0"!][!//
      [!VAR "MacFIFOBDepth" = "number(node:ref($FrController)/FrFifo/*[node:value(FrChannels)='FR_CHANNEL_B']/FrFifoDepth)"!][!//
    [!ENDIF!]
    [!IF "($MacFIFOADepth + $MacFIFOBDepth) > 255"!][!//
      [!ERROR!][!//
        [!WS "0"!]Error 043: Maximum FIFO depth 255 entries was exceeded!
      [!ENDERROR!][!//
    [!ENDIF!][!//  
    [!WS "0"!][!/* Compute size of the memory used for buffer headers */!][!//
    [!VAR "MacHeadersSize" = "num:i(($MacFIFOADepth + $MacFIFOBDepth + $MacShadowCount2 + $MacShadowCount1 + $MacDynamicBuffersCnt + $MacStaticBuffersCnt) * $MBHeaderLength)"!][!//
    [!WS "0"!][!/* Compute how many bytes must be added to headers memory to get address aligned at 4 bytes - memory for data areas */!][!//
    [!VAR "AllignPad" = "num:i(bit:and(num:i($MacHeadersSize + 3), num:hextoint('0xFFFFFFFC')) - $MacHeadersSize)"!][!//
    [!WS "0"!][!/* Make payloads divisible by 4 to mainatain the buffers alignment */!][!//
    [!VAR "MacStaticPayload" = "num:i(bit:and(num:i($MacStaticPayload + 3), num:hextoint('0xFFFFFFFC')))"!][!/* Adjust to be a multiple of 4 */!][!//
    [!VAR "MacDynamicPayload" = "num:i(bit:and(num:i($MacDynamicPayload + 3), num:hextoint('0xFFFFFFFC')))"!][!/* Adjust to be a multiple of 4 */!][!//
    [!VAR "MacFIFOALength" = "num:i(bit:and(num:i($MacFIFOALength + 3), num:hextoint('0xFFFFFFFC')))"!][!/* Adjust to be a multiple of 4 */!][!//
    [!VAR "MacFIFOBLength" = "num:i(bit:and(num:i($MacFIFOBLength + 3), num:hextoint('0xFFFFFFFC')))"!][!/* Adjust to be a multiple of 4 */!][!//
    [!CR!][!//
    [!WS "0"!]/*
    [!WS "0"!]* Fr MEMORY LAYOUT - Allocated by the Fr_MemoryArea[] array
    [!WS "0"!]* ----------------
    [!WS "0"!]* Buffer headers: [!"$MacStaticBuffersCnt"!] + [!//
             [!WS "0"!][!"$MacDynamicBuffersCnt"!] + [!//
             [!WS "0"!][!"$MacShadowCount1"!] + [!//
             [!WS "0"!][!"$MacShadowCount2"!] + [!//
             [!WS "0"!][!"num:i($MacFIFOADepth)"!] + [!//
             [!WS "0"!][!"num:i($MacFIFOBDepth)"!] = [!//
             [!WS "0"!][!"num:i($MacStaticBuffersCnt + $MacDynamicBuffersCnt + $MacShadowCount1 + $MacShadowCount2 + $MacFIFOADepth + $MacFIFOBDepth)"!] [!//
             [!WS "0"!] Buffers * [!"num:i($MBHeaderLength)"!] Bytes = [!"$MacHeadersSize"!] Bytes
    [!WS "0"!]* Padding to 4-byte boundary: [!"$AllignPad"!] Bytes
    [!WS "0"!]* Buffers in segment 1: [!"$MacStaticBuffersCnt"!] Buffers * [!"$MacStaticPayload"!] Bytes
    [!WS "0"!]* Buffers in segment 2: [!"$MacDynamicBuffersCnt"!] Buffers * [!"$MacDynamicPayload"!] Bytes
    [!WS "0"!]* Receive shadow buffers segment 1: [!"$MacShadowCount1"!] Buffers * [!"$MacStaticPayload"!] Bytes
    [!WS "0"!]* Receive shadow buffers segment 2: [!"$MacShadowCount2"!] Buffers * [!"$MacDynamicPayload"!] Bytes
    [!WS "0"!]* FIFO A buffers: [!"num:i($MacFIFOADepth)"!] Buffers * [!"num:i($MacFIFOALength)"!] Bytes
    [!WS "0"!]* FIFO B buffers: [!"num:i($MacFIFOBDepth)"!] Buffers * [!"num:i($MacFIFOBLength)"!] Bytes
    [!VAR "SFTOR" = "num:i($MacHeadersSize + $AllignPad + ($MacStaticBuffersCnt * $MacStaticPayload) + ($MacDynamicBuffersCnt * $MacDynamicPayload) + ($MacShadowCount1 * $MacStaticPayload) + ($MacShadowCount2 * $MacDynamicPayload) + ($MacFIFOADepth * $MacFIFOALength) + ($MacFIFOBDepth * $MacFIFOBLength))"!][!//
    [!WS "0"!]* Synchronization tables : 2 * 120 Bytes
    [!WS "0"!]*
    [!WS "0"!]* Note: Buffer sizes were adjusted to multiple of 4 bytes because of alignments
    [!WS "0"!]*
    [!WS "0"!]* Used memory size is [!"num:i($SFTOR + 240)"!] Bytes.
    [!WS "0"!]*/
    [!CR!][!//
    [!WS "0"!]/* Array of this type contains offsets of the message buffer data
    [!WS "0"!] fields from the Fr Memory Base Address */
    [!WS "0"!]/* @violates @ref FR_PBCFG_C_REF_4 */
    [!WS "0"!]static CONST(Fr_CCBufferOffset16Type, FR_CONST)[!//
    [!SELECT "node:ref($FrIfCluster)/../.."!][!//
      [!VAR "FrIfConfigIndex" = "position()"!][!//
    [!ENDSELECT!][!//
    [!WS "1"!]FrIfMC[!"$FrIfConfigIndex"!]_Clst[!"num:i(node:ref($FrIfCluster)/FrIfClstIdx)"!]_Ctrl[!"$MacCtrlIdx"!]_BOffset16Table_[!"string($CfgVariant)"!][] =
    [!WS "0"!]{[!//
    [!VAR "MacComma" = "''"!][!//
    [!VAR "MacBeginning" = "$AllignPad + $MacHeadersSize"!][!//
    [!VAR "MacAbsCntr" = "0"!][!//
    [!FOR "MacCntr" = "0" TO "$MacStaticBuffersCnt - 1"!][!//
      [!WS "0"!][!"$MacComma"!][!CR!][!//
      [!WS "4"!]{[!"num:i($MacBeginning + ($MacCntr * $MacStaticPayload))"!]U}[!//
      [!VAR "MacComma" = "concat(', /* ',num:i($MacAbsCntr),': Segment 1, Buffer ',num:i($MacCntr + 1),' */')"!][!//
      [!VAR "MacAbsCntr" = "$MacAbsCntr + 1"!][!//
    [!ENDFOR!][!//
    [!VAR "MacBeginning" = "$MacBeginning + ($MacStaticBuffersCnt * $MacStaticPayload)"!][!//
    [!FOR "MacCntr" = "0" TO "$MacDynamicBuffersCnt - 1"!][!//
      [!WS "0"!][!"$MacComma"!][!CR!][!//
      [!WS "4"!]{[!"num:i($MacBeginning + ($MacCntr * $MacDynamicPayload))"!]U}[!//
      [!VAR "MacComma" = "concat(', /* ',num:i($MacAbsCntr),': Segment 2, Buffer ',num:i($MacCntr + 1),' */')"!][!//
      [!VAR "MacAbsCntr" = "$MacAbsCntr + 1"!][!//
    [!ENDFOR!][!//
    [!VAR "MacBeginning" = "$MacBeginning + ($MacDynamicBuffersCnt * $MacDynamicPayload)"!][!//
    [!FOR "MacCntr" = "0" TO "$MacShadowCount1 - 1"!][!//
      [!WS "0"!][!"$MacComma"!][!CR!][!//
      [!WS "4"!]{[!"num:i($MacBeginning + ($MacCntr * $MacStaticPayload))"!]U}[!//
      [!VAR "MacComma" = "concat(', /* ',num:i($MacAbsCntr),': Segment 1, Receive Shadow Buffer ',num:i($MacCntr + 1),' */')"!][!//
      [!VAR "MacAbsCntr" = "$MacAbsCntr + 1"!][!//
    [!ENDFOR!][!//
    [!VAR "MacBeginning" = "$MacBeginning + ($MacShadowCount1 * $MacStaticPayload)"!][!//
    [!FOR "MacCntr" = "0" TO "$MacShadowCount2 - 1"!][!//
      [!WS "0"!][!"$MacComma"!][!CR!][!//
      [!WS "4"!]{[!"num:i($MacBeginning + ($MacCntr * $MacDynamicPayload))"!]U}[!//
      [!VAR "MacComma" = "concat(', /* ',num:i($MacAbsCntr),': Segment 2, Receive Shadow Buffer ',num:i($MacCntr + 1),' */')"!][!//
      [!VAR "MacAbsCntr" = "$MacAbsCntr + 1"!][!//
    [!ENDFOR!][!//
    [!VAR "MacBeginning" = "$MacBeginning + ($MacShadowCount2 * $MacDynamicPayload)"!][!//
    [!FOR "MacCntr" = "0" TO "$MacFIFOADepth - 1"!][!//
      [!WS "0"!][!"$MacComma"!][!CR!][!//
      [!WS "4"!]{[!"num:i($MacBeginning + ($MacCntr * $MacFIFOALength))"!]U}[!//
      [!VAR "MacComma" = "concat(', /* ',num:i($MacAbsCntr),': FIFO A, Buffer ',num:i($MacCntr + 1),' */')"!][!//
      [!VAR "MacAbsCntr" = "$MacAbsCntr + 1"!][!//
    [!ENDFOR!][!//
    [!VAR "MacBeginning" = "$MacBeginning + ($MacFIFOADepth * $MacFIFOALength)"!][!//
    [!FOR "MacCntr" = "0" TO "$MacFIFOBDepth - 1"!][!//
      [!WS "0"!][!"$MacComma"!][!CR!][!//
      [!WS "4"!]{[!"num:i($MacBeginning + ($MacCntr * $MacFIFOBLength))"!]U}[!//
      [!VAR "MacComma" = "concat(', /* ',num:i($MacAbsCntr),': FIFO B, Buffer ',num:i($MacCntr + 1),' */')"!][!//
      [!VAR "MacAbsCntr" = "$MacAbsCntr + 1"!][!//
    [!ENDFOR!][!//
    [!VAR "MacBeginning" = "$MacBeginning + ($MacFIFOBDepth * $MacFIFOBLength)"!][!//
    [!WS "0"!][!"substring-after($MacComma,',')"!][!CR!][!//
    [!WS "0"!]};
    [!CR!][!//
    [!WS "0"!]/* Array of this type contains absolute addresses of the message buffer data fields */
    [!WS "0"!]/* @violates @ref FR_PBCFG_C_REF_4 */  
    [!WS "0"!]static CONST(Fr_CCBufferAddressType, FR_CONST)[!//
    [!WS "1"!]FrIfMC[!"$FrIfConfigIndex"!]_Clst[!"num:i(node:ref($FrIfCluster)/FrIfClstIdx)"!]_Ctrl[!"$MacCtrlIdx"!]_BAddressTable_[!"string($CfgVariant)"!][] =
    [!WS "0"!]{[!//
    [!VAR "MacComma" = "''"!][!//
    [!VAR "MacBeginning" = "$AllignPad + $MacHeadersSize"!][!//
    [!VAR "MacAbsCntr" = "0"!][!//
    [!FOR "MacCntr" = "0" TO "$MacStaticBuffersCnt - 1"!][!//
      [!WS "0"!][!"$MacComma"!][!CR!][!//
      [!WS "4"!]{&Fr_MemoryArea_Ctrl[!"num:i($i - 1)"!][!IF "var:defined('postBuildVariant')"!]_[!"$postBuildVariant"!][!ENDIF!][[!"num:i($MacBeginning + ($MacCntr * $MacStaticPayload))"!]]}[!//
      [!VAR "MacComma" = "concat(', /* ',num:i($MacAbsCntr),': Segment 1, Buffer ',num:i($MacCntr + 1),' */')"!][!//
      [!VAR "MacAbsCntr" = "$MacAbsCntr + 1"!][!//
    [!ENDFOR!][!//
    [!VAR "MacBeginning" = "$MacBeginning + ($MacStaticBuffersCnt * $MacStaticPayload)"!][!//
    [!FOR "MacCntr" = "0" TO "$MacDynamicBuffersCnt - 1"!][!//
      [!WS "0"!][!"$MacComma"!][!CR!][!//
      [!WS "4"!]{&Fr_MemoryArea_Ctrl[!"num:i($i - 1)"!][!IF "var:defined('postBuildVariant')"!]_[!"$postBuildVariant"!][!ENDIF!][[!"num:i($MacBeginning + ($MacCntr * $MacDynamicPayload))"!]]}[!//
      [!VAR "MacComma" = "concat(', /* ',num:i($MacAbsCntr),': Segment 2, Buffer ',num:i($MacCntr + 1),' */')"!][!//
      [!VAR "MacAbsCntr" = "$MacAbsCntr + 1"!][!//
    [!ENDFOR!][!//
    [!VAR "MacBeginning" = "$MacBeginning + ($MacDynamicBuffersCnt * $MacDynamicPayload)"!][!//
    [!FOR "MacCntr" = "0" TO "$MacShadowCount1 - 1"!][!//
      [!WS "0"!][!"$MacComma"!][!CR!][!//
      [!WS "4"!]{&Fr_MemoryArea_Ctrl[!"num:i($i - 1)"!][!IF "var:defined('postBuildVariant')"!]_[!"$postBuildVariant"!][!ENDIF!][[!"num:i($MacBeginning + ($MacCntr * $MacStaticPayload))"!]]}[!//
      [!VAR "MacComma" = "concat(', /* ',num:i($MacAbsCntr),': Segment 1, Receive Shadow Buffer ',num:i($MacCntr + 1),' */')"!][!//
      [!VAR "MacAbsCntr" = "$MacAbsCntr + 1"!][!//
    [!ENDFOR!][!//
    [!VAR "MacBeginning" = "$MacBeginning + ($MacShadowCount1 * $MacStaticPayload)"!][!//
    [!FOR "MacCntr" = "0" TO "$MacShadowCount2 - 1"!][!//
      [!WS "0"!][!"$MacComma"!][!CR!][!//
      [!WS "4"!]{&Fr_MemoryArea_Ctrl[!"num:i($i - 1)"!][!IF "var:defined('postBuildVariant')"!]_[!"$postBuildVariant"!][!ENDIF!][[!"num:i($MacBeginning + ($MacCntr * $MacDynamicPayload))"!]]}[!//
      [!VAR "MacComma" = "concat(', /* ',num:i($MacAbsCntr),': Segment 2, Receive Shadow Buffer ',num:i($MacCntr + 1),' */')"!][!//
      [!VAR "MacAbsCntr" = "$MacAbsCntr + 1"!][!//
    [!ENDFOR!][!//
    [!VAR "MacBeginning" = "$MacBeginning + ($MacShadowCount2 * $MacDynamicPayload)"!][!//
    [!FOR "MacCntr" = "0" TO "$MacFIFOADepth - 1"!][!//
      [!WS "0"!][!"$MacComma"!][!CR!][!//
      [!WS "4"!]{&Fr_MemoryArea_Ctrl[!"num:i($i - 1)"!][!IF "var:defined('postBuildVariant')"!]_[!"$postBuildVariant"!][!ENDIF!][[!"num:i($MacBeginning + ($MacCntr * $MacFIFOALength))"!]]}[!//
      [!VAR "MacComma" = "concat(', /* ',num:i($MacAbsCntr),': FIFO A, Buffer ',num:i($MacCntr + 1),' */')"!][!//
      [!VAR "MacAbsCntr" = "$MacAbsCntr + 1"!][!//
    [!ENDFOR!][!//
    [!VAR "MacBeginning" = "$MacBeginning + ($MacFIFOADepth * $MacFIFOALength)"!][!//
    [!FOR "MacCntr" = "0" TO "$MacFIFOBDepth - 1"!][!//
      [!WS "0"!][!"$MacComma"!][!CR!][!//
      [!WS "4"!]{&Fr_MemoryArea_Ctrl[!"num:i($i - 1)"!][!IF "var:defined('postBuildVariant')"!]_[!"$postBuildVariant"!][!ENDIF!][[!"num:i($MacBeginning + ($MacCntr * $MacFIFOBLength))"!]]}[!//
      [!VAR "MacComma" = "concat(', /* ',num:i($MacAbsCntr),': FIFO B, Buffer ',num:i($MacCntr + 1),' */')"!][!//
      [!VAR "MacAbsCntr" = "$MacAbsCntr + 1"!][!//
    [!ENDFOR!][!//
    [!VAR "MacBeginning" = "$MacBeginning + ($MacFIFOBDepth * $MacFIFOBLength)"!][!//
    [!WS "0"!][!"substring-after($MacComma,',')"!][!CR!][!//
    [!WS "0"!]};
  [!ENDIF!][!//
  [!ENDSELECT!][!//
[!ENDMACRO!][!//
[!//
[!//
[!//
[!//
[!//
[!MACRO "MemorySize", "CfgVariant" = "string('PB')", "FrIfCluster" = "", "FrController" = "", "FIFOASlots" = "", "FIFOBSlots" = "", "Reconfigurations" = ""!][!//
  [!VAR "MacStaticPayload" = "num:i(node:ref($FrIfCluster)/FrIfGPayloadLengthStatic) * 2"!][!//
  [!VAR "MacDynamicPayload" = "num:i(node:ref($FrController)/FrPPayloadLengthDynMax) * 2"!][!//
  [!VAR "NumberOfSlaveShared" = "0"!][!//
  [!WS "0"!][!/* Get numbers of buffers used for reception in static and dynamic segment and numbers of FIFO buffers */!][!//
  [!LOOP "text:split($Reconfigurations, '#')"!][!// Count the number of slave lpdu shared.
        [!VAR "NumberOfSlaveShared"="$NumberOfSlaveShared + count(text:split(. ,' ')) - 1"!][!//
  [!ENDLOOP!][!//
  [!LOOP "node:order(node:ref($FrIfCluster)/FrIfController/*,'node:value(FrIfCtrlIdx)','node:name(.)')"!][!// Sort the controllers by their name at first
    [!IF "$FrController = node:path(node:ref(FrIfFrCtrlRef))"!][!//
      [!VAR "MacStaticBuffersCnt" = "count(FrIfLPdu/*[number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)<=number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots)])"!][!//
      [!VAR "MacDynamicBuffersCnt" = "count(FrIfLPdu/*[number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)>number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots)])"!][!//
      [!VAR "MacStaticBuffersCnt" = "$MacStaticBuffersCnt - $NumberOfSlaveShared"!][!/* Remove reconfigured buffers */!][!//
      [!VAR "MacFIFOACountS" = "count(FrIfLPdu/*[(node:value(node:ref(FrIfVBTriggeringRef)/FrIfChannel)='FRIF_CHANNEL_A') and (node:name(node:ref(node:ref(node:ref(FrIfVBTriggeringRef)/FrIfFrameStructureRef)/FrIfPdusInFrame/*[position()=1]/FrIfPduRef)/FrIfPduDirection)='FrIfRxPdu') and number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)<=number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots) and text:contains(text:split($FIFOASlots),num:i(node:ref(FrIfVBTriggeringRef)/FrIfSlotId))])"!]
      [!VAR "MacFIFOBCountS" = "count(FrIfLPdu/*[(node:value(node:ref(FrIfVBTriggeringRef)/FrIfChannel)='FRIF_CHANNEL_B') and (node:name(node:ref(node:ref(node:ref(FrIfVBTriggeringRef)/FrIfFrameStructureRef)/FrIfPdusInFrame/*[position()=1]/FrIfPduRef)/FrIfPduDirection)='FrIfRxPdu') and number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)<=number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots) and text:contains(text:split($FIFOBSlots),num:i(node:ref(FrIfVBTriggeringRef)/FrIfSlotId))])"!]
      [!VAR "MacFIFOACountD" = "count(FrIfLPdu/*[(node:value(node:ref(FrIfVBTriggeringRef)/FrIfChannel)='FRIF_CHANNEL_A') and (node:name(node:ref(node:ref(node:ref(FrIfVBTriggeringRef)/FrIfFrameStructureRef)/FrIfPdusInFrame/*[position()=1]/FrIfPduRef)/FrIfPduDirection)='FrIfRxPdu') and number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)>number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots) and text:contains(text:split($FIFOASlots),num:i(node:ref(FrIfVBTriggeringRef)/FrIfSlotId))])"!]
      [!VAR "MacFIFOBCountD" = "count(FrIfLPdu/*[(node:value(node:ref(FrIfVBTriggeringRef)/FrIfChannel)='FRIF_CHANNEL_B') and (node:name(node:ref(node:ref(node:ref(FrIfVBTriggeringRef)/FrIfFrameStructureRef)/FrIfPdusInFrame/*[position()=1]/FrIfPduRef)/FrIfPduDirection)='FrIfRxPdu') and number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)>number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots) and text:contains(text:split($FIFOBSlots),num:i(node:ref(FrIfVBTriggeringRef)/FrIfSlotId))])"!]
      [!VAR "MacCtrlIdx" = "num:i(FrIfCtrlIdx)"!][!//
      [!WS "0"!][!/* Remove FIFO buffers to get correct number of buffers used for individual frame reception */!][!//
      [!VAR "MacStaticBuffersCnt" = "num:i(($MacStaticBuffersCnt - $MacFIFOACountS) - $MacFIFOBCountS)"!][!//
      [!VAR "MacDynamicBuffersCnt" = "num:i(($MacDynamicBuffersCnt - $MacFIFOACountD) - $MacFIFOBCountD)"!][!//
      [!WS "0"!][!/* Get number of shadow buffers - check if they are used or not */!][!//
      [!VAR "MacShadowCount1" = "num:i(0)"!][!//
      [!VAR "MacShadowCount2" = "num:i(0)"!][!//
      [!IF "text:tolower(node:value(node:ref($FrController)/VendorSpecific/SingleChannelModeEnabled))='true'"!][!//
        [!IF "number($MacStaticBuffersCnt) > 0"!][!//
          [!VAR "MacShadowCount1" = "num:i($MacShadowCount1 + 1)"!][!//
        [!ENDIF!][!//
        [!IF "number($MacDynamicBuffersCnt) > 0"!][!//
          [!VAR "MacShadowCount2" = "num:i($MacShadowCount2 + 1)"!][!//
        [!ENDIF!][!//
      [!ELSE!][!//
        [!IF "number($MacStaticBuffersCnt) > 0"!][!//
          [!VAR "MacShadowCount1" = "num:i($MacShadowCount1 + 2)"!][!//
        [!ENDIF!][!//
        [!IF "number($MacDynamicBuffersCnt) > 0"!][!//
          [!VAR "MacShadowCount2" = "num:i($MacShadowCount2 + 2)"!][!//
        [!ENDIF!][!//
      [!ENDIF!][!//
      [!WS "0"!][!/* Get payload length for FIFOs - use greater of lengths of segments, where the FIFO is used */!][!//
      [!IF "$MacFIFOACountS > 0"!][!//
        [!VAR "MacFIFOLengthS" = "$MacStaticPayload"!][!//
      [!ELSE!][!//
        [!VAR "MacFIFOLengthS" = "0"!][!//
      [!ENDIF!][!//
      [!IF "$MacFIFOACountD > 0"!][!//
        [!VAR "MacFIFOLengthD" = "$MacDynamicPayload"!][!//
      [!ELSE!][!//
        [!VAR "MacFIFOLengthD" = "0"!][!//
      [!ENDIF!][!//
      [!IF "$MacFIFOLengthD > $MacFIFOLengthS"!][!//
        [!VAR "MacFIFOALength" = "$MacFIFOLengthD"!][!//
      [!ELSE!][!//
        [!VAR "MacFIFOALength" = "$MacFIFOLengthS"!][!//
      [!ENDIF!][!//
      [!IF "$MacFIFOBCountS > 0"!][!//
        [!VAR "MacFIFOLengthS" = "$MacStaticPayload"!][!//
      [!ELSE!][!//
        [!VAR "MacFIFOLengthS" = "0"!][!//
      [!ENDIF!][!//
      [!IF "$MacFIFOBCountD > 0"!][!//
        [!VAR "MacFIFOLengthD" = "$MacDynamicPayload"!][!//
      [!ELSE!][!//
        [!VAR "MacFIFOLengthD" = "0"!][!//
      [!ENDIF!][!//
      [!IF "$MacFIFOLengthD > $MacFIFOLengthS"!][!//
        [!VAR "MacFIFOBLength" = "$MacFIFOLengthD"!][!//
      [!ELSE!][!//
        [!VAR "MacFIFOBLength" = "$MacFIFOLengthS"!][!//
      [!ENDIF!][!//
      [!VAR "MacFIFOADepth" = "0"!][!//
      [!VAR "MacFIFOBDepth" = "0"!][!//
      [!IF "($MacFIFOACountS + $MacFIFOACountD) > 0"!][!//
        [!VAR "MacFIFOADepth" = "number(node:ref($FrController)/FrFifo/*[node:value(FrChannels)='FR_CHANNEL_A']/FrFifoDepth)"!][!//
      [!ENDIF!][!//
      [!IF "($MacFIFOBCountS + $MacFIFOBCountD) > 0"!][!//
        [!VAR "MacFIFOBDepth" = "number(node:ref($FrController)/FrFifo/*[node:value(FrChannels)='FR_CHANNEL_B']/FrFifoDepth)"!][!//
      [!ENDIF!][!//
      [!IF "($MacFIFOADepth + $MacFIFOBDepth) > 255"!][!//
        [!ERROR!][!//
          [!WS "0"!]Error 043: Maximum FIFO depth 255 entries was exceeded!
        [!ENDERROR!][!//
      [!ENDIF!][!//  
      [!WS "0"!][!/* Compute size of the memory used for buffer headers */!][!//
      [!VAR "MacHeadersSize" = "num:i(($MacFIFOADepth + $MacFIFOBDepth + $MacShadowCount2 + $MacShadowCount1 + $MacDynamicBuffersCnt + $MacStaticBuffersCnt) * $MBHeaderLength)"!][!//
      [!WS "0"!][!/* Compute how many bytes must be added to headers memory to get address aligned at 4 bytes - memory for data areas */!][!//
      [!VAR "AllignPad" = "num:i(bit:and(num:i($MacHeadersSize + 3), num:hextoint('0xFFFFFFFC')) - $MacHeadersSize)"!][!//
      [!WS "0"!][!/* Make payloads divisible by 4 to mainatain the buffers alignment */!][!//
      [!VAR "MacStaticPayload" = "num:i(bit:and(num:i($MacStaticPayload + 3), num:hextoint('0xFFFFFFFC')))"!][!/* Adjust to be a multiple of 4 */!][!//
      [!VAR "MacDynamicPayload" = "num:i(bit:and(num:i($MacDynamicPayload + 3), num:hextoint('0xFFFFFFFC')))"!][!/* Adjust to be a multiple of 4 */!][!//
      [!VAR "MacFIFOALength" = "num:i(bit:and(num:i($MacFIFOALength + 3), num:hextoint('0xFFFFFFFC')))"!][!/* Adjust to be a multiple of 4 */!][!//
      [!VAR "MacFIFOBLength" = "num:i(bit:and(num:i($MacFIFOBLength + 3), num:hextoint('0xFFFFFFFC')))"!][!/* Adjust to be a multiple of 4 */!][!//
      [!VAR "SFTOR" = "num:i($MacHeadersSize + $AllignPad + ($MacStaticBuffersCnt * $MacStaticPayload) + ($MacDynamicBuffersCnt * $MacDynamicPayload) + ($MacShadowCount1 * $MacStaticPayload) + ($MacShadowCount2 * $MacDynamicPayload) + ($MacFIFOADepth * $MacFIFOALength) + ($MacFIFOBDepth * $MacFIFOBLength))"!][!//
      [!IF "(num:i($SFTOR + 240)) > $MemSize"!][!//Select maximum memory size from all multiple configurations for current controller
        [!VAR "MemSize" = "num:i($SFTOR+ 240)"!][!//
      [!ENDIF!][!//
    [!ENDIF!][!//
  [!ENDLOOP!][!//
[!ENDMACRO!][!//
[!//
[!//
[!//
[!//
[!//
[!MACRO "BufferCfg", "CfgVariant" = "string('PB')", "FrIfCluster" = "", "FrController" = "", "FIFOASlots" = "", "FIFOBSlots" = "", "Reconfigurations" = ""!][!//
  [!SELECT "(node:ref($FrIfCluster)/FrIfController/*[node:ref(FrIfFrCtrlRef)=node:ref($FrController)])"!][!//
    [!IF "$FrController = node:path(node:ref(FrIfFrCtrlRef))"!][!//
      [!CR!][!//
      [!WS "0"!] /* This structure puts togehter information about the LPdus, buffer assignemnts
      [!WS "0"!] and the resulting Fr Memory layout */
      [!WS "0"!]/* @violates @ref FR_PBCFG_C_REF_4 */
      [!SELECT "node:ref($FrIfCluster)/../.."!][!//
        [!VAR "FrIfConfigIndex" = "position()"!][!//
      [!ENDSELECT!][!//
      [!WS "0"!]static CONST(Fr_CCBufferConfigSetType, FR_CONST) FrIfMC[!"$FrIfConfigIndex"!]_Clst[!"num:i(node:ref($FrIfCluster)/FrIfClstIdx)"!]_Ctrl[!"num:i(FrIfCtrlIdx)"!]_BufferCfgSet_[!"string($CfgVariant)"!] =
      [!WS "0"!]{
      [!WS "4"!]&FrIfMC[!"$FrIfConfigIndex"!]_Clst[!"num:i(node:ref($FrIfCluster)/FrIfClstIdx)"!]_Ctrl[!"num:i(FrIfCtrlIdx)"!]_LPduInfoCfgSet_[!"string($CfgVariant)"!][0],  /* LPdu configuration set */
      [!WS "4"!]&FrIfMC[!"$FrIfConfigIndex"!]_Clst[!"num:i(node:ref($FrIfCluster)/FrIfClstIdx)"!]_Ctrl[!"num:i(FrIfCtrlIdx)"!]_BAddressTable_[!"string($CfgVariant)"!][0], /* Buffer Addresses Table */
      [!WS "4"!]&FrIfMC[!"$FrIfConfigIndex"!]_Clst[!"num:i(node:ref($FrIfCluster)/FrIfClstIdx)"!]_Ctrl[!"num:i(FrIfCtrlIdx)"!]_BOffset16Table_[!"string($CfgVariant)"!][0],  /* Buffer Offsets Table */
      [!WS "4"!][!"num:i(count(FrIfLPdu/*))"!]U, /* Number of items in FrIfMC[!"$FrIfConfigIndex"!]_Clst[!"num:i(node:ref($FrIfCluster)/FrIfClstIdx)"!]_Ctrl[!"num:i(FrIfCtrlIdx)"!]_LPduInfoCfgSet_[!"string($CfgVariant)"!] */
      [!IF "number($MacStaticBuffersCnt) = 0"!][!//There is no static slot
        [!WS "4"!][!"num:i(node:ref($FrController)/FrPPayloadLengthDynMax)"!]U, /* Data size in buffers segment 1 - pPayloadLengthDynMax */
        [!WS "4"!]0U, /* Data size in buffers segment 2 - second message buffer segment is empty */
      [!ELSE!][!// At least one static slot which belongs to segment1 was configured
        [!WS "4"!][!"num:i(node:ref($FrIfCluster)/FrIfGPayloadLengthStatic)"!]U, /* Data size in buffers segment 1 - gPayloadLengthStatic */
        [!WS "4"!][!"num:i(node:ref($FrController)/FrPPayloadLengthDynMax)"!]U, /* Data size in buffers segment 2 - pPayloadLengthDynMax */
      [!ENDIF!][!//
      [!WS "0"!][!/* Get number of buffers used for static (remove reconfigured) and dynamic slots and remove number of slots received into each fifo in static and dynamic segment */!][!//
      [!VAR "MacStaticBuffersCnt" = "count(FrIfLPdu/*[number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)<=number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots)])"!][!//
      [!VAR "MacDynamicBuffersCnt" = "count(FrIfLPdu/*[number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)>number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots)])"!][!//
      [!VAR "MacStaticBuffersCnt" = "$MacStaticBuffersCnt - count(text:split($Reconfigurations, '#'))"!][!//
      [!VAR "MacFIFOACountS" = "count(FrIfLPdu/*[(node:value(node:ref(FrIfVBTriggeringRef)/FrIfChannel)='FRIF_CHANNEL_A') and (node:name(node:ref(node:ref(node:ref(FrIfVBTriggeringRef)/FrIfFrameStructureRef)/FrIfPdusInFrame/*[position()=1]/FrIfPduRef)/FrIfPduDirection)='FrIfRxPdu') and number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)<=number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots) and text:contains(text:split($FIFOASlots),num:i(node:ref(FrIfVBTriggeringRef)/FrIfSlotId))])"!]
      [!VAR "MacFIFOBCountS" = "count(FrIfLPdu/*[(node:value(node:ref(FrIfVBTriggeringRef)/FrIfChannel)='FRIF_CHANNEL_B') and (node:name(node:ref(node:ref(node:ref(FrIfVBTriggeringRef)/FrIfFrameStructureRef)/FrIfPdusInFrame/*[position()=1]/FrIfPduRef)/FrIfPduDirection)='FrIfRxPdu') and number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)<=number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots) and text:contains(text:split($FIFOBSlots),num:i(node:ref(FrIfVBTriggeringRef)/FrIfSlotId))])"!]
      [!VAR "MacFIFOACountD" = "count(FrIfLPdu/*[(node:value(node:ref(FrIfVBTriggeringRef)/FrIfChannel)='FRIF_CHANNEL_A') and (node:name(node:ref(node:ref(node:ref(FrIfVBTriggeringRef)/FrIfFrameStructureRef)/FrIfPdusInFrame/*[position()=1]/FrIfPduRef)/FrIfPduDirection)='FrIfRxPdu') and number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)>number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots) and text:contains(text:split($FIFOASlots),num:i(node:ref(FrIfVBTriggeringRef)/FrIfSlotId))])"!]
      [!VAR "MacFIFOBCountD" = "count(FrIfLPdu/*[(node:value(node:ref(FrIfVBTriggeringRef)/FrIfChannel)='FRIF_CHANNEL_B') and (node:name(node:ref(node:ref(node:ref(FrIfVBTriggeringRef)/FrIfFrameStructureRef)/FrIfPdusInFrame/*[position()=1]/FrIfPduRef)/FrIfPduDirection)='FrIfRxPdu') and number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)>number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots) and text:contains(text:split($FIFOBSlots),num:i(node:ref(FrIfVBTriggeringRef)/FrIfSlotId))])"!]
      [!VAR "MacStaticBuffersCnt" = "($MacStaticBuffersCnt - $MacFIFOACountS) - $MacFIFOBCountS"!]
      [!VAR "MacDynamicBuffersCnt" = "($MacDynamicBuffersCnt - $MacFIFOACountD) - $MacFIFOBCountD"!]
      [!IF "number($MacStaticBuffersCnt) = 0 "!][!//
        [!WS "4"!][!"num:i($MacDynamicBuffersCnt - 1)"!]U, /* Last MB in segment 1 */
        [!WS "4"!][!"num:i($MacStaticBuffersCnt + $MacDynamicBuffersCnt - 1)"!]U, /* Last individual MB; (All individual MBs belong to Segment1) */
      [!ELSE!][!//
        [!WS "4"!][!"num:i($MacStaticBuffersCnt - 1)"!]U, /* Last MB in segment 1 (Number of MB in Segment1 - 1) */
        [!WS "4"!][!"num:i($MacStaticBuffersCnt + $MacDynamicBuffersCnt - 1)"!]U, /* Last individual MB; [!IF "number($MacDynamicBuffersCnt) = 0"!](All individual MBs belong to Segment1)[!WS!][!ELSE!](Number of MB in Segment1 + Number of MB in Segment2 - 1)[!WS!][!ENDIF!]*/
      [!ENDIF!][!//
      [!WS "4"!]/* Receive shadow buffers configuration */
      [!VAR "MacRxShadow" = "$MacStaticBuffersCnt + $MacDynamicBuffersCnt - 1"!][!//
      [!IF "text:tolower(node:value(node:ref($FrController)/VendorSpecific/SingleChannelModeEnabled))='true'"!][!//
        [!WS "0"!][!/* Single channel mode - only internal channel A is used so each segment will use only one receive shadow buffer - total 2 buffers*/!][!//
        [!IF "number($MacStaticBuffersCnt) > 0"!][!//
          [!VAR "MacRxShadow" = "$MacRxShadow + 1"!][!//
          [!WS "4"!][!"num:i($MacRxShadow)"!]U, /* Ch A, seg 1 - the initial buffer index */
          [!WS "4"!][!"num:i($MacRxShadow)"!]U, /* Ch B, seg 1 - unused*/
          [!IF "number($MacDynamicBuffersCnt) > 0"!][!//
            [!VAR "MacRxShadow" = "$MacRxShadow + 1"!][!//
            [!WS "4"!][!"num:i($MacRxShadow)"!]U, /* Ch A, seg 2 - the initial buffer index */
            [!WS "4"!][!"num:i($MacRxShadow)"!]U  /* Ch B, seg 2 - unused */
          [!ELSE!][!//
            [!WS "4"!][!"num:i($MacRxShadow)"!]U, /* Ch A, seg 2 - unused */
            [!WS "4"!][!"num:i($MacRxShadow)"!]U  /* Ch B, seg 2 - unused */
          [!ENDIF!][!//
        [!ELSE!][!//
          [!IF "number($MacDynamicBuffersCnt) > 0"!][!//
            [!VAR "MacRxShadow" = "$MacRxShadow + 1"!][!//
            [!WS "4"!][!"num:i($MacRxShadow)"!]U, /* Ch A, seg 1 - the initial buffer index */
            [!WS "4"!][!"num:i($MacRxShadow)"!]U, /* Ch B, seg 1 - unused */
            [!WS "4"!][!"num:i($MacRxShadow)"!]U, /* Ch A, seg 2 - unused */
            [!WS "4"!][!"num:i($MacRxShadow)"!]U  /* Ch B, seg 2 - unused */
          [!ENDIF!][!//
        [!ENDIF!][!//
      [!ELSE!][!//
      [!WS "0"!][!/* Dual channel mode */!][!//
        [!IF "node:value(node:ref($FrController)/FrPChannels) = 'FR_CHANNEL_AB'"!][!//
          [!WS "0"!][!/* Both channels are used each segment will use both receive shadow buffers - total 4 buffers */!][!//
          [!IF "number($MacStaticBuffersCnt) > 0"!][!//
            [!VAR "MacRxShadow" = "$MacRxShadow + 1"!][!//
            [!WS "4"!][!"num:i($MacRxShadow)"!]U, /* Ch A, seg 1 - the initial index of the MB header field */
            [!VAR "MacRxShadow" = "$MacRxShadow + 1"!][!//
            [!WS "4"!][!"num:i($MacRxShadow)"!]U, /* Ch B, seg 1 - the initial index of the MB header field */
            [!IF "number($MacDynamicBuffersCnt) > 0"!][!//
              [!VAR "MacRxShadow" = "$MacRxShadow + 1"!][!//
              [!WS "4"!][!"num:i($MacRxShadow)"!]U, /* Ch A, seg 2 - the initial index of the MB header field */
              [!WS "4"!][!"num:i($MacRxShadow + 1)"!]U  /* Ch B, seg 2 - the initial index of the MB header field */
            [!ELSE!][!//
              [!WS "4"!][!"num:i($MacRxShadow)"!]U, /* Ch A, seg 2 - unused */
              [!WS "4"!][!"num:i($MacRxShadow)"!]U  /* Ch B, seg 2 - unused */
            [!ENDIF!][!//
          [!ELSE!][!//
            [!IF "number($MacDynamicBuffersCnt) > 0"!][!//
              [!VAR "MacRxShadow" = "$MacRxShadow + 1"!][!//
              [!WS "4"!][!"num:i($MacRxShadow)"!]U, /* Ch A, seg 1 - the initial index of the MB header field */
              [!VAR "MacRxShadow" = "$MacRxShadow + 1"!][!//
              [!WS "4"!][!"num:i($MacRxShadow)"!]U, /* Ch B, seg 1 - the initial index of the MB header field */
              [!WS "4"!][!"num:i($MacRxShadow)"!]U, /* Ch A, seg 2 - unused */
              [!WS "4"!][!"num:i($MacRxShadow)"!]U  /* Ch B, seg 2 - unused */
            [!ENDIF!][!//
          [!ENDIF!][!//
        [!ELSE!][!//
          [!IF "number($MacStaticBuffersCnt) > 0"!][!//
            [!VAR "MacRxShadow" = "$MacRxShadow + 1"!][!//
            [!WS "4"!][!"num:i($MacRxShadow)"!]U, /* Ch A, seg 1 - [!IF "node:value(node:ref($FrController)/FrPChannels) = 'FR_CHANNEL_A'"!]the initial buffer index[!WS!][!ELSE!]unused[!WS!][!ENDIF!]*/
            [!WS "4"!][!"num:i($MacRxShadow)"!]U, /* Ch B, seg 1 - [!IF "node:value(node:ref($FrController)/FrPChannels) = 'FR_CHANNEL_B'"!]the initial buffer index[!WS!][!ELSE!]unused[!WS!][!ENDIF!]*/
            [!IF "number($MacDynamicBuffersCnt) > 0"!][!//
              [!VAR "MacRxShadow" = "$MacRxShadow + 1"!][!//
              [!WS "4"!][!"num:i($MacRxShadow)"!]U, /* Ch A, seg 2 - [!IF "node:value(node:ref($FrController)/FrPChannels) = 'FR_CHANNEL_A'"!]the initial buffer index[!WS!][!ELSE!]unused[!WS!][!ENDIF!]*/
              [!WS "4"!][!"num:i($MacRxShadow)"!]U  /* Ch B, seg 2 - [!IF "node:value(node:ref($FrController)/FrPChannels) = 'FR_CHANNEL_B'"!]the initial buffer index[!WS!][!ELSE!]unused[!WS!][!ENDIF!]*/
            [!ELSE!][!//
              [!WS "4"!][!"num:i($MacRxShadow)"!]U, /* Ch A, seg 2 - unused */
              [!WS "4"!][!"num:i($MacRxShadow)"!]U  /* Ch B, seg 2 - unused */
            [!ENDIF!][!//
          [!ELSE!][!//
            [!IF "number($MacDynamicBuffersCnt) > 0"!][!//
              [!VAR "MacRxShadow" = "$MacRxShadow + 1"!][!//
              [!WS "4"!][!"num:i($MacRxShadow)"!]U, /* Ch A, seg 1 - [!IF "node:value(node:ref($FrController)/FrPChannels) = 'FR_CHANNEL_A'"!]the initial buffer index[!WS!][!ELSE!]unused[!WS!][!ENDIF!]*/
              [!WS "4"!][!"num:i($MacRxShadow)"!]U, /* Ch B, seg 1 - [!IF "node:value(node:ref($FrController)/FrPChannels) = 'FR_CHANNEL_B'"!]the initial buffer index[!WS!][!ELSE!]unused[!WS!][!ENDIF!]*/
              [!WS "4"!][!"num:i($MacRxShadow)"!]U, /* Ch A, seg 2 - unused */
              [!WS "4"!][!"num:i($MacRxShadow)"!]U  /* Ch B, seg 2 - unused */
            [!ENDIF!][!//
          [!ENDIF!][!//
        [!ENDIF!][!//
      [!ENDIF!][!//
      [!WS "0"!]};
    [!ENDIF!][!//
  [!ENDSELECT!][!//
[!ENDMACRO!][!//
[!//
[!//
[!//
[!//
[!//
[!MACRO "FifoCfg", "CfgVariant" = "string('PB')", "FrIfCluster" = "", "FrController" = "", "FIFOASlots" = "", "FIFOBSlots" = "", "Reconfigurations" = ""!][!//
  [!VAR "MacStaticPayload" = "num:i(node:ref($FrIfCluster)/FrIfGPayloadLengthStatic * 2)"!][!//
  [!VAR "MacDynamicPayload" = "num:i(node:ref($FrController)/FrPPayloadLengthDynMax * 2)"!][!//
  [!WS "0"!][!/* Get numbers of buffers used for reception in static and dynamic segment and numbers of FIFO buffers */!][!//
  [!SELECT "(node:ref($FrIfCluster)/FrIfController/*[node:ref(FrIfFrCtrlRef)=node:ref($FrController)])"!][!//
    [!IF "$FrController = node:path(node:ref(FrIfFrCtrlRef))"!][!//
      [!VAR "MacStaticBuffersCnt" = "count(FrIfLPdu/*[number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)<=number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots)])"!][!//
      [!VAR "MacDynamicBuffersCnt" = "count(FrIfLPdu/*[number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)>number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots)])"!][!//
      [!VAR "MacStaticBuffersCnt" = "$MacStaticBuffersCnt - count(text:split($Reconfigurations, '#'))"!][!/* Remove reconfigured buffers */!][!//
      [!VAR "MacFIFOACountS" = "count(FrIfLPdu/*[(node:value(node:ref(FrIfVBTriggeringRef)/FrIfChannel)='FRIF_CHANNEL_A') and (node:name(node:ref(node:ref(node:ref(FrIfVBTriggeringRef)/FrIfFrameStructureRef)/FrIfPdusInFrame/*[position()=1]/FrIfPduRef)/FrIfPduDirection)='FrIfRxPdu') and number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)<=number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots) and text:contains(text:split($FIFOASlots),num:i(node:ref(FrIfVBTriggeringRef)/FrIfSlotId))])"!]
      [!VAR "MacFIFOBCountS" = "count(FrIfLPdu/*[(node:value(node:ref(FrIfVBTriggeringRef)/FrIfChannel)='FRIF_CHANNEL_B') and (node:name(node:ref(node:ref(node:ref(FrIfVBTriggeringRef)/FrIfFrameStructureRef)/FrIfPdusInFrame/*[position()=1]/FrIfPduRef)/FrIfPduDirection)='FrIfRxPdu') and number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)<=number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots) and text:contains(text:split($FIFOBSlots),num:i(node:ref(FrIfVBTriggeringRef)/FrIfSlotId))])"!]
      [!VAR "MacFIFOACountD" = "count(FrIfLPdu/*[(node:value(node:ref(FrIfVBTriggeringRef)/FrIfChannel)='FRIF_CHANNEL_A') and (node:name(node:ref(node:ref(node:ref(FrIfVBTriggeringRef)/FrIfFrameStructureRef)/FrIfPdusInFrame/*[position()=1]/FrIfPduRef)/FrIfPduDirection)='FrIfRxPdu') and number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)>number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots) and text:contains(text:split($FIFOASlots),num:i(node:ref(FrIfVBTriggeringRef)/FrIfSlotId))])"!]
      [!VAR "MacFIFOBCountD" = "count(FrIfLPdu/*[(node:value(node:ref(FrIfVBTriggeringRef)/FrIfChannel)='FRIF_CHANNEL_B') and (node:name(node:ref(node:ref(node:ref(FrIfVBTriggeringRef)/FrIfFrameStructureRef)/FrIfPdusInFrame/*[position()=1]/FrIfPduRef)/FrIfPduDirection)='FrIfRxPdu') and number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)>number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots) and text:contains(text:split($FIFOBSlots),num:i(node:ref(FrIfVBTriggeringRef)/FrIfSlotId))])"!]
      [!VAR "MacCtrlIdx" = "num:i(FrIfCtrlIdx)"!][!//
      [!WS "0"!][!/* Remove FIFO buffers to get correct number of buffers used for individual frame reception */!][!//
      [!VAR "MacStaticBuffersCnt" = "num:i(($MacStaticBuffersCnt - $MacFIFOACountS) - $MacFIFOBCountS)"!]
      [!VAR "MacDynamicBuffersCnt" = "num:i(($MacDynamicBuffersCnt - $MacFIFOACountD) - $MacFIFOBCountD)"!]
      [!WS "0"!][!/* Get number of shadow buffers - check if they are used or not */!][!//
      [!VAR "MacShadowCount1" = "num:i(0)"!][!//
      [!VAR "MacShadowCount2" = "num:i(0)"!][!//
      [!IF "text:tolower(node:value(node:ref($FrController)/VendorSpecific/SingleChannelModeEnabled))='true'"!][!//
        [!IF "number($MacStaticBuffersCnt) > 0"!][!//
          [!VAR "MacShadowCount1" = "num:i($MacShadowCount1 + 1)"!][!//
        [!ENDIF!][!//
        [!IF "number($MacDynamicBuffersCnt) > 0"!][!//
          [!VAR "MacShadowCount2" = "num:i($MacShadowCount2 + 1)"!][!//
        [!ENDIF!][!//
      [!ELSE!][!//
        [!IF "number($MacStaticBuffersCnt) > 0"!][!//
          [!VAR "MacShadowCount1" = "num:i($MacShadowCount1 + 2)"!][!//
        [!ENDIF!][!//
        [!IF "number($MacDynamicBuffersCnt) > 0"!][!//
          [!VAR "MacShadowCount2" = "num:i($MacShadowCount2 + 2)"!][!//
        [!ENDIF!][!//
      [!ENDIF!][!//
      [!WS "0"!][!/* Get payload length for FIFOs - use grater of lengths of segments, where the FIFO is used */!][!//
      [!IF "$MacFIFOACountS > 0"!][!//
        [!VAR "MacFIFOLengthS" = "$MacStaticPayload"!][!//
      [!ELSE!][!//
        [!VAR "MacFIFOLengthS" = "0"!][!//
      [!ENDIF!][!//
      [!IF "$MacFIFOACountD > 0"!][!//
        [!VAR "MacFIFOLengthD" = "$MacDynamicPayload"!][!//
      [!ELSE!][!//
        [!VAR "MacFIFOLengthD" = "0"!][!//
      [!ENDIF!][!//
      [!IF "$MacFIFOLengthD > $MacFIFOLengthS"!][!//
        [!VAR "MacFIFOALength" = "$MacFIFOLengthD"!][!//
      [!ELSE!][!//
        [!VAR "MacFIFOALength" = "$MacFIFOLengthS"!][!//
      [!ENDIF!][!//
      [!IF "$MacFIFOBCountS > 0"!][!//
        [!VAR "MacFIFOLengthS" = "$MacStaticPayload"!][!//
      [!ELSE!][!//
        [!VAR "MacFIFOLengthS" = "0"!][!//
      [!ENDIF!][!//
      [!IF "$MacFIFOBCountD > 0"!][!//
        [!VAR "MacFIFOLengthD" = "$MacDynamicPayload"!][!//
      [!ELSE!][!//
        [!VAR "MacFIFOLengthD" = "0"!][!//
      [!ENDIF!][!//
      [!IF "$MacFIFOLengthD > $MacFIFOLengthS"!][!//
        [!VAR "MacFIFOBLength" = "$MacFIFOLengthD"!][!//
      [!ELSE!][!//
        [!VAR "MacFIFOBLength" = "$MacFIFOLengthS"!][!//
      [!ENDIF!][!//
      [!VAR "MacFifoBeginning" = "$MacStaticBuffersCnt + $MacDynamicBuffersCnt + $MacShadowCount1 + $MacShadowCount2"!][!//
      [!IF "($MacFIFOACountS + $MacFIFOACountD) > 0"!][!//
        [!CR!][!//
        [!WS "0"!]/* This structure contains configuration of the receive FIFO for the channel A */
        [!WS "0"!]/* @violates @ref FR_PBCFG_C_REF_4 */
        [!WS "0"!]static CONST(Fr_CCFifoConfigType, FR_CONST)[!//
        [!SELECT "node:ref($FrIfCluster)/../.."!][!//
          [!VAR "FrIfConfigIndex" = "position()"!][!//
        [!ENDSELECT!][!//
        [!WS "1"!]FrIfMC[!"$FrIfConfigIndex"!]_Clst[!"num:i(node:ref($FrIfCluster)/FrIfClstIdx)"!]_Ctrl[!"$MacCtrlIdx"!]_FIFOA_Cfg_[!"string($CfgVariant)"!] =
        [!WS "0"!]{
        [!SELECT "node:ref($FrController)/FrFifo/*[node:value(FrChannels)='FR_CHANNEL_A']"!][!//
          [!WS "4"!]FR_RECEIVE_FIFOA, /* FIFO receives messages from the channel A */
          [!WS "4"!][!"num:i($MacFifoBeginning)"!]U, /* The first FIFO message buffer */
          [!VAR "MacFifoBeginning" = "$MacFifoBeginning + num:i(FrFifoDepth)"!][!//
          [!WS "4"!][!"num:i(FrFifoDepth)"!]U, /* The number of FIFO message buffers */
          [!WS "4"!][!"num:i(($MacFIFOALength + 1) div 2)"!]U, /* Length of the data received into the FIFO */
          [!WS "4"!][!"num:i(FrMsgIdMask)"!]U, /* Message ID filter mask [!//
          [!IF "number(FrMsgIdMask) = 0"!][!//
            [!WS "0"!] - message ID filtering disabled */
          [!ELSE!][!//
            [!WS "0"!] - message ID filtering enabled */
          [!ENDIF!][!//
          [!WS "4"!][!"num:i(FrMsgIdMatch)"!]U, /* Message ID filter match */
          [!WS "4"!]{ /* FIFO A Range filters configuration */
          [!IF "count(FrRange/*[position()=1]) = 1"!]
            [!SELECT "FrRange/*[position()=1]"!][!//
              [!WS "8"!]{(VAR(boolean, FR_VAR))TRUE, [!"node:value(FrVendorSpecific/FrRangeMode)"!], [!"num:i(FrRangeMin)"!]U, [!"num:i(FrRangeMax)"!]U},
            [!ENDSELECT!][!//
          [!ELSE!]
            [!WS "8"!]{(VAR(boolean, FR_VAR))FALSE, FR_ACCEPTANCE, 0U, 0U}, /* Range filter disabled */
          [!ENDIF!]
          [!IF "count(FrRange/*[position()=2]) = 1"!]
            [!SELECT "FrRange/*[position()=2]"!][!//
              [!WS "8"!]{(VAR(boolean, FR_VAR))TRUE, [!"node:value(FrVendorSpecific/FrRangeMode)"!], [!"num:i(FrRangeMin)"!]U, [!"num:i(FrRangeMax)"!]U},
            [!ENDSELECT!][!//
          [!ELSE!]
            [!WS "8"!]{(VAR(boolean, FR_VAR))FALSE, FR_ACCEPTANCE, 0U, 0U}, /* Range filter disabled */
          [!ENDIF!]
          [!IF "count(FrRange/*[position()=3]) = 1"!]
            [!SELECT "FrRange/*[position()=3]"!][!//
              [!WS "8"!]{(VAR(boolean, FR_VAR))TRUE, [!"node:value(FrVendorSpecific/FrRangeMode)"!], [!"num:i(FrRangeMin)"!]U, [!"num:i(FrRangeMax)"!]U},
            [!ENDSELECT!][!//
          [!ELSE!]
            [!WS "8"!]{(VAR(boolean, FR_VAR))FALSE, FR_ACCEPTANCE, 0U, 0U}, /* Range filter disabled */
          [!ENDIF!]
          [!IF "count(FrRange/*[position()=4]) = 1"!]
            [!SELECT "FrRange/*[position()=4]"!][!//
              [!WS "8"!]{(VAR(boolean, FR_VAR))TRUE, [!"node:value(FrVendorSpecific/FrRangeMode)"!], [!"num:i(FrRangeMin)"!]U, [!"num:i(FrRangeMax)"!]U}
            [!ENDSELECT!][!//
          [!ELSE!]
            [!WS "8"!]{(VAR(boolean, FR_VAR))FALSE, FR_ACCEPTANCE, 0U, 0U} /* Range filter disabled */
          [!ENDIF!]
        [!ENDSELECT!][!//
        [!WS "4"!]}
        [!WS "0"!]};
      [!ENDIF!][!//
      [!IF "($MacFIFOBCountS + $MacFIFOBCountD) > 0"!][!//
        [!CR!][!//
        [!WS "0"!]/* This structure contains configuration of the receive FIFO for the channel B */
        [!WS "0"!]/* @violates @ref FR_PBCFG_C_REF_4 */
        [!WS "0"!]static CONST(Fr_CCFifoConfigType, FR_CONST)[!//
        [!SELECT "node:ref($FrIfCluster)/../.."!][!//
          [!VAR "FrIfConfigIndex" = "position()"!][!//
        [!ENDSELECT!][!//
        [!WS "1"!]FrIfMC[!"$FrIfConfigIndex"!]_Clst[!"num:i(node:ref($FrIfCluster)/FrIfClstIdx)"!]_Ctrl[!"$MacCtrlIdx"!]_FIFOB_Cfg_[!"string($CfgVariant)"!] =
        [!WS "0"!]{
        [!SELECT "node:ref($FrController)/FrFifo/*[node:value(FrChannels)='FR_CHANNEL_B']"!][!//
          [!WS "4"!]FR_RECEIVE_FIFOB, /* FIFO receives messages from the channel B */
          [!WS "4"!][!"num:i($MacFifoBeginning)"!]U, /* The first FIFO message buffer */
          [!VAR "MacFifoBeginning" = "$MacFifoBeginning + num:i(FrFifoDepth)"!][!//
          [!WS "4"!][!"num:i(FrFifoDepth)"!]U, /* The number of FIFO message buffers */
          [!WS "4"!][!"num:i(($MacFIFOBLength + 1) div 2)"!]U, /* Length of the data received into the FIFO */
          [!WS "4"!][!"num:i(FrMsgIdMask)"!]U, /* Message ID filter mask [!//
          [!IF "0 = number(FrMsgIdMask)"!][!//
            [!WS "0"!] - message ID filtering disabled */
          [!ELSE!][!//
            [!WS "0"!] - message ID filtering enabled */
          [!ENDIF!][!//
          [!WS "4"!][!"num:i(FrMsgIdMatch)"!]U, /* Message ID filter match */
          [!WS "4"!]{ /* FIFO B Range filters configuration */
          [!IF "count(FrRange/*[position()=1]) = 1"!][!//
            [!SELECT "FrRange/*[position()=1]"!][!//
              [!WS "8"!]{(VAR(boolean, FR_VAR))TRUE, [!"node:value(FrVendorSpecific/FrRangeMode)"!], [!"num:i(FrRangeMin)"!]U, [!"num:i(FrRangeMax)"!]U},
            [!ENDSELECT!][!//
          [!ELSE!][!//
            [!WS "8"!]{(VAR(boolean, FR_VAR))FALSE, FR_ACCEPTANCE, 0U, 0U}, /* Range filter disabled */
          [!ENDIF!][!//
          [!IF "count(FrRange/*[position()=2]) = 1"!][!//
            [!SELECT "FrRange/*[position()=2]"!][!//
              [!WS "8"!]{(VAR(boolean, FR_VAR))TRUE, [!"node:value(FrVendorSpecific/FrRangeMode)"!], [!"num:i(FrRangeMin)"!]U, [!"num:i(FrRangeMax)"!]U},
            [!ENDSELECT!][!//
          [!ELSE!][!//
            [!WS "8"!]{(VAR(boolean, FR_VAR))FALSE, FR_ACCEPTANCE, 0U, 0U}, /* Range filter disabled */
          [!ENDIF!][!//
          [!IF "count(FrRange/*[position()=3]) = 1"!][!//
            [!SELECT "FrRange/*[position()=3]"!][!//
              [!WS "8"!]{(VAR(boolean, FR_VAR))TRUE, [!"node:value(FrVendorSpecific/FrRangeMode)"!], [!"num:i(FrRangeMin)"!]U, [!"num:i(FrRangeMax)"!]U},
            [!ENDSELECT!][!//
          [!ELSE!][!//
            [!WS "8"!]{(VAR(boolean, FR_VAR))FALSE, FR_ACCEPTANCE, 0U, 0U}, /* Range filter disabled */
          [!ENDIF!][!//
          [!IF "count(FrRange/*[position()=4]) = 1"!][!//
            [!SELECT "FrRange/*[position()=4]"!][!//
              [!WS "8"!]{(VAR(boolean, FR_VAR))TRUE, [!"node:value(FrVendorSpecific/FrRangeMode)"!], [!"num:i(FrRangeMin)"!]U, [!"num:i(FrRangeMax)"!]U}
            [!ENDSELECT!][!//
          [!ELSE!][!//
            [!WS "8"!]{(VAR(boolean, FR_VAR))FALSE, FR_ACCEPTANCE, 0U, 0U}, /* Range filter disabled */
          [!ENDIF!]
        [!ENDSELECT!][!//
        [!WS "4"!]}
        [!WS "0"!]};
      [!ENDIF!][!//
    [!ENDIF!][!//
  [!ENDSELECT!][!//
[!ENDMACRO!][!//
[!//
[!//
[!//
[!//
[!//
[!MACRO "HWConfig", "CfgIdx" = "0", "CfgVariant" = "", "FrIfCluster" = "", "FrController" = "", "FIFOASlots" = "", "FIFOBSlots" = "",  "Reconfigurations" = ""!][!//
  [!WS "0"!]/* Structure of this type contains configuration
  [!WS "0"!] * information of one hardware parameters configuration set */
  [!WS "0"!]static CONST(Fr_CCHardwareConfigType, FR_CONST) FrMC[!"num:i($CfgIdx)"!]_Ctrl[!"num:i(node:ref($FrController)/FrCtrlIdx)"!]_CCHardwareCfgSet_[!"string($CfgVariant)"!] =
  [!WS "0"!]{[!//
  [!CR!][!//
  [!WS "4"!][!"num:inttohex(node:ref($FrController)/VendorSpecific/CCBaseAddress,8)"!]U,  /* Controller base address */
  [!WS "4"!]&Fr_MemoryArea_Ctrl[!"num:i($i - 1)"!][!IF "var:defined('postBuildVariant')"!]_[!"$postBuildVariant"!][!ENDIF!][0], /* FlexRay memory base address */
  [!WS "4"!][!"node:value(node:ref($FrController)/FrPChannels)"!], /* FlexRay channels */
  [!IF "text:tolower(node:value(node:ref($FrController)/VendorSpecific/SingleChannelModeEnabled))='true'"!][!//
    [!WS "4"!](VAR(boolean, FR_VAR))TRUE,   /* TRUE = Single channel mode selected*/
  [!ELSE!][!//
    [!WS "4"!](VAR(boolean, FR_VAR))FALSE,  /* FALSE = Dual channel mode selected */
  [!ENDIF!][!//
  [!WS "4"!][!"node:value(node:ref($FrController)/VendorSpecific/ClockSource)"!], /* FlexRay protocol engine clock source */
  [!IF "node:value(node:ref($FrController)/VendorSpecific/ChannelBitrate)='br_10Mbps'"!][!//
    [!WS "4"!]0U,  /* Bus speed: 10 Mb/s */
  [!ELSEIF "node:value(node:ref($FrController)/VendorSpecific/ChannelBitrate)='br_8Mbps'"!][!//
    [!WS "4"!]3U,  /* Bus speed:  8 Mb/s */
  [!ELSEIF "node:value(node:ref($FrController)/VendorSpecific/ChannelBitrate)='br_5Mbps'"!][!//
    [!WS "4"!]1U,  /* Bus speed:  5 Mb/s */
  [!ELSEIF "node:value(node:ref($FrController)/VendorSpecific/ChannelBitrate)='br_2500kbps'"!][!//
    [!WS "4"!]2U,  /* Bus speed:  2500 kb/s */
  [!ELSE!][!//
    [!WS "4"!]0U, /* Bus speed: 10 Mb/s (defaulted)*/
  [!ENDIF!][!//
  [!WS "4"!][!"num:i(node:ref($FrController)/VendorSpecific/SystemMemoryAccessTimeOut)"!]U, /* System memory access timeout */
[!//
  [!VAR "MacStaticPayload" = "num:i(node:ref($FrIfCluster)/FrIfGPayloadLengthStatic * 2)"!][!//
  [!VAR "MacDynamicPayload" = "num:i(node:ref($FrController)/FrPPayloadLengthDynMax * 2)"!][!//
    [!WS "0"!][!/* Get numbers of buffers used for reception in static and dynamic segment and numbers of FIFO buffers */!][!//
    [!SELECT "(node:ref($FrIfCluster)/FrIfController/*[node:ref(FrIfFrCtrlRef)=node:ref($FrController)])"!][!//
      [!VAR "MacStaticBuffersCnt" = "count(FrIfLPdu/*[number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)<=number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots)])"!][!//
      [!VAR "MacDynamicBuffersCnt" = "count(FrIfLPdu/*[number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)>number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots)])"!][!//
      [!VAR "MacStaticBuffersCnt" = "$MacStaticBuffersCnt - count(text:split($Reconfigurations, '#'))"!][!/* Remove reconfigured buffers */!][!//
      [!VAR "MacFIFOACountS" = "count(FrIfLPdu/*[(node:value(node:ref(FrIfVBTriggeringRef)/FrIfChannel)='FRIF_CHANNEL_A') and (node:name(node:ref(node:ref(node:ref(FrIfVBTriggeringRef)/FrIfFrameStructureRef)/FrIfPdusInFrame/*[position()=1]/FrIfPduRef)/FrIfPduDirection)='FrIfRxPdu') and number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)<=number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots) and text:contains(text:split($FIFOASlots),num:i(node:ref(FrIfVBTriggeringRef)/FrIfSlotId))])"!]
      [!VAR "MacFIFOBCountS" = "count(FrIfLPdu/*[(node:value(node:ref(FrIfVBTriggeringRef)/FrIfChannel)='FRIF_CHANNEL_B') and (node:name(node:ref(node:ref(node:ref(FrIfVBTriggeringRef)/FrIfFrameStructureRef)/FrIfPdusInFrame/*[position()=1]/FrIfPduRef)/FrIfPduDirection)='FrIfRxPdu') and number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)<=number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots) and text:contains(text:split($FIFOBSlots),num:i(node:ref(FrIfVBTriggeringRef)/FrIfSlotId))])"!]
      [!VAR "MacFIFOACountD" = "count(FrIfLPdu/*[(node:value(node:ref(FrIfVBTriggeringRef)/FrIfChannel)='FRIF_CHANNEL_A') and (node:name(node:ref(node:ref(node:ref(FrIfVBTriggeringRef)/FrIfFrameStructureRef)/FrIfPdusInFrame/*[position()=1]/FrIfPduRef)/FrIfPduDirection)='FrIfRxPdu') and number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)>number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots) and text:contains(text:split($FIFOASlots),num:i(node:ref(FrIfVBTriggeringRef)/FrIfSlotId))])"!]
      [!VAR "MacFIFOBCountD" = "count(FrIfLPdu/*[(node:value(node:ref(FrIfVBTriggeringRef)/FrIfChannel)='FRIF_CHANNEL_B') and (node:name(node:ref(node:ref(node:ref(FrIfVBTriggeringRef)/FrIfFrameStructureRef)/FrIfPdusInFrame/*[position()=1]/FrIfPduRef)/FrIfPduDirection)='FrIfRxPdu') and number(node:ref(FrIfVBTriggeringRef)/FrIfSlotId)>number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots) and text:contains(text:split($FIFOBSlots),num:i(node:ref(FrIfVBTriggeringRef)/FrIfSlotId))])"!]
    [!ENDSELECT!]
    [!WS "0"!][!/* Remove FIFO buffers to get correct number of buffers used for individual frame reception */!][!//
    [!VAR "MacStaticBuffersCnt" = "num:i(($MacStaticBuffersCnt - $MacFIFOACountS) - $MacFIFOBCountS)"!]
    [!VAR "MacDynamicBuffersCnt" = "num:i(($MacDynamicBuffersCnt - $MacFIFOACountD) - $MacFIFOBCountD)"!]
    [!WS "0"!][!/* Get number of shadow buffers - check if they are used or not */!][!//
    [!VAR "MacShadowCount1" = "num:i(0)"!][!//
    [!VAR "MacShadowCount2" = "num:i(0)"!][!//
    [!IF "text:tolower(node:value(node:ref($FrController)/VendorSpecific/SingleChannelModeEnabled))='true'"!][!//
      [!IF "number($MacStaticBuffersCnt) > 0"!][!//
        [!VAR "MacShadowCount1" = "num:i($MacShadowCount1 + 1)"!][!//
      [!ENDIF!][!//
      [!IF "number($MacDynamicBuffersCnt) > 0"!][!//
        [!VAR "MacShadowCount2" = "num:i($MacShadowCount2 + 1)"!][!//
      [!ENDIF!][!//
    [!ELSE!][!//
      [!IF "number($MacStaticBuffersCnt) > 0"!][!//
        [!VAR "MacShadowCount1" = "num:i($MacShadowCount1 + 2)"!][!//
      [!ENDIF!][!//
      [!IF "number($MacDynamicBuffersCnt) > 0"!][!//
        [!VAR "MacShadowCount2" = "num:i($MacShadowCount2 + 2)"!][!//
      [!ENDIF!][!//
    [!ENDIF!][!//
    [!WS "0"!][!/* Get payload length for FIFOs - use greater of lengths of segments, where the FIFO is used */!][!//
    [!IF "$MacFIFOACountS > 0"!][!//
      [!VAR "MacFIFOLengthS" = "$MacStaticPayload"!][!//
    [!ELSE!][!//
      [!VAR "MacFIFOLengthS" = "0"!][!//
    [!ENDIF!][!//
    [!IF "$MacFIFOACountD > 0"!][!//
      [!VAR "MacFIFOLengthD" = "$MacDynamicPayload"!][!//
    [!ELSE!][!//
      [!VAR "MacFIFOLengthD" = "0"!][!//
    [!ENDIF!][!//
    [!IF "$MacFIFOLengthD > $MacFIFOLengthS"!][!//
      [!VAR "MacFIFOALength" = "$MacFIFOLengthD"!][!//
    [!ELSE!][!//
      [!VAR "MacFIFOALength" = "$MacFIFOLengthS"!][!//
    [!ENDIF!][!//
    [!IF "$MacFIFOBCountS > 0"!][!//
      [!VAR "MacFIFOLengthS" = "$MacStaticPayload"!][!//
    [!ELSE!][!//
      [!VAR "MacFIFOLengthS" = "0"!][!//
    [!ENDIF!][!//
    [!IF "$MacFIFOBCountD > 0"!][!//
      [!VAR "MacFIFOLengthD" = "$MacDynamicPayload"!][!//
    [!ELSE!][!//
      [!VAR "MacFIFOLengthD" = "0"!][!//
    [!ENDIF!][!//
    [!IF "$MacFIFOLengthD > $MacFIFOLengthS"!][!//
      [!VAR "MacFIFOBLength" = "$MacFIFOLengthD"!][!//
    [!ELSE!][!//
      [!VAR "MacFIFOBLength" = "$MacFIFOLengthS"!][!//
    [!ENDIF!][!//
    [!VAR "MacFIFOALength" = "num:i(bit:and(num:i($MacFIFOALength + 3), num:hextoint('0xFFFFFFFC')))"!][!/* Adjust to be a multiple of 4 */!][!//
    [!VAR "MacFIFOBLength" = "num:i(bit:and(num:i($MacFIFOBLength + 3), num:hextoint('0xFFFFFFFC')))"!][!/* Adjust to be a multiple of 4 */!][!//
    [!VAR "MacStaticPayload" = "num:i(bit:and(num:i($MacStaticPayload + 3), num:hextoint('0xFFFFFFFC')))"!][!/* Adjust to be a multiple of 4 */!][!//
    [!VAR "MacDynamicPayload" = "num:i(bit:and(num:i($MacDynamicPayload + 3), num:hextoint('0xFFFFFFFC')))"!][!/* Adjust to be a multiple of 4 */!][!//
    [!VAR "MacFIFOADepth" = "0"!][!//
    [!VAR "MacFIFOBDepth" = "0"!][!//
    [!IF "($MacFIFOACountS + $MacFIFOACountD) > 0"!][!//
      [!VAR "MacFIFOADepth" = "number(node:ref($FrController)/FrFifo/*[node:value(FrChannels)='FR_CHANNEL_A']/FrFifoDepth)"!][!//
    [!ENDIF!]
    [!IF "($MacFIFOBCountS + $MacFIFOBCountD) > 0"!][!//
      [!VAR "MacFIFOBDepth" = "number(node:ref($FrController)/FrFifo/*[node:value(FrChannels)='FR_CHANNEL_B']/FrFifoDepth)"!][!//
    [!ENDIF!]
    [!VAR "MacSFTBeginning" = "($MacStaticBuffersCnt + $MacDynamicBuffersCnt + $MacShadowCount1 + $MacShadowCount2 + $MacFIFOBDepth + $MacFIFOADepth) * $MBHeaderLength"!]
    [!VAR "MacSFTBeginning" = "num:i(bit:and(num:i($MacSFTBeginning + 3), num:hextoint('0xFFFFFFFC')))"!][!/* Adjust to be a multiple of 4 */!][!//
    [!VAR "MacSFTBeginning" = "$MacSFTBeginning + ($MacStaticBuffersCnt * $MacStaticPayload) + ($MacDynamicBuffersCnt * $MacDynamicPayload) + ($MacShadowCount1 * $MacStaticPayload) + ($MacShadowCount2 * $MacDynamicPayload) + ($MacFIFOADepth * $MacFIFOALength) + ($MacFIFOBDepth * $MacFIFOBLength)"!][!//
    [!WS "4"!][!"num:i($MacSFTBeginning)"!]U, /* SFTOR register value */
 [!IF "$SupportIpv9 = 'true'"!]
  [!IF "../../../FrGeneral/VendorSpecific/FrAccessErrorNotificationEnable = 'true'"!]
  [!WS "4"!]#ifdef FR_ACCESS_ERROR_NOTIFICATION_EN
  [!IF "(normalize-space(VendorSpecific/FrAccessErrorNotification) != 'NULL_PTR')"!]
    [!WS "4"!]&[!"normalize-space(VendorSpecific/FrAccessErrorNotification)"!],
  [!ELSE!]
    [!WS "4"!]NULL_PTR,
  [!ENDIF!]
  [!WS "4"!]#endif /* FR_ACCESS_ERROR_NOTIFICATION_EN */
  [!ENDIF!]
  [!ENDIF!]
  [!IF "count(node:ref($FrController)/FrAbsoluteTimer/*)>1"!][!//
    [!WS "4"!](VAR(boolean, FR_VAR))TRUE  /* The second absolute timer is enabled */
  [!ELSE!][!//
    [!WS "4"!](VAR(boolean, FR_VAR))FALSE /* The second absolute timer is disabled */
  [!ENDIF!][!//
  [!WS "0"!]};
[!ENDMACRO!][!//
[!//
[!//
[!VAR "CtrlNum" = "num:i('0')"!][!//Stores max number of CC which wre configured for all multpile configurations
[!LOOP "node:order(FrMultipleConfiguration,'node:name(.)')"!][!//Sort the multiple configurations by their name at first
[!IF "count(FrController/*) > $CtrlNum"!][!//
    [!VAR "CtrlNum" = "count(FrController/*)"!][!//Find multiple configuration wit max. number of configured CC
[!ENDIF!][!//
[!ENDLOOP!][!//
[!CR!][!//
/* @violates @ref FR_PBCFG_C_REF_4 */
/* @violates @ref FR_PBCFG_C_REF_5 */
#define FR_START_SEC_VAR_NO_INIT_UNSPECIFIED_NO_CACHEABLE
/* @violates @ref FR_PBCFG_C_REF_1 */
/* @violates @ref FR_PBCFG_C_REF_2 */
#include "Fr_MemMap.h"
[!VAR "MultipleCfgNum" = "count(FrMultipleConfiguration)"!][!//
/* Make the variable properly aligned */
[!FOR "i" = "1" TO "$CtrlNum"!][!//
  [!VAR "MemSize" = "num:i('0')"!][!//
  [!WS "0"!]/* FrCtrlIdx = [!"num:i($i - 1)"!] */ 
  [!FOR "j" = "1" TO "$MultipleCfgNum"!][!//
    [!SELECT "FrMultipleConfiguration/FrController/*[FrCtrlIdx = ($i - 1)]"!][!//
      [!VAR "FrCtrlPath" = "node:path(.)"!][!//
      [!LOOP "node:order(as:modconf('FrIf')[1]/FrIfConfig,'node:name(.)')"!][!// Sort multiple configurations by their name at first
        [!LOOP "node:order(FrIfCluster/*,'node:name(.)')"!][!// Sort the clusters by their name at first
          [!LOOP "node:order(FrIfController/*,'node:value(FrIfCtrlIdx)','node:name(.)')"!][!//Go through all controllers in the cluster to find whether it is the current Fr controller
            [!IF "$FrCtrlPath = node:path(node:ref(FrIfFrCtrlRef))"!][!//Check reference from FrIf matched Fr controller index
              [!VAR "FrControllersUsage" = "node:path(.)"!][!//
              [!VAR "FrControllersCluster" = "node:path(node:ref($FrControllersUsage)/../..)"!][!//
              [!VAR "FrFrIfCtrlReference" = "node:path(node:ref(FrIfFrCtrlRef))"!][!//
            [!ENDIF!][!//
          [!ENDLOOP!][!//
        [!ENDLOOP!][!//
      [!ENDLOOP!][!//
      [!IF "$FrCtrlPath = $FrFrIfCtrlReference"!][!//
        [!IF "FSL_FR_RECONFIG:Reconfig( node:ref($FrControllersUsage)/FrIfLPdu, 4, 0, string(FrCtrlIdx), string(""))='true'"!][!ENDIF!][!//
        [!VAR "Reconfigurations" = "FSL_FR_RECONFIG:GetReconfigString()"!][!// Get result string of reconfiguration
        [!NOCODE!][!//
        [!CALL "RxFIFOSlots", "FrIfCluster" = "$FrControllersCluster", "FrController" = "node:path(.)", "OutFIFOASlots" = "string('')", "OutFIFOBSlots" = "string('')"!][!//
        [!CALL "MemorySize", "CfgVariant" = "string('PB')", "FrIfCluster" = "$FrControllersCluster", "FrController" = "node:path(.)", "FIFOASlots" = "$OutFIFOASlots", "FIFOBSlots" = "$OutFIFOBSlots", "Reconfigurations" = "$Reconfigurations"!][!//
        [!ENDNOCODE!][!//
        [!WS "0"!]/* Memory size for for [!"as:name(../..)"!] and [!"node:name(.)"!] is [!"(num:i($SFTOR + 240))"!] Bytes */
      [!ENDIF!][!//
    [!ENDSELECT!][!//
  [!ENDFOR!][!//
  [!WS "0"!]ALIGNED_VARS_START(dummy_section, 16U)
  [!WS "0"!]/* @violates @ref FR_PBCFG_C_REF_3 */
  [!WS "0"!]VAR_ALIGN(VAR(uint8, FR_VAR) Fr_MemoryArea_Ctrl[!"num:i($i - 1)"!][!IF "var:defined('postBuildVariant')"!]_[!"$postBuildVariant"!][!ENDIF!][[!"$MemSize"!]], 16U)
  [!WS "0"!]ALIGNED_VARS_STOP()
  [!CR!][!//
[!ENDFOR!][!//
/* @violates @ref FR_PBCFG_C_REF_4 */
/* @violates @ref FR_PBCFG_C_REF_5 */
#define FR_STOP_SEC_VAR_NO_INIT_UNSPECIFIED_NO_CACHEABLE
/* @violates @ref FR_PBCFG_C_REF_1 */
/* @violates @ref FR_PBCFG_C_REF_2 */
#include "Fr_MemMap.h"
[!//
[!//
[!MACRO "PSRRegisters", "CfgIdx" = "0", "CfgVariant" = "", "FrIfCluster" = "", "FrController" = ""!][!//
[!CR!][!//
/*  This field contains FlexRay Protocol configuration
 *  parameters returned by the Fr_ReadCCConfig function*/
static CONST(uint32, FR_CONST) FrMC[!"num:i($CfgIdx)"!]_Ctrl[!"num:i(node:ref($FrController)/FrCtrlIdx)"!]_CCReadBackParamSet_[!"string($CfgVariant)"!][] =
{
[!WS"4"!][!"num:inttohex(node:value(node:ref($FrIfCluster)/FrIfGdCycle)*1000000000,8)"!]U, /* gdCycle=[!"num:i(node:value(node:ref($FrIfCluster)/FrIfGdCycle)*1000000000)"!][ns] */
[!WS"4"!][!"num:inttohex(node:value(node:ref($FrController)/FrPMicroPerCycle),8)"!]U, /* pMicroPerCycle=[!"num:i(node:value(node:ref($FrController)/FrPMicroPerCycle))"!] */
[!WS"4"!][!"num:inttohex(node:value(node:ref($FrController)/FrPdListenTimeout),8)"!]U, /* pdListenTimeout=[!"num:i(node:value(node:ref($FrController)/FrPdListenTimeout))"!][uT] */
[!WS"4"!][!"concat( num:inttohex(node:value(node:ref($FrIfCluster)/FrIfGMacroPerCycle),4), substring-after(num:inttohex(node:value(node:ref($FrIfCluster)/FrIfGdMacrotick)*1000000000,4),'0x') )"!]U, /* gMacroPerCycle=[!"num:i(node:value(node:ref($FrIfCluster)/FrIfGMacroPerCycle))"!][MT], gdMacrotick=[!"num:i(node:value(node:ref($FrIfCluster)/FrIfGdMacrotick)*1000000000)"!][ns] */ 
[!WS"4"!][!"concat( num:inttohex(node:value(node:ref($FrIfCluster)/FrIfGNumberOfMinislots),4), substring-after(num:inttohex(node:value(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots),4),'0x') )"!]U, /* gNumberOfMinislots=[!"num:i(node:value(node:ref($FrIfCluster)/FrIfGNumberOfMinislots))"!], gNumberOfStaticSlots=[!"num:i(node:value(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots))"!] */
[!WS"4"!][!"concat( num:inttohex(node:value(node:ref($FrIfCluster)/FrIfGdNit),4), substring-after(num:inttohex(node:value(node:ref($FrIfCluster)/FrIfGdStaticSlot),4), '0x') )"!]U, /* gdNIT=[!"num:i(node:value(node:ref($FrIfCluster)/FrIfGdNit))"!][MT], gdStaticSlot=[!"num:i(node:value(node:ref($FrIfCluster)/FrIfGdStaticSlot))"!][MT] */
[!WS"4"!][!"concat( num:inttohex(node:value(node:ref($FrIfCluster)/FrIfGdWakeupRxWindow),4), substring-after(num:inttohex(node:value(node:ref($FrController)/FrPKeySlotId),4), '0x') )"!]U, /* gdWakeupRxWindow=[!"num:i(node:value(node:ref($FrIfCluster)/FrIfGdWakeupRxWindow))"!][MT], pKeySlotId=[!"num:i(node:value(node:ref($FrController)/FrPKeySlotId))"!] */
[!WS"4"!][!"concat( num:inttohex(node:value(node:ref($FrController)/FrPLatestTx),4), substring-after(num:inttohex(node:value(node:ref($FrController)/FrPOffsetCorrectionOut),4), '0x') )"!]U, /* pLatestTx=[!"num:i(node:value(node:ref($FrController)/FrPLatestTx))"!][Minislot], pOffsetCorrectionOut=[!"num:i(node:value(node:ref($FrController)/FrPOffsetCorrectionOut))"!][uT] */
[!WS"4"!][!"concat( num:inttohex(node:value(node:ref($FrController)/FrPOffsetCorrectionStart),4), substring-after(num:inttohex(node:value(node:ref($FrController)/FrPRateCorrectionOut),4), '0x') )"!]U, /* gOffsetCorrectionStart=[!"num:i(node:value(node:ref($FrController)/FrPOffsetCorrectionStart))"!][MT], pRateCorrectionOut=[!"num:i(node:value(node:ref($FrController)/FrPRateCorrectionOut))"!][uT] */
[!WS"4"!][!"concat( num:inttohex('0',4), substring-after(num:inttohex(node:value(node:ref($FrController)/FrPdAcceptedStartupRange),4), '0x') )"!]U, /* pSecondKeySlotId=0(Not supported by the FlexRay Protocol 2.1revA specification), pdAcceptedStartupRange=[!"num:i(node:value(node:ref($FrController)/FrPdAcceptedStartupRange))"!][uT] */
[!WS"4"!][!"concat( num:inttohex(node:value(node:ref($FrIfCluster)/FrIfGColdStartAttempts),4), substring-after(num:inttohex(node:value(node:ref($FrIfCluster)/FrIfGCycleCountMax),4), '0x') )"!]U, /* gColdStartAttempts=[!"num:i(node:value(node:ref($FrIfCluster)/FrIfGColdStartAttempts))"!], cCycleCountMax=[!"num:i(node:value(node:ref($FrIfCluster)/FrIfGCycleCountMax))"!] */
[!WS"4"!][!"concat( num:inttohex(node:value(node:ref($FrIfCluster)/FrIfGListenNoise),4), substring-after(num:inttohex(node:value(node:ref($FrIfCluster)/FrIfGMaxWithoutClockCorrectFatal),4), '0x') )"!]U, /* gListenNoise=[!"num:i(node:value(node:ref($FrIfCluster)/FrIfGListenNoise))"!], gMaxWithoutClockCorrectFatal=[!"num:i(node:value(node:ref($FrIfCluster)/FrIfGMaxWithoutClockCorrectFatal))"!][even/odd cycle pairs] */
[!WS"4"!][!"concat( num:inttohex(node:value(node:ref($FrIfCluster)/FrIfGMaxWithoutClockCorrectPassive),4), substring-after(num:inttohex(node:value(node:ref($FrIfCluster)/FrIfGNetworkManagementVectorLength),4), '0x') )"!]U, /* gMaxWithoutClockCorrectionPassive=[!"num:i(node:value(node:ref($FrIfCluster)/FrIfGMaxWithoutClockCorrectPassive))"!][even/odd cycle pairs], gNetworkManagementVectorLength=[!"num:i(node:value(node:ref($FrIfCluster)/FrIfGNetworkManagementVectorLength))"!][bytes] */ 
[!WS"4"!][!"concat( num:inttohex(node:value(node:ref($FrIfCluster)/FrIfGPayloadLengthStatic),4), substring-after(num:inttohex(node:value(node:ref($FrIfCluster)/FrIfGSyncFrameIDCountMax),4), '0x') )"!]U, /* gPayloadLengthStatic=[!"num:i(node:value(node:ref($FrIfCluster)/FrIfGPayloadLengthStatic))"!][two-byte-words], gSyncFrameIDCountMax=[!"num:i(node:value(node:ref($FrIfCluster)/FrIfGSyncFrameIDCountMax))"!] */ 
[!IF "node:value(node:ref($FrIfCluster)/FrIfGdBit)='T100NS'"!][!//
    [!VAR "MacTempValue1" = "num:inttohex('0',4)"!][!// /* gdBit T100NS */
[!ELSEIF "node:value(node:ref($FrIfCluster)/FrIfGdBit)='T200NS'"!][!//
    [!VAR "MacTempValue1" = "num:inttohex('1',4)"!][!// /* gdBit T200NS */
[!ELSE!][!//
    [!VAR "MacTempValue1" = "num:inttohex('2',4)"!][!// /* gdBit T400NS */
[!ENDIF!][!//
[!WS "4"!][!"concat( num:inttohex(node:value(node:ref($FrIfCluster)/FrIfGdActionPointOffset),4), substring-after($MacTempValue1, '0x') )"!]U, /* gdActionPointOffset=[!"num:i(node:value(node:ref($FrIfCluster)/FrIfGdActionPointOffset))"!][MT], gdBit=[!"num:hextoint($MacTempValue1)"!]([!"node:value(node:ref($FrIfCluster)/FrIfGdBit)"!]) */
[!WS "4"!][!"concat( num:inttohex(node:value(node:ref($FrIfCluster)/FrIfGdCasRxLowMax),4), substring-after(num:inttohex(node:value(node:ref($FrIfCluster)/FrIfGdDynamicSlotIdlePhase),4), '0x') )"!]U, /* gdCasRxLowMax=[!"num:i(node:value(node:ref($FrIfCluster)/FrIfGdCasRxLowMax))"!][gdBit], gdDynamicSlotIdlePhase=[!"num:i(node:value(node:ref($FrIfCluster)/FrIfGdDynamicSlotIdlePhase))"!][Minislot] */
[!WS "4"!][!"concat( num:inttohex(node:value(node:ref($FrIfCluster)/FrIfGdMiniSlotActionPointOffset),4), substring-after(num:inttohex(node:value(node:ref($FrIfCluster)/FrIfGdMinislot),4), '0x') )"!]U, /* gdMiniSlotActionPointOffset=[!"num:i(node:value(node:ref($FrIfCluster)/FrIfGdMiniSlotActionPointOffset))"!][MT], gdMinislot=[!"num:i(node:value(node:ref($FrIfCluster)/FrIfGdMinislot))"!][MT] */
[!IF "node:value(node:ref($FrIfCluster)/FrIfGdSampleClockPeriod)='T12_5NS'"!][!//
    [!VAR "MacTempValue1" = "num:inttohex('0',4)"!][!// /* gdSampleClockPeriod T12_5NS */
[!ELSEIF "node:value(node:ref($FrIfCluster)/FrIfGdSampleClockPeriod)='T25NS'"!][!//    
    [!VAR "MacTempValue1" = "num:inttohex('1',4)"!][!// /* gdSampleClockPeriod T25NS */ 
[!ELSE!][!//
    [!VAR "MacTempValue1" = "num:inttohex('2',4)"!][!// /* gdSampleClockPeriod T50NS */
[!ENDIF!][!//
[!WS "4"!][!"concat( $MacTempValue1, substring-after(num:inttohex(node:value(node:ref($FrIfCluster)/FrIfGdSymbolWindow),4), '0x') )"!]U, /* gdSampleClockPeriod=[!"num:hextoint($MacTempValue1)"!]([!"node:value(node:ref($FrIfCluster)/FrIfGdSampleClockPeriod)"!]), gdSymbolWindow=[!"num:i(node:value(node:ref($FrIfCluster)/FrIfGdSymbolWindow))"!][MT] */
[!WS "4"!][!"concat( num:inttohex(node:value(node:ref($FrIfCluster)/FrIfGdSymbolWindowActionPointOffset),4), substring-after(num:inttohex(node:value(node:ref($FrIfCluster)/FrIfGdTSSTransmitter),4), '0x') )"!]U, /* gdActionPointOffset=[!"num:i(node:value(node:ref($FrIfCluster)/FrIfGdSymbolWindowActionPointOffset))"!][MT], gdTSSTransmitter=[!"num:i(node:value(node:ref($FrIfCluster)/FrIfGdTSSTransmitter))"!][gdBit] */
[!WS "4"!][!"concat( num:inttohex(node:value(node:ref($FrIfCluster)/FrIfGdWakeupRxIdle),4), substring-after(num:inttohex(node:value(node:ref($FrIfCluster)/FrIfGdWakeupRxLow),4), '0x') )"!]U, /* gdWakeupSymbolRxIdle=[!"num:i(node:value(node:ref($FrIfCluster)/FrIfGdWakeupRxIdle))"!][gdBit], gdWakeupSymbolRxLow=[!"num:i(node:value(node:ref($FrIfCluster)/FrIfGdWakeupRxLow))"!][gdBit] */
[!WS "4"!][!"concat( num:inttohex(node:value(node:ref($FrIfCluster)/FrIfGdWakeupTxActive),4), substring-after(num:inttohex(node:value(node:ref($FrIfCluster)/FrIfGdWakeupTxIdle),4), '0x') )"!]U, /* gdWakeupSymbolTxActive=[!"num:i(node:value(node:ref($FrIfCluster)/FrIfGdWakeupTxActive))"!][gdBit], gdWakeupSymbolTxIdle=[!"num:i(node:value(node:ref($FrIfCluster)/FrIfGdWakeupTxIdle))"!][gdBit] */
[!IF "node:value(node:ref($FrController)/FrPChannels)='FR_CHANNEL_A'"!][!//
    [!VAR "MacTempValue1" = "num:inttohex('0',4)"!][!// /* pChannels FR_CHANNEL_A */
[!ELSEIF "node:value(node:ref($FrController)/FrPChannels)='FR_CHANNEL_B'"!][!//
    [!VAR "MacTempValue1" = "num:inttohex('1',4)"!][!// /* pChannels FR_CHANNEL_B */
[!ELSE!][!//
    [!VAR "MacTempValue1" = "num:inttohex('2',4)"!][!// /* pChannels FR_CHANNEL_AB */
[!ENDIF!][!//
[!WS "4"!][!"concat( num:inttohex(node:value(node:ref($FrController)/FrPAllowPassiveToActive),4), substring-after($MacTempValue1, '0x') )"!]U, /* pAllowPassiveToActive=[!"num:i(node:value(node:ref($FrController)/FrPAllowPassiveToActive))"!][even/odd cycle pairs], pChannels=[!"num:hextoint($MacTempValue1)"!]([!"node:value(node:ref($FrController)/FrPChannels)"!]) */
[!WS "4"!][!"concat( num:inttohex(node:value(node:ref($FrController)/FrPClusterDriftDamping),4), substring-after(num:inttohex(node:value(node:ref($FrController)/FrPDecodingCorrection),4), '0x') )"!]U, /* pClusterDriftDamping=[!"num:i(node:value(node:ref($FrController)/FrPClusterDriftDamping))"!][uT], pDecodingCorrection=[!"num:i(node:value(node:ref($FrController)/FrPDecodingCorrection))"!][uT] */
[!WS "4"!][!"concat( num:inttohex(node:value(node:ref($FrController)/FrPDelayCompensationA),4), substring-after(num:inttohex(node:value(node:ref($FrController)/FrPDelayCompensationB),4), '0x') )"!]U, /* pDelayCompensationA=[!"num:i(node:value(node:ref($FrController)/FrPDelayCompensationA))"!][uT], pDelayCompensationB=[!"num:i(node:value(node:ref($FrController)/FrPDelayCompensationB))"!][uT] */
[!WS "4"!][!"concat( num:inttohex(node:value(node:ref($FrController)/FrPMacroInitialOffsetA),4), substring-after(num:inttohex(node:value(node:ref($FrController)/FrPMacroInitialOffsetB),4), '0x') )"!]U, /* pMacroInitialOffsetA=[!"num:i(node:value(node:ref($FrController)/FrPMacroInitialOffsetA))"!][MT], pMacroInitialOffsetB=[!"num:i(node:value(node:ref($FrController)/FrPMacroInitialOffsetB))"!][MT] */ 
[!WS "4"!][!"concat( num:inttohex(node:value(node:ref($FrController)/FrPMicroInitialOffsetA),4), substring-after(num:inttohex(node:value(node:ref($FrController)/FrPMicroInitialOffsetB),4), '0x') )"!]U, /* pMicroInitialOffsetA=[!"num:i(node:value(node:ref($FrController)/FrPMicroInitialOffsetA))"!][uT], pMicroInitialOffsetB=[!"num:i(node:value(node:ref($FrController)/FrPMicroInitialOffsetB))"!][uT] */
[!IF "node:value(node:ref($FrController)/FrPSamplesPerMicrotick)='N1SAMPLES'"!][!//
    [!VAR "MacTempValue1" = "num:inttohex('0',4)"!][!// /* pSamplesPerMicrotick N1SAMPLES */
[!ELSEIF "node:value(node:ref($FrController)/FrPSamplesPerMicrotick)='N2SAMPLES'"!][!//
    [!VAR "MacTempValue1" = "num:inttohex('1',4)"!][!// /* pSamplesPerMicrotick N2SAMPLES */
[!ELSE!][!//
    [!VAR "MacTempValue1" = "num:inttohex('2',4)"!][!// /* pSamplesPerMicrotick N4SAMPLES */
[!ENDIF!][!//
[!WS "4"!][!"concat( num:inttohex(bit:and(number(node:ref($FrController)/FrPPayloadLengthDynMax),127),4), substring-after($MacTempValue1, '0x') )"!]U, /* pPayloadLengthDynMax=[!"num:i(bit:and(number(node:ref($FrController)/FrPPayloadLengthDynMax),127))"!][two-byte-words]], pSamplesPerMicrotick=[!"num:hextoint($MacTempValue1)"!]([!"node:value(node:ref($FrController)/FrPSamplesPerMicrotick)"!])*/
[!IF "node:value(node:ref($FrController)/FrPWakeupChannel)='FR_CHANNEL_A'"!][!//
    [!VAR "MacTempValue1" = "num:inttohex('0',4)"!][!// /* pWakeupChannel FR_CHANNEL_A */
[!ELSE!][!//
    [!VAR "MacTempValue1" = "num:inttohex('1',4)"!][!// /* pWakeupChannel FR_CHANNEL_B */
[!ENDIF!][!//
[!WS "4"!][!"concat( $MacTempValue1, substring-after(num:inttohex(node:value(node:ref($FrController)/FrPWakeupPattern),4), '0x') )"!]U, /* pWakeupChannel=[!"num:hextoint($MacTempValue1)"!]([!"node:value(node:ref($FrController)/FrPWakeupChannel)"!]), pWakeupPattern=[!"num:i(node:value(node:ref($FrController)/FrPWakeupPattern))"!]*/
[!IF "node:value(node:ref($FrController)/FrPdMicrotick)='T12_5NS'"!][!//
    [!VAR "MacTempValue1" = "num:inttohex('0',4)"!][!// /* pdMicrotick T12_5NS */
[!ELSEIF "node:value(node:ref($FrController)/FrPdMicrotick)='T25NS'"!][!//
    [!VAR "MacTempValue1" = "num:inttohex('1',4)"!][!// /* pdMicrotick T25NS */
[!ELSEIF "node:value(node:ref($FrController)/FrPdMicrotick)='T50NS'"!][!//
    [!VAR "MacTempValue1" = "num:inttohex('2',4)"!][!// /* pdMicrotick T50NS */
[!ELSEIF "node:value(node:ref($FrController)/FrPdMicrotick)='T100NS'"!][!//
    [!VAR "MacTempValue1" = "num:inttohex('3',4)"!][!// /* pdMicrotick T100NS */
[!ELSE!][!//
    [!VAR "MacTempValue1" = "num:inttohex('4',4)"!][!// /* pdMicrotick T200NS */
[!ENDIF!][!//   
[!WS "4"!][!"concat( $MacTempValue1 , substring-after(num:inttohex('0',4), '0x') )"!]U, /* pdMicrotick=[!"num:hextoint($MacTempValue1)"!]([!"node:value(node:ref($FrController)/FrPdMicrotick)"!]), gdIgnoreAfterTx=0(Not supported by the FlexRay Protocol 2.1revA specification) */
[!IF "node:value(node:ref($FrController)/FrPAllowHaltDueToClock)"!][!//
    [!VAR "MacTempValue1" = "num:inttohex('1',4)"!][!// /* pAllowHaltDueToClock enabled */
[!ELSE!][!//
    [!VAR "MacTempValue1" = "num:inttohex('0',4)"!][!// /* pAllowHaltDueToClock disabled */
[!ENDIF!][!//
[!WS "4"!][!"concat( $MacTempValue1, substring-after(num:inttohex('0',4), '0x') )"!]U, /* pAllowHaltDueToClock=[!"num:hextoint($MacTempValue1)"!]([!"node:value(node:ref($FrController)/FrPAllowHaltDueToClock)"!]), pExternalSync=0(Not supported by the FlexRay Protocol 2.1revA specification) */
[!IF "text:tolower(node:value(node:ref($FrController)/FrPKeySlotOnlyEnabled))='true'"!][!//
   [!VAR "MacTempValue1" = "num:inttohex('1',4)"!][!// /* pKeySlotOnlyEnabled */
[!ELSE!][!//
   [!VAR "MacTempValue1" = "num:inttohex('0',4)"!][!// /* pKeySlotOnlyEnabled */
[!ENDIF!][!//
[!WS "4"!][!"concat( num:inttohex('0',4) , substring-after($MacTempValue1, '0x') )"!]U, /* pFallBackInternal=0(Not supported by the FlexRay Protocol 2.1revA specification), pKeySlotOnlyEnabled=[!"num:hextoint($MacTempValue1)"!]([!"node:value(node:ref($FrController)/FrPKeySlotOnlyEnabled)"!]) */
[!IF "node:value(node:ref($FrController)/FrPKeySlotUsedForStartup)"!][!//
    [!VAR "MacTempValue1" = "num:inttohex('1',4)"!][!// /* pKeySlotUsedForStartup */
[!ELSE!][!//
    [!VAR "MacTempValue1" = "num:inttohex('0',4)"!][!// /* pKeySlotUsedForStartup */
[!ENDIF!][!//
[!IF "node:value(node:ref($FrController)/FrPKeySlotUsedForSync)"!]
    [!VAR "MacTempValue2" = "num:inttohex('1',4)"!][!// /* pKeySlotUsedForSync */
[!ELSE!][!//
    [!VAR "MacTempValue2" = "num:inttohex('0',4)"!][!// /* pKeySlotUsedForSync */
[!ENDIF!][!//
[!WS "4"!][!"concat($MacTempValue1, substring-after($MacTempValue2, '0x') )"!]U, /* pKeySlotUsedForStartup=[!"num:hextoint($MacTempValue1)"!]([!"node:value(node:ref($FrController)/FrPKeySlotUsedForStartup)"!]), pKeySlotUsedForSync=[!"num:hextoint($MacTempValue2)"!]([!"node:value(node:ref($FrController)/FrPKeySlotUsedForSync)"!]) */
[!WS "4"!][!"concat( num:inttohex('0',4), substring-after(num:inttohex('0',4), '0x') )"!]U /* pNmVectorEarlyUpdate=0(Not supported by the FlexRay Protocol 2.1revA specification), pTwoKeySlotMode=0(Not supported by the FlexRay Protocol 2.1revA specification) */
};
[!CR!][!//
/*  Structure of this type contains configuration
 *  information of the one low level parameters set */
static CONST(Fr_CCLowLevelConfigSetType, FR_CONST) FrMC[!"num:i($CfgIdx)"!]_Ctrl[!"num:i(node:ref($FrController)/FrCtrlIdx)"!]_CCLowLevelCfgSet_[!"string($CfgVariant)"!] =
{[!//
[!CR!][!//
[!/* PCR0 */!][!//
[!VAR "MacTempValue1" = "node:value(node:ref($FrIfCluster)/FrIfGdActionPointOffset)"!][!//
[!VAR "MacTempValue2" = "node:value(node:ref($FrIfCluster)/FrIfGdStaticSlot)"!][!//
[!VAR "MacTempValue1" = "number($MacTempValue1)-1"!][!//
[!VAR "MacTempValue2" = "bit:and(number($MacTempValue2),1023)"!][!//
[!VAR "MacTempValue1_1" = "bit:or((bit:shl($MacTempValue1,10)),$MacTempValue2)"!][!//
[!/* PCR1 */!][!//
[!VAR "MacTempValue1" = "node:value(node:ref($FrIfCluster)/FrIfGMacroPerCycle)"!][!//
[!VAR "MacTempValue2" = "node:value(node:ref($FrIfCluster)/FrIfGdStaticSlot)"!][!//
[!VAR "MacTempValue1_2" = "number($MacTempValue1)-number($MacTempValue2)"!][!//
[!WS "4"!][!"concat(  num:inttohex($MacTempValue1_1,4), substring-after(num:inttohex($MacTempValue1_2,4),'0x') )"!]U,        /*  PCR0_1 */
[!/* PCR2 */!][!//
[!VAR "MacTempValue1" = "node:value(node:ref($FrIfCluster)/FrIfGdMinislot)"!][!//
[!VAR "MacTempValue2" = "node:value(node:ref($FrIfCluster)/FrIfGdMiniSlotActionPointOffset)"!][!//
[!VAR "MacTempValue1" = "number($MacTempValue1)-number($MacTempValue2)-1"!][!//
[!VAR "MacTempValue3" = "node:value(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots)"!][!//
[!VAR "MacTempValue3" = "bit:and(number($MacTempValue3),1023)"!][!//
[!VAR "MacTempValue1_1" = "bit:or((bit:shl($MacTempValue1,10)),$MacTempValue3)"!][!//
[!/* PCR3 */!][!//
[!VAR "MacTempValue1" = "node:value(node:ref($FrIfCluster)/FrIfGdWakeupRxLow)"!][!//
[!VAR "MacTempValue2" = "node:value(node:ref($FrIfCluster)/FrIfGdMiniSlotActionPointOffset)"!][!//
[!VAR "MacTempValue3" = "node:value(node:ref($FrIfCluster)/FrIfGColdStartAttempts)"!][!//
[!VAR "MacTempValue1" = "number($MacTempValue1)"!][!//
[!VAR "MacTempValue2" = "(bit:and(number($MacTempValue2),31)-1)"!][!//
[!VAR "MacTempValue3" = "bit:and(number($MacTempValue3),31)"!][!//
[!VAR "MacTempValue1" = "bit:or((bit:shl($MacTempValue1,5)),$MacTempValue2)"!][!//
[!VAR "MacTempValue1_2" = "bit:or((bit:shl($MacTempValue1,5)),$MacTempValue3)"!][!//
[!WS "4"!][!"concat(  num:inttohex($MacTempValue1_1,4), substring-after(num:inttohex($MacTempValue1_2,4),'0x') )"!]U,        /*  PCR2_3 */
[!/* PCR4 */!][!//
[!VAR "MacTempValue1" = "node:value(node:ref($FrIfCluster)/FrIfGdCasRxLowMax)"!][!//
[!VAR "MacTempValue2" = "node:value(node:ref($FrIfCluster)/FrIfGdWakeupRxWindow)"!][!//
[!VAR "MacTempValue1" = "number($MacTempValue1)-1"!][!//
[!VAR "MacTempValue2" = "bit:and(number($MacTempValue2),511)"!][!//
[!VAR "MacTempValue1_1" = "bit:or((bit:shl($MacTempValue1,9)),$MacTempValue2)"!][!//
[!/* PCR5 */!][!//
[!VAR "MacTempValue1" = "node:value(node:ref($FrIfCluster)/FrIfGdTSSTransmitter)"!][!//
[!VAR "MacTempValue2" = "node:value(node:ref($FrIfCluster)/FrIfGdWakeupTxActive)"!][!//
[!VAR "MacTempValue3" = "node:value(node:ref($FrIfCluster)/FrIfGdWakeupRxIdle)"!][!//
[!VAR "MacTempValue1" = "number($MacTempValue1)"!][!//
[!VAR "MacTempValue2" = "bit:and(number($MacTempValue2),63)"!][!//
[!VAR "MacTempValue3" = "bit:and(number($MacTempValue3),63)"!][!//
[!VAR "MacTempValue1" = "bit:or((bit:shl($MacTempValue1,6)),$MacTempValue2)"!][!//
[!VAR "MacTempValue1_2" = "bit:or((bit:shl($MacTempValue1,6)),$MacTempValue3)"!][!//
[!WS "4"!][!"concat(  num:inttohex($MacTempValue1_1,4), substring-after(num:inttohex($MacTempValue1_2,4),'0x') )"!]U,        /*  PCR4_5 */
[!/* PCR6 */!][!//
[!NOCODE!][!//
[!VAR "MacTempValue1" = "node:value(node:ref($FrIfCluster)/FrIfGdSymbolWindow)"!][!//
[!VAR "MacTempValue2" = "node:value(node:ref($FrIfCluster)/FrIfGdActionPointOffset)"!][!//
[!VAR "MacTempValue3" = "node:value(node:ref($FrController)/FrPMacroInitialOffsetA)"!][!//
[!IF "$MacTempValue1 != 0"!][!/* Check if GdSymbolWindow is not equal to zero */!][!//
  [!VAR "MacTempValue1" = "number($MacTempValue1)-number($MacTempValue2)-1"!][!/* No -> normal calculation */!][!//
[!ELSE!][!/* Yes, GdSymbolWindow is equal to zero -> store zero value instead of standard calculation */!][!//
  [!VAR "MacTempValue1" = "0"!][!//
[!ENDIF!][!/* End of checking */!][!//
[!VAR "MacTempValue3" = "bit:and(number($MacTempValue3),127)"!][!//
[!VAR "MacTempValue1_1" = "bit:or((bit:shl($MacTempValue1,7)),$MacTempValue3)"!][!//
[!ENDNOCODE!][!//
[!/* PCR7 */!][!//
[!VAR "MacTempValue1" = "node:value(node:ref($FrController)/FrPDecodingCorrection)"!][!//
[!VAR "MacTempValue2" = "node:value(node:ref($FrController)/FrPDelayCompensationB)"!][!//
[!VAR "MacTempValue4" = "node:value(node:ref($FrIfCluster)/FrIfGMacroPerCycle)"!][!//
[!VAR "MacTempValue3" = "node:value(node:ref($FrController)/FrPMicroPerCycle)"!][!//
[!VAR "MacTempValue3" = "num:i($MacTempValue3 div $MacTempValue4)"!][!/* Compute pMicroPerMacroNom value */!][!//
[!VAR "MacTempValue1" = "number($MacTempValue1)+number($MacTempValue2)+2"!][!//
[!VAR "MacTempValue3" = "(number($MacTempValue3) div 2)"!][!//
[!VAR "MacTempValue1_2" = "bit:or((bit:shl($MacTempValue1,7)),$MacTempValue3)"!][!//
[!WS "4"!][!"concat(  num:inttohex($MacTempValue1_1,4), substring-after(num:inttohex($MacTempValue1_2,4),'0x') )"!]U,        /*  PCR6_7 */
[!/* PCR8 */!][!//
[!VAR "MacTempValue1" = "node:value(node:ref($FrIfCluster)/FrIfGMaxWithoutClockCorrectFatal)"!][!//
[!VAR "MacTempValue2" = "node:value(node:ref($FrIfCluster)/FrIfGMaxWithoutClockCorrectPassive)"!][!//
[!VAR "MacTempValue3" = "node:value(node:ref($FrIfCluster)/FrIfGdWakeupTxIdle)"!][!//
[!VAR "MacTempValue1" = "number($MacTempValue1)"!][!//
[!VAR "MacTempValue2" = "bit:and(number($MacTempValue2),15)"!][!//
[!VAR "MacTempValue3" = "bit:and(number($MacTempValue3),255)"!][!//
[!VAR "MacTempValue1" = "bit:or((bit:shl($MacTempValue1,4)),$MacTempValue2)"!][!//
[!VAR "MacTempValue1_1" = "bit:or((bit:shl($MacTempValue1,8)),$MacTempValue3)"!][!//
[!/* PCR9 */!][!//
[!VAR "MacTempValue1" = "node:value(node:ref($FrIfCluster)/FrIfGNumberOfMinislots)"!][!//
[!VAR "MacTempValue2" = "node:value(node:ref($FrIfCluster)/FrIfGdSymbolWindow)"!][!//
[!VAR "MacTempValue3" = "node:value(node:ref($FrController)/FrPOffsetCorrectionOut)"!][!//
[!VAR "MacTempValue1" = "num:i($MacTempValue1)"!][!//
[!VAR "MacTempValue2" = "num:i($MacTempValue2)"!][!//
[!VAR "MacTempValue3" = "bit:and(num:i($MacTempValue3),16383)"!][!//
[!IF "$MacTempValue1!=0"!][!VAR "MacTempValue1"="1"!][!ELSE!][!VAR "MacTempValue1"="0"!][!ENDIF!][!//
[!IF "$MacTempValue2!=0"!][!VAR "MacTempValue2"="1"!][!ELSE!][!VAR "MacTempValue2"="0"!][!ENDIF!][!//
[!VAR "MacTempValue1" = "bit:or((bit:shl($MacTempValue1,1)),$MacTempValue2)"!][!//
[!VAR "MacTempValue1_2" = "bit:or((bit:shl($MacTempValue1,14)),$MacTempValue3)"!][!//
[!WS "4"!][!"concat(  num:inttohex($MacTempValue1_1,4), substring-after(num:inttohex($MacTempValue1_2,4),'0x') )"!]U,        /*  PCR8_9 */
[!/* PCR10 */!][!//
[!VAR "MacTempValue3" = "node:value(node:ref($FrIfCluster)/FrIfGMacroPerCycle)"!][!//
[!IF "text:tolower(node:value(node:ref($FrController)/FrPKeySlotOnlyEnabled))='true'"!][!VAR "MacTempValue1"="1"!][!ELSE!][!VAR "MacTempValue1"="0"!][!ENDIF!][!//
[!IF "node:value(node:ref($FrController)/FrPWakeupChannel)='FR_CHANNEL_A'"!][!VAR "MacTempValue2"="0"!][!ELSE!][!VAR "MacTempValue2"="1"!][!ENDIF!][!//
[!VAR "MacTempValue1" = "number($MacTempValue1)"!][!//
[!VAR "MacTempValue2" = "number($MacTempValue2)"!][!//
[!VAR "MacTempValue3" = "bit:and(number($MacTempValue3),16383)"!][!//
[!VAR "MacTempValue1" = "bit:or((bit:shl($MacTempValue1,1)),$MacTempValue2)"!][!//
[!VAR "MacTempValue1_1" = "bit:or((bit:shl($MacTempValue1,14)),$MacTempValue3)"!][!//
[!/* PCR11 */!][!//
[!VAR "MacTempValue3" = "node:value(node:ref($FrController)/FrPOffsetCorrectionStart)"!][!//
[!IF "node:value(node:ref($FrController)/FrPKeySlotUsedForStartup)"!][!VAR "KeySlotStartup"="1"!][!ELSE!][!VAR "KeySlotStartup"="0"!][!ENDIF!][!//
[!IF "node:value(node:ref($FrController)/FrPKeySlotUsedForSync)"!][!VAR "KeySlotSync"="1"!][!ELSE!][!VAR "KeySlotSync"="0"!][!ENDIF!][!//
[!VAR "MacTempValue1" = "number($KeySlotStartup)"!][!//
[!VAR "MacTempValue2" = "number($KeySlotSync)"!][!//
[!VAR "MacTempValue3" = "bit:and(number($MacTempValue3),16383)"!][!//
[!VAR "MacTempValue1" = "bit:or((bit:shl($MacTempValue1,1)),$MacTempValue2)"!][!//
[!VAR "MacTempValue1_2" = "bit:or((bit:shl($MacTempValue1,14)),$MacTempValue3)"!][!//            
[!WS "4"!][!"concat(  num:inttohex($MacTempValue1_1,4), substring-after(num:inttohex($MacTempValue1_2,4),'0x') )"!]U,        /*  PCR10_11  PCR11 - pOffsetCorrectionStart from spec. 3.0 used instead of gOffsetCorrectionStart from spec. 2.1*/
[!/* PCR12 */!][!//
[!VAR "MacTempValue1" = "node:value(node:ref($FrController)/FrPAllowPassiveToActive)"!][!//
[!VAR "MacTempValue2" = "node:value(node:ref($FrIfCluster)/FrIfGPayloadLengthStatic)"!][!//
[!IF "number(node:ref($FrController)/FrPKeySlotId) > 0"!][!//
  [!CALL "CrcCalculation", "Sync" = "number($KeySlotSync)", "Startup" = "number($KeySlotStartup)", "FrameId" = "number(node:ref($FrController)/FrPKeySlotId)", "PayloadLengthW" = "$MacTempValue2", "OutCrc"="1"!][!//
[!VAR "MacTempValue2" = "bit:and(number($OutCrc),2047)"!][!//
[!ELSE!][!//
  [!VAR "MacTempValue2" = "0"!][!//
  [!VAR "OutCrc" = "0"!][!//
[!ENDIF!][!//
[!VAR "MacTempValue1_1" = "bit:or((bit:shl($MacTempValue1,11)),$MacTempValue2)"!][!//
[!/* PCR13 */!][!//
[!VAR "MacTempValue1" = "node:value(node:ref($FrIfCluster)/FrIfGdActionPointOffset)"!][!//
[!VAR "MacTempValue2" = "node:value(node:ref($FrIfCluster)/FrIfGdMiniSlotActionPointOffset)"!][!//
[!VAR "MacTempValue3" = "node:value(node:ref($FrIfCluster)/FrIfGdStaticSlot)"!][!//
[!VAR "MacTempValue1" = "number($MacTempValue1)"!][!//
[!VAR "MacTempValue2" = "number($MacTempValue2)"!][!//
[!VAR "MacTempValue3" = "number($MacTempValue3)"!][!//
[!VAR "MacTempValue3" = "number($MacTempValue3)-number($MacTempValue1)-1"!][!//
[!IF "$MacTempValue1 >= $MacTempValue2"!][!VAR "MacTempValue4"="$MacTempValue1"!][!ELSE!][!VAR "MacTempValue4"="$MacTempValue2"!][!ENDIF!][!//
[!VAR "MacTempValue4" = "(number($MacTempValue4)-1)"!][!//
[!VAR "MacTempValue3" = "bit:and(number($MacTempValue3),1023)"!][!//
[!VAR "MacTempValue4" = "bit:or((bit:shl($MacTempValue4,10)),$MacTempValue3)"!][!//
[!WS "4"!][!"concat(  num:inttohex($MacTempValue1_1,4), substring-after(num:inttohex($MacTempValue4,4),'0x') )"!]U,        /*  PCR12_13  PCR12 - Key slot crc is [!"num:i($OutCrc)"!] = [!"num:inttohex($OutCrc, 4)"!] */
[!/* PCR14 */!][!//
[!VAR "MacTempValue1" = "node:value(node:ref($FrController)/FrPdListenTimeout)"!][!//
[!VAR "MacTempValue2" = "node:value(node:ref($FrController)/FrPRateCorrectionOut)"!][!//
[!VAR "MacTempValue1" = "number($MacTempValue1)-1"!][!//
[!VAR "MacTempValue2" = "number($MacTempValue2)"!][!//
[!VAR "MacTempValue3" = "bit:and(number($MacTempValue1),2031616)"!][!//
[!VAR "MacTempValue3_1" = "bit:or((bit:shl($MacTempValue2,5)),(bit:shr($MacTempValue3,16)))"!][!//
[!/* PCR15 */!][!//
[!VAR "TempValue3_2" = "bit:and(number($MacTempValue1),65535)"!][!//
[!WS "4"!][!"concat(  num:inttohex($MacTempValue3_1,4), substring-after(num:inttohex($TempValue3_2,4),'0x') )"!]U,        /*  PCR14_15 */
[!/* PCR16 */!][!//
[!VAR "MacTempValue1" = "node:value(node:ref($FrController)/FrPdListenTimeout)"!][!//
[!VAR "MacTempValue2" = "node:value(node:ref($FrController)/FrPMacroInitialOffsetB)"!][!//
[!VAR "MacTempValue3" = "node:value(node:ref($FrIfCluster)/FrIfGListenNoise)"!][!//
[!VAR "MacTempValue2" = "number($MacTempValue2)"!][!//
[!VAR "MacTempValue4" = "number($MacTempValue1)*number($MacTempValue3)"!][!//
[!VAR "MacTempValue4" = "number($MacTempValue4)-1"!][!//
[!VAR "MacTempValue5" = "bit:and(number($MacTempValue4),33488896)"!][!//
[!VAR "MacTempValue5_1" = "bit:or((bit:shl($MacTempValue2,9)),(bit:shr($MacTempValue5,16)))"!][!//
[!/* PCR17 */!][!//
[!VAR "MacTempValue5_2" = "bit:and(number($MacTempValue4),65535)"!][!//
[!WS "4"!][!"concat(  num:inttohex($MacTempValue5_1,4), substring-after(num:inttohex($MacTempValue5_2,4),'0x') )"!]U,        /*  PCR16_17 */
[!/* PCR18 */!][!//
[!VAR "MacTempValue1" = "node:value(node:ref($FrController)/FrPWakeupPattern)"!][!//
[!VAR "MacTempValue1" = "number($MacTempValue1)"!][!//
[!VAR "MacTempValue2" = "bit:and(number(node:ref($FrController)/FrPKeySlotId),1023)"!][!//
[!VAR "MacTempValue1_1" = "bit:or((bit:shl($MacTempValue1,10)),$MacTempValue2)"!][!//
[!/* PCR19 */!][!//
[!VAR "MacTempValue1" = "node:value(node:ref($FrController)/FrPDecodingCorrection)"!][!//
[!VAR "MacTempValue2_2" = "node:value(node:ref($FrController)/FrPDelayCompensationA)"!][!//
[!VAR "MacTempValue1" = "number($MacTempValue1)+number($MacTempValue2_2)+2"!][!//
[!VAR "MacTempValue3" = "bit:and(number(node:ref($FrIfCluster)/FrIfGPayloadLengthStatic),127)"!][!//
[!VAR "MacTempValue1_2" = "bit:or((bit:shl($MacTempValue1,7)),$MacTempValue3)"!][!//
[!WS "4"!][!"concat(  num:inttohex($MacTempValue1_1,4), substring-after(num:inttohex($MacTempValue1_2,4),'0x') )"!]U,        /*  PCR18_19  PCR18 - Key Slot ID is [!"$MacTempValue2"!] [!//
[!IF "0 = number($KeySlotStartup) and 0 = number($KeySlotSync)"!]
  [!WS "0"!], Key Slot is not used for sync/startup. [!//
[!ENDIF!][!//
[!WS "0"!]*/
[!/* PCR20 */!][!//
[!VAR "MacTempValue1" = "node:value(node:ref($FrController)/FrPMicroInitialOffsetB)"!][!//
[!VAR "MacTempValue2" = "node:value(node:ref($FrController)/FrPMicroInitialOffsetA)"!][!//
[!VAR "MacTempValue1" = "number($MacTempValue1)"!][!//
[!VAR "MacTempValue2" = "number($MacTempValue2)"!][!//
[!VAR "MacTempValue1_1" = "bit:or((bit:shl($MacTempValue1,8)),$MacTempValue2)"!][!//
[!/* PCR21 */!][!//
[!VAR "MacTempValue1" = "0"!][!/* pExternRateCorrection is no longer supported, used value 0 */!][!//
[!VAR "MacTempValue2" = "node:value(node:ref($FrIfCluster)/FrIfGNumberOfMinislots)"!][!//
[!VAR "MacTempValue3" = "node:value(node:ref($FrController)/FrPLatestTx)"!][!//
[!VAR "MacTempValue1" = "number($MacTempValue1)"!][!//
[!VAR "MacTempValue2" = "number($MacTempValue2)-number($MacTempValue3)"!][!//
[!VAR "MacTempValue2" = "bit:and(number($MacTempValue2),8191)"!][!//
[!VAR "MacTempValue1_2" = "bit:or((bit:shl($MacTempValue1,13)),$MacTempValue2)"!][!//
[!WS "4"!][!"concat(  num:inttohex($MacTempValue1_1,4), substring-after(num:inttohex($MacTempValue1_2,4),'0x') )"!]U,        /*  PCR20_21 */
[!/* PCR22 */!][!//
[!VAR "MacTempValue1" = "node:value(node:ref($FrController)/FrPdAcceptedStartupRange)"!][!//
[!VAR "MacTempValue2" = "node:value(node:ref($FrController)/FrPDelayCompensationA)"!][!//
[!VAR "MacTempValue3" = "node:value(node:ref($FrController)/FrPMicroPerCycle)"!][!//
[!VAR "MacTempValue2" = "number($MacTempValue1)-number($MacTempValue2)"!][!//
[!VAR "MacTempValue5" = "bit:and(number($MacTempValue3),983040)"!][!//
[!VAR "MacTempValue4" = "bit:or((bit:shl($MacTempValue2,4)),(bit:shr($MacTempValue5,16)))"!][!//
[!/* PCR23 */!][!//
[!VAR "MacTempValue3" = "bit:and(number($MacTempValue3),65535)"!][!//
[!WS "4"!][!"concat(  num:inttohex($MacTempValue4,4), substring-after(num:inttohex($MacTempValue3,4),'0x') )"!]U,        /*  PCR22_23 */
[!/* PCR24 */!][!//
[!VAR "MacTempValue1" = "node:value(node:ref($FrController)/FrPClusterDriftDamping)"!][!//
[!VAR "MacTempValue2" = "bit:and(number(node:ref($FrController)/FrPPayloadLengthDynMax),127)"!][!//
[!VAR "MacTempValue3" = "node:value(node:ref($FrController)/FrPMicroPerCycle)"!][!//
[!/* Compute the value of the pdMaxDrift */!][!//
[!VAR "MacTempValue4" = "ceiling(number(node:value(node:ref($FrController)/FrPMicroPerCycle))*2*0.0015 div(1-0.0015))"!][!//
[!VAR "MacTempValue1" = "number($MacTempValue1)"!][!//
[!VAR "MacTempValue3" = "number($MacTempValue3)-number($MacTempValue4)"!][!//
[!VAR "MacTempValue5" = "bit:and(number($MacTempValue3),983040)"!][!//
[!VAR "MacTempValue1" = "bit:or((bit:shl($MacTempValue1,7)),$MacTempValue2)"!][!//
[!VAR "MacTempValue1" = "bit:or((bit:shl($MacTempValue1,4)),(bit:shr($MacTempValue5,16)))"!][!//
[!/* PCR25 */!][!//
[!VAR "MacTempValue5" = "bit:and(number($MacTempValue3),65535)"!][!//
[!WS "4"!][!"concat(  num:inttohex($MacTempValue1,4), substring-after(num:inttohex($MacTempValue5,4),'0x') )"!]U,        /*  PCR24_25 */
[!/* PCR26 */!][!//
[!IF "node:value(node:ref($FrController)/FrPAllowHaltDueToClock)"!][!VAR "MacTempValue1"="1"!][!ELSE!][!VAR "MacTempValue1"="0"!][!ENDIF!][!//
[!VAR "MacTempValue2" = "node:value(node:ref($FrController)/FrPdAcceptedStartupRange)"!][!//
[!VAR "MacTempValue3" = "node:value(node:ref($FrController)/FrPDelayCompensationB)"!][!//
[!VAR "MacTempValue2" = "number($MacTempValue2)-number($MacTempValue3)"!][!//
[!VAR "MacTempValue2" = "bit:and(number($MacTempValue2),2047)"!][!//
[!VAR "MacTempValue4" = "node:value(node:ref($FrController)/FrPMicroPerCycle)"!][!//
[!/* Compute the value of the pdMaxDrift */!][!//
[!VAR "MacTempValue5" = "ceiling(number(node:value(node:ref($FrController)/FrPMicroPerCycle))*2*0.0015 div(1-0.0015))"!][!//
[!VAR "MacTempValue4" = "number($MacTempValue4)+number($MacTempValue5)"!][!//
[!VAR "MacTempValue6" = "bit:and(number($MacTempValue4),983040)"!][!//
[!VAR "MacTempValue1" = "bit:or((bit:shl($MacTempValue1,11)),$MacTempValue2)"!][!//
[!VAR "MacTempValue1" = "bit:or((bit:shl($MacTempValue1,4)),(bit:shr($MacTempValue6,16)))"!][!//
[!/* PCR27 */!][!//
[!VAR "MacTempValue6" = "bit:and(number($MacTempValue4),65535)"!][!//
[!WS "4"!][!"concat(  num:inttohex($MacTempValue1,4), substring-after(num:inttohex($MacTempValue6,4),'0x') )"!]U,        /*  PCR26_27 */
[!/* PCR28 */!][!//
[!VAR "MacTempValue1" = "node:value(node:ref($FrIfCluster)/FrIfGdDynamicSlotIdlePhase)"!][!//
[!VAR "MacTempValue2" = "node:value(node:ref($FrIfCluster)/FrIfGMacroPerCycle)"!][!//
[!VAR "MacTempValue3" = "node:value(node:ref($FrController)/FrPOffsetCorrectionStart)"!][!//
[!VAR "MacTempValue1" = "number($MacTempValue1)"!][!//
[!VAR "MacTempValue2" = "number($MacTempValue2)-number($MacTempValue3)"!][!//
[!VAR "MacTempValue2" = "bit:and(number($MacTempValue2),16383)"!][!//
[!VAR "MacTempValue1_1" = "bit:or((bit:shl($MacTempValue1,14)),$MacTempValue2)"!][!//
[!/* PCR29 */!][!//
[!VAR "MacTempValue1" = "0"!][!/* pExternOffsetCorrection is no longer supported, used value 0 */!][!//
[!VAR "MacTempValue2" = "node:value(node:ref($FrIfCluster)/FrIfGNumberOfMinislots)"!][!//
[!VAR "MacTempValue1" = "number($MacTempValue1)"!][!//
[!VAR "MacTempValue2" = "number($MacTempValue2)-1"!][!//
[!VAR "MacTempValue2" = "bit:and(number($MacTempValue2),8191)"!][!//
[!VAR "MacTempValue1_2" = "bit:or((bit:shl($MacTempValue1,13)),$MacTempValue2)"!][!//
[!WS "4"!][!"concat(  num:inttohex($MacTempValue1_1,4), substring-after(num:inttohex($MacTempValue1_2,4),'0x') )"!]U,        /*  PCR28_29 */
[!/* PCR30 */!][!//
[!VAR "MacTempValue1" = "node:value(node:ref($FrIfCluster)/FrIfGSyncFrameIDCountMax)"!][!//
[!VAR "MacTempValue1" = "number($MacTempValue1)"!][!//
[!WS "4"!][!"num:inttohex($MacTempValue1,4)"!]U,            /*  PCR30 */
[!WS "4"!][!"num:i(number(node:ref($FrIfCluster)/FrIfGNumberOfStaticSlots))"!]U,                /*  gNumberOfStaticSlots */
[!WS "4"!][!"num:i(number(node:ref($FrIfCluster)/FrIfGNetworkManagementVectorLength))"!]U,                 /*  gNetworkManagementVectorLength */
[!WS "4"!][!"num:i(number(node:ref($FrController)/FrPPayloadLengthDynMax))"!]U,                 /*  pPayloadLengthDynMax */
[!WS "4"!][!"num:i(node:value(node:ref($FrIfCluster)/FrIfGPayloadLengthStatic))"!]U                 /*  gPayloadLengthStatic */
};
[!ENDMACRO!][!//
[!//
[!//
[!//
[!//
[!//
[!/*-------------------------------------------------------------------------*/!][!//
[!/* Main generation script                                                  */!][!//
[!/*-------------------------------------------------------------------------*/!][!//
[!WS "0"!]/* @violates @ref FR_PBCFG_C_REF_4 */
#define FR_START_SEC_CONFIG_DATA_UNSPECIFIED
/* Covers FR112 */
/* @violates @ref FR_PBCFG_C_REF_1 */
/* @violates @ref FR_PBCFG_C_REF_2 */
#include "Fr_MemMap.h"
[!//
[!VAR "CtrlNum" = "num:i('0')"!][!//
[!IF "node:value(FrGeneral/FrNumCtrlSupported) > ($AvailableControllers)"!][!//
  [!WARNING!][!//
    [!WS "0"!]Warning 312: Too much controllers are required to be supported by the driver. Driver will support maximum [!"num:i($AvailableControllers)"!] FlexRay [!IF "num:i($AvailableControllers) > 1"!]controllers available on the hardware[!ELSE!]controller available on the hardware[!ENDIF!].
  [!ENDWARNING!][!//
[!ENDIF!][!//
[!/* Go through all Fr multiple configurations */!][!//
[!LOOP "node:order(FrMultipleConfiguration,'node:name(.)')"!][!//Sort the multiple configurations by their name at first
  [!CR!][!//
  [!VAR "FrConfigName" = "as:name(.)"!][!//Store the name of Fr controller multiple configuration
  [!VAR "FrConfigIdx" = "position()"!][!//Store the index of Fr controller multiple configuration
  [!IF "$AvailableControllers < count(FrController/*)"!][!//
    [!WARNING!][!//
      [!WS "0"!]Warning 310: Too much controllers were configured for [!"node:path(.)"!] multiple configuration. Hardware device supports maximum [!"num:i($AvailableControllers)"!] FlexRay [!IF "num:i($AvailableControllers) > 1"!]controllers[!ELSE!]controller[!ENDIF!].
    [!ENDWARNING!][!//
  [!ENDIF!][!//
  [!IF "node:value(../FrGeneral/FrNumCtrlSupported) < count(FrController/*)"!][!//
    [!WARNING!][!//
      [!WS "0"!]Warning 311: Too much controllers were configured for [!"node:path(.)"!] multiple configuration. Driver is configured to support [!"node:value(../FrGeneral/FrNumCtrlSupported)"!] FlexRay [!IF "node:value(../FrGeneral/FrNumCtrlSupported) > 1"!]controllers[!ELSE!]controller[!ENDIF!].
    [!ENDWARNING!][!//
  [!ENDIF!][!//
  [!WS "0"!][!/* Go through all controllers in the Fr multiple configuration */!][!//
  [!LOOP "node:order(FrController/*,'FrCtrlIdx','node:name(.)')"!][!//Sort the controllers by their name at first
    [!IF "text:tolower(text:uniq(../*/FrCtrlIdx, FrCtrlIdx)) = 'false'"!][!// Check FrCtrlIdx is unique
      [!ERROR!][!//
        [!WS "0"!]Error 044: [!"node:path(.)"!]/FrCtrlIdx is not unique within [!"node:path(../..)"!].
      [!ENDERROR!][!//
    [!ENDIF!][!//
    [!IF "number(FrCtrlIdx) >= count(../*)"!][!// Check FrCtrlIdx
      [!ERROR!][!//
        [!WS "0"!]Error 045: FrCtrlIdx indices do not create continuous row beginning with 0 within [!"node:path(../..)"!].
      [!ENDERROR!][!//
    [!ENDIF!][!//
    [!IF "text:tolower(text:uniq(../*/VendorSpecific/CCBaseAddress, VendorSpecific/CCBaseAddress)) = 'false'"!]
      [!WARNING!][!//
        [!WS "0"!]Warning 313: CCBaseAddress [!"num:inttohex(node:value(VendorSpecific/CCBaseAddress))"!] is not unique within one multiple configuration for the following controller [!"node:path(.)"!].
      [!ENDWARNING!][!//
    [!ENDIF!]
    [!NOCODE!][!//
    [!IF "$CtrlNum < count(../*)"!][!//
      [!VAR "CtrlNum" = "count(../*)"!][!//
    [!ENDIF!][!//
    [!VAR "FrCtrlName" = "node:name(.)"!][!//Store the name of Fr controller for future usage
    [!VAR "FrCtrlPath" = "node:path(.)"!][!//Store the path to the Fr controller for future comparisons
    [!// Clear counter of controller references from the FrIf - the controller must not be referenced from more than one FrIf cluster
    [!// because then it is not clear which of them contains the configuration parameters to be used (they can be different)
    [!VAR "FrCtrlRefCount" = "0"!][!//
    [!// Go through all FrIf multiple configurations to find whether the controller is used in some of them
    [!LOOP "node:order(as:modconf('FrIf')[1]/FrIfConfig,'node:name(.)')"!][!// Sort multiple configurations by their name at first
      [!//Go through all clusters in the FrIf multiple configuration to find whether the controller is used in some of them
      [!LOOP "node:order(FrIfCluster/*,'node:name(.)')"!][!// Sort the clusters by their name at first
        [!//Go through all controllers in the cluster to find whether it is the current Fr controller
        [!LOOP "node:order(FrIfController/*,'node:value(FrIfCtrlIdx)','node:name(.)')"!][!// Sort the controllers by their name at first
          [!//Check that the controller is used at most in one cluster - do it as first because the previous reference is otherwise overwritten
          [!IF "$FrCtrlPath = node:path(node:ref(FrIfFrCtrlRef))"!]
            [!IF "$FrCtrlRefCount > 0"!][!//
              [!ERROR!][!//
                [!WS "0"!]Error 002: The [!"node:name(../../../..)"!]/[!"node:name(../..)"!]/[!"node:name(.)"!]/FrIfFrCtrlRef references [!"node:name(node:ref($FrCtrlPath)/../..)"!]/[!"node:name($FrCtrlPath)"!] which is already used in [!"node:name(node:ref($FrControllersUsage)/../../../..)"!]/[!"node:name(node:ref($FrControllersUsage)/../..)"!]/[!"node:name($FrControllersUsage)"!] cluster. The FrController can be used in only one cluster.
              [!ENDERROR!][!//
            [!ENDIF!][!//
            [!IF "node:refvalid(FrIfFrCtrlRef) = true()"!][!// Check valid reference to the Fr controller - avoid accessing node that does not exist
              [!VAR "FrCtrlRefCount" = "$FrCtrlRefCount + 1"!][!// Increment count of references to this FrController from the FrIf clusters
              [!//Store the reference to the multiple cluster using this FrController
              [!VAR "FrControllersUsage" = "node:path(.)"!][!//Store the path of the controllers cluster for further accesses
            [!ELSE!][!//
              [!ERROR!]
                [!WS "0"!]Error 001: The [!"node:name(../../../..)"!]/[!"node:name(../..)"!]/[!"node:name(.)"!]/FrIfFrCtrlRef contains invalid reference ([!"string(FrIfFrCtrlRef)"!])
              [!ENDERROR!][!//
            [!ENDIF!][!//
          [!ENDIF!]
        [!ENDLOOP!][!//FrIfController loop
      [!ENDLOOP!][!//FrIfCluster loop
    [!ENDLOOP!][!//FrIfConfig loop
    [!//Check that the controller is used
    [!IF "$FrCtrlRefCount = 0"!][!//
      [!ERROR!][!//
        [!WS "0"!]Error 003: The controller [!"node:name(../..)"!]/[!"node:name(.)"!] is not used in any FrIfCluster.
      [!ENDERROR!][!//
    [!ENDIF!][!//
    [!//No ambiguous configuration detected, proceed with checks of configuration parameters
    [!//to simplify further accesses put the FrIfCluster using the current FrController into a variable
    [!VAR "FrControllersCluster" = "node:path(node:ref($FrControllersUsage)/../..)"!][!//
    [!CALL "CfgChecks", "FrIfCluster" = "$FrControllersCluster", "FrController" = "node:path(.)"!][!//
    [!ENDNOCODE!][!//
    [!WS "0"!]/******************************************************************************
    [!WS "0"!]*  Configuration for
    [!WS "0"!]*  Fr:
    [!WS "0"!]*  FrMultipleConfiguration container  '[!"as:name(../..)"!][!IF "var:defined('postBuildVariant')"!]_[!"$postBuildVariant"!][!ENDIF!]'
    [!WS "0"!]*  FrController container             '[!"node:name(.)"!]','FrCtrlIdx = [!"node:value(FrCtrlIdx)"!]'
    [!WS "0"!]*  FrIf:
    [!WS "0"!]*  FrIfConfig container               '[!"as:name(node:ref($FrControllersCluster)/../..)"!]'
    [!WS "0"!]*  FrIfCluster container              '[!"node:name(node:ref($FrControllersCluster))"!]','FrIfClstIdx = [!"node:value(node:ref($FrControllersCluster)/FrIfClstIdx)"!]'
    [!WS "0"!]*  FrIfController container           '[!"node:name(node:ref($FrControllersUsage))"!]','FrIfCtrlIdx = [!"node:value(node:ref($FrControllersUsage)/FrIfCtrlIdx)"!]'
    [!WS "0"!]******************************************************************************/
    [!WS "0"!][!/* This macro will return all slots received into the FIFO A and B in separate lists */!][!//
    [!CALL "RxFIFOSlots", "FrIfCluster" = "$FrControllersCluster", "FrController" = "node:path(.)", "OutFIFOASlots" = "string('')", "OutFIFOBSlots" = "string('')"!][!//
    [!WS "0"!][!// Count number of required message buffers
    [!VAR "NeededBuffers" = "0"!][!//
    [!VAR "ReconfigurableBuffers" = "0"!][!//
    [!VAR "NumberOfSlaveShared"="0"!][!//
    [!LOOP "node:ref($FrControllersUsage)/FrIfLPdu/*"!][!//
      [!IF "'true' = text:tolower(node:value(FrIfReconfigurable))"!][!//
        [!VAR "ReconfigurableBuffers" = "$ReconfigurableBuffers + 1"!][!//
      [!ENDIF!][!//
      [!SELECT "node:ref(FrIfVBTriggeringRef)"!][!//
        [!IF "node:name(node:ref(node:ref(FrIfFrameStructureRef)/FrIfPdusInFrame/*[position()=1]/FrIfPduRef)/FrIfPduDirection)='FrIfRxPdu'"!][!//
          [!IF "node:value(FrIfChannel) = 'FRIF_CHANNEL_A'"!][!//
            [!IF "text:contains(string($OutFIFOASlots), string(FrIfSlotId))"!][!//
            [!ELSE!][!//
              [!VAR "NeededBuffers" = "$NeededBuffers + 1"!][!//
            [!ENDIF!][!//
          [!ELSEIF "node:value(FrIfChannel) = 'FRIF_CHANNEL_B'"!][!//
            [!IF "text:contains(string($OutFIFOBSlots), string(FrIfSlotId))"!][!//
            [!ELSE!][!//
              [!VAR "NeededBuffers" = "$NeededBuffers + 1"!][!//
            [!ENDIF!][!//
          [!ELSE!][!//
            [!VAR "NeededBuffers" = "$NeededBuffers + 1"!][!//
          [!ENDIF!][!//
        [!ELSE!][!//
          [!VAR "NeededBuffers" = "$NeededBuffers + 1"!][!//
        [!ENDIF!][!//
      [!ENDSELECT!]
    [!ENDLOOP!][!//
    [!IF "($NeededBuffers > $AvailableBuffers) or ('true' = text:tolower(VendorSpecific/ForceReconfiguration))"!][!//
      [!IF "text:tolower(node:value(../../../FrGeneral/FrPrepareLPduSupport)) = 'false'"!][!//
        [!ERROR!][!//
          [!WS "0"!]Error 035: Not enough resources for all LPdus, try enable the parameter FrPrepareLPduSupport which enables API function Fr_PrepareLPdu(), so more than one LPdu can share one Message Buffer.
        [!ENDERROR!][!//
      [!ENDIF!][!//
      [!INFO!][!//
        [!WS "0"!]Starting reconfiguration. [!CR!]Buffers available: [!"num:i($AvailableBuffers)"!] [!CR!]Buffers needed: [!"num:i($NeededBuffers)"!] [!CR!]Buffers available for reconfiguration: [!"num:i($ReconfigurableBuffers)"!][!//
      [!ENDINFO!][!//
      [!IF "FSL_FR_RECONFIG:Reconfig( node:ref($FrControllersUsage)/FrIfLPdu, 4, 0, string(FrCtrlIdx), string(""))='true'"!][!ENDIF!][!//
      [!WS "0"!][!// in case of some warnings occur, show them (generation will be NOT STOPPED)
      [!IF "FSL_FR_STATUS:HasWarnings() = true()"!][!//
        [!WARNING!]Number of warnings: [!"num:i(FSL_FR_STATUS:GetWarningsCount())"!][!"FSL_FR_STATUS:GetWarnings()"!][!ENDWARNING!][!//
      [!ENDIF!][!//
      [!WS "0"!][!// in case of some errors occur, show them (generation will be STOPPED)
      [!IF "FSL_FR_STATUS:HasErrors() = true()"!][!//
        [!ERROR!]Code Generation stopped! Number of errors: [!"num:i(FSL_FR_STATUS:GetErrorsCount())"!][!"FSL_FR_STATUS:GetErrors()"!][!ENDERROR!][!//
      [!ENDIF!][!//
      [!VAR "Reconfigurations_Init" = "FSL_FR_RECONFIG:GetReconfigString()"!][!// Get result string of reconfiguration
      [!VAR "Reconfigurations"="''"!]
      [!LOOP "text:split($Reconfigurations_Init, '#')"!][!// Count the number of slave lpdu shared.
        [!IF "count(text:split(. ,' ')) > 1"!]
            [!VAR "NumberOfSlaveShared"="$NumberOfSlaveShared + count(text:split(. ,' ')) - 1"!][!//
            [!VAR "Reconfigurations"="concat($Reconfigurations,'#',.)"!]
        [!ENDIF!]
      [!ENDLOOP!][!//
      [!IF "($AvailableBuffers - $NumberOfSlaveShared) < $NeededBuffers"!][!//
        [!ERROR!][!//
          [!WS "0"!]Error 034: Not enough resources for all LPdus even after reconfiguration.[!//
        [!ENDERROR!][!//
      [!ENDIF!][!//
    [!ELSE!][!//
      [!VAR "Reconfigurations" = "''"!][!//
    [!ENDIF!][!//
    [!CALL "ExtendedCfgChecks", "FrIfCluster" = "$FrControllersCluster", "FrController" = "node:path(.)", "FIFOASlots" = "$OutFIFOASlots", "FIFOBSlots" = "$OutFIFOBSlots",  "Reconfigurations" = "$Reconfigurations"!][!//
    [!CALL "HWConfig", "CfgIdx" = "$FrConfigIdx", "CfgVariant" = "string('PB')", "FrIfCluster" = "$FrControllersCluster", "FrController" = "node:path(.)", "FIFOASlots" = "$OutFIFOASlots", "FIFOBSlots" = "$OutFIFOBSlots",  "Reconfigurations" = "$Reconfigurations"!][!//
    [!CALL "PSRRegisters", "CfgIdx" = "$FrConfigIdx", "CfgVariant" = "string('PB')", "FrIfCluster" = "$FrControllersCluster", "FrController" = "node:path(.)"!][!//
    [!CALL "LPduConfigs", "CfgVariant" = "string('PB')", "FrIfCluster" = "$FrControllersCluster", "FrController" = "node:path(.)", "FIFOASlots" = "$OutFIFOASlots", "FIFOBSlots" = "$OutFIFOBSlots"!][!//
    [!CALL "FifoCfg", "CfgVariant" = "string('PB')", "FrIfCluster" = "$FrControllersCluster", "FrController" = "node:path(.)", "FIFOASlots" = "$OutFIFOASlots", "FIFOBSlots" = "$OutFIFOBSlots", "Reconfigurations" = "$Reconfigurations"!][!//
    [!CALL "BufferAddresses", "CfgVariant" = "string('PB')", "FrIfCluster" = "$FrControllersCluster", "FrController" = "node:path(.)", "FIFOASlots" = "$OutFIFOASlots", "FIFOBSlots" = "$OutFIFOBSlots", "Reconfigurations" = "$Reconfigurations"!][!//
    [!CALL "LPduInfoCfg", "CfgVariant" = "string('PB')", "FrIfCluster" = "$FrControllersCluster", "FrController" = "node:path(.)", "FIFOASlots" = "$OutFIFOASlots", "FIFOBSlots" = "$OutFIFOBSlots", "Reconfigurations" = "$Reconfigurations"!][!//
    [!CALL "BufferCfg", "CfgVariant" = "string('PB')", "FrIfCluster" = "$FrControllersCluster", "FrController" = "node:path(.)", "FIFOASlots" = "$OutFIFOASlots", "FIFOBSlots" = "$OutFIFOBSlots", "Reconfigurations" = "$Reconfigurations"!][!//
    [!CR!][!//
    [!IF "../../../FrGeneral/VendorSpecific/FrDisableDemReportErrorStatus = 'false'"!][!//
      [!WS "0"!]/* This structure  holds information about reported DEM errors */
      [!WS "0"!]static CONST(Fr_DemErrorType, FR_CONST) FrMC[!"$FrConfigIdx"!]_Ctrl[!"num:i(node:ref(node:path(.))/FrCtrlIdx)"!]_DemEventParameter_PB =
      [!WS "0"!]{
      [!IF "node:exists(FrControllerDemEventParameterRefs/FR_E_CTRL_TESTRESULT)"!][!//
        [!IF "node:refvalid(./FrControllerDemEventParameterRefs/FR_E_CTRL_TESTRESULT) = 'true'"!][!//
          [!WS "4"!](VAR(uint32, FR_VAR))STD_ON, /* DEM reporting is enabled */
          [!WS "4"!]DemConf_DemEventParameter_[!"node:name(node:ref(FrControllerDemEventParameterRefs/FR_E_CTRL_TESTRESULT))"!] /* DEM ID */
        [!ELSE!][!//
          [!ERROR!][!//
            [!WS "0"!]Error 037: The controller [!"node:name(../..)"!]/[!"node:name(.)"!]/FrControllerDemEventParameterRefs/FR_E_CTRL_TESTRESULT has no reference to DemEventID.[!//
          [!ENDERROR!][!//
        [!ENDIF!][!//
      [!ELSE!][!//
        [!WS "4"!](VAR(uint32, FR_VAR))STD_OFF, /* DEM reporting is inhibited */
        [!WS "4"!]0U /* DEM ID is not assigned */
      [!ENDIF!][!//
      [!WS "0"!]};      
    [!ENDIF!][!//
    [!CR!][!//
  [!ENDLOOP!][!//FrController
  [!VAR "Comma" = "''"!][!//
  [!WS "0"!]/* This structure puts together all information about controllers for [!"$FrConfigName"!][!IF "var:defined('postBuildVariant')"!]_ [!"$postBuildVariant"!][!ENDIF!][!WS "1"!] multiple configuration */
  [!WS "0"!]/* @violates @ref FR_PBCFG_C_REF_3 */
  [!WS "0"!]CONST(Fr_ConfigurationType, FR_CONST) [!"$FrConfigName"!][!IF "var:defined('postBuildVariant')"!]_[!"$postBuildVariant"!][!ENDIF!][] =[!//
  [!CR!]{[!//
  [!LOOP "node:order(FrController/*,'FrCtrlIdx','node:name(.)')"!][!//Sort the controllers by their name at first
    [!VAR "FrCtrlPath" = "node:path(.)"!][!//Store the path to the Fr controller for future comparisons
    [!NOCODE!][!//
    [!LOOP "node:order(as:modconf('FrIf')[1]/FrIfConfig/*,'node:name(.)')"!][!// Sort multiple configurations by their name at first
      [!//Go through all clusters in the FrIf multiple configuration to find whether the controller is used in some of them
      [!LOOP "node:order(FrIfCluster/*,'node:name(.)')"!][!// Sort the clusters by their name at first
        [!IF "text:tolower(text:uniq(../*/FrIfClstIdx, FrIfClstIdx)) = 'false' or number(FrIfClstIdx) >= count(../*)"!]][!//Check FrIfClstIdx indices create consecutive sequence
          [!ERROR!][!//
            [!WS"0"!]Error 046: FrIfClstIdx indices do not create zero-based consecutive sequence within the [!"node:path(../..)"!] container.
          [!ENDERROR!][!//
        [!ENDIF!][!//
        [!//Go through all controllers in the cluster to find whether it is the current Fr controller
        [!LOOP "node:order(FrIfController/*,'node:value(FrIfCtrlIdx)','node:name(.)')"!][!// Sort the controllers by their name at first
          [!IF "text:tolower(text:uniq(../*/FrIfCtrlIdx, FrIfCtrlIdx)) = 'false' or number(FrIfCtrlIdx) >= count(../*)"!]][!//Check FrIfCtrlIdx indices create consecutive sequence
            [!ERROR!][!//
              [!WS"0"!]Error 047: FrIfCtrlIdx indices do not create zero-based consecutive sequence within the [!"node:path(../..)"!] container.
            [!ENDERROR!][!//
          [!ENDIF!][!//
          [!//Check that the controller is used at most in one cluster - do it as first because the previous reference is otherwise overwritten
          [!IF "$FrCtrlPath = node:path(node:ref(FrIfFrCtrlRef))"!]
            [!IF "node:refvalid(FrIfFrCtrlRef) = true()"!][!// Check valid reference to the Fr controller - avoid accessing node that does not exist
              [!VAR "FrCtrlRefCount" = "$FrCtrlRefCount + 1"!][!// Increment count of references to this FrController from the FrIf clusters
              [!//Store the reference to the multiple cluster using this FrController
              [!VAR "FrControllersUsage" = "node:path(.)"!][!//Store the path of the controllers cluster for further accesses
            [!ENDIF!][!//
          [!ENDIF!][!//
        [!ENDLOOP!][!//FrIfController loop
      [!ENDLOOP!][!//FrIfCluster loop
    [!ENDLOOP!][!//FrIfConfig loop
    [!ENDNOCODE!][!//
    [!WS "0"!][!CR!][!//
    [!SELECT "node:ref($FrControllersUsage)/../../../.."!][!//
        [!VAR "FrIfConfigIndex" = "position()"!][!//
    [!ENDSELECT!][!//
    [!WS "4"!]{&FrMC[!"$FrConfigIdx"!]_Ctrl[!"num:i(node:ref(node:path(.))/FrCtrlIdx)"!]_CCHardwareCfgSet_PB, &FrIfMC[!"$FrIfConfigIndex"!]_Clst[!"num:i(node:ref($FrControllersUsage)/../../FrIfClstIdx)"!]_Ctrl[!"num:i(node:ref($FrControllersUsage)/FrIfCtrlIdx)"!]_BufferCfgSet_PB, &FrMC[!"$FrConfigIdx"!]_Ctrl[!"num:i(node:ref(node:path(.))/FrCtrlIdx)"!]_CCLowLevelCfgSet_PB, &FrMC[!"$FrConfigIdx"!]_Ctrl[!"num:i(node:ref(node:path(.))/FrCtrlIdx)"!]_CCReadBackParamSet_PB[0], [!IF "../../../FrGeneral/VendorSpecific/FrDisableDemReportErrorStatus = 'false'"!]&FrMC[!"$FrConfigIdx"!]_Ctrl[!"num:i(node:ref(node:path(.))/FrCtrlIdx)"!]_DemEventParameter_PB[!ELSE!]NULL_PTR[!ENDIF!]}[!//
    [!VAR "Comma" = "concat(', /* Fr_Controller ', num:i(node:ref(node:path(.))/FrCtrlIdx),' */')"!][!//
    [!WS "0"!][!"$Comma"!][!//
  [!ENDLOOP!][!//FrController
  [!CR!][!WS "4"!]{NULL_PTR, NULL_PTR, NULL_PTR, NULL_PTR, NULL_PTR}
  [!WS "0"!]};
[!ENDLOOP!][!//FrMultipleConfiguration
[!CR!][!//
/* @violates @ref FR_PBCFG_C_REF_4 */
#define FR_STOP_SEC_CONFIG_DATA_UNSPECIFIED 
/* Covers FR112 */
/* @violates @ref FR_PBCFG_C_REF_1 */
/* @violates @ref FR_PBCFG_C_REF_2 */
#include "Fr_MemMap.h"
#ifdef __cplusplus
}
#endif
/* End of file */
